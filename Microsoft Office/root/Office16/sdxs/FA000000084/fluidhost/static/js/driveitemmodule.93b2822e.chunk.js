"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[4856],{64805:(e,t,s)=>{s.d(t,{J:()=>o});class r{get clientSettings(){return this.clientSettingsProvider()}constructor(e,t,s){this.dispatcher=e,this.clientSettingsProvider=t,this.loggers=s}}class o extends r{getCurrentViewIds(){const e=this.stores.appContextStore.getCurrentViewId();return e?[e]:void 0}constructor(e,t,s,r,o){super(e,r,o),this.webApiProviders=t,this.stores=s}}},48078:(e,t,s)=>{s.r(t),s.d(t,{DriveItemModule:()=>W});var r=s(54456),o=s(73360),i=s(95201),n=s(84824),a=s(48496),c=s(45100),l=s(10979),d=s(26410),u=s(85230),h=s(7304),g=s(81376),p=s(49602),m=s(51676),v=s(90548),I=s(65172),T=s(75992);class f extends T.r{loggingData(){return{vroomId:this.vroomId,sharedWithUsersCount:String(this.userIds.length)}}constructor(e,t){super(f.actionType),this.vroomId=e,this.userIds=t}}f.actionType="PLW_SHARE_DRIVE_ITEM_SUCCEEDED";var w=s(32512);class S extends w.v{loggingData(){return{...super.loggingData(),vroomId:this.vroomId,sharedWithUsersCount:String(this.userIds.length)}}constructor(e,t,s,r,o){super(S.actionType,e,t,s),this.vroomId=r,this.userIds=o}}S.actionType="PLW_SHARE_DRIVE_ITEM_FAILURE";var b=s(52274),k=s(37535),y=s(36723),D=s(715),P=s(61035),R=s(64805),F=s(38752),A=s(74844),U=s(91246),V=s(76209),L=s(82841),x=s(69108),C=s.n(x);class W extends R.J{get name(){return"DriveItemModule"}async fetchDriveItem(e){this.loggers.traceLogger.logTrace(507897296,A.k.Verbose,"Get Drive Item [VroomId=".concat(e,"]"));const t=V.A.getDriveIdAndItemIdFromVroomId(e);if(null==t){const t={response:null,error:new Error("Invalid VroomId [VroomId=".concat(e,"]"))};return Promise.reject(t)}const{driveId:s,itemId:i}=t;try{const t=await this.webApiProviders.graph(),o=await t.getDriveItem({driveId:s,itemId:i});return this.dispatcher.dispatchAction(new r.v(e,o)),this.loggers.traceLogger.logTrace(507897295,A.k.Verbose,"Fetch Drive Item - Success [VroomId=".concat(e,"]")),o}catch(d){var n,a,c,l;const t=d;return this.loggers.traceLogger.logTrace(507897294,A.k.Warning,"Fetch Drive Item - Fail [VroomId=".concat(e,"]").concat((0,L.s8)(t))),this.dispatcher.dispatchAction(new o.N(t.response,null!==(n=null===(a=t.response)||void 0===a?void 0:a.statusText)&&void 0!==n?n:"",null!==(c=null===(l=t.error)||void 0===l?void 0:l.message)&&void 0!==c?c:"",e)),Promise.reject(t)}}async shareDriveItemAsync(e,t){this.loggers.traceLogger.logTrace(507897293,A.k.Verbose,"Share Drive Item [VroomId=".concat(e,"]"));const s=V.A.getDriveIdAndItemIdFromVroomId(e);if(null==s){const t={response:null,error:new Error("Invalid vroomId [VroomId=".concat(e,"]"))};return Promise.reject(t)}const{driveId:r,itemId:o}=s;try{const s=await this.webApiProviders.graph();await s.shareDriveItemAsync({driveId:r,itemId:o,userIds:t}),this.dispatcher.dispatchAction(new f(e,t)),this.loggers.traceLogger.logTrace(507897292,A.k.Info,"Share Drive Item - Success [VroomId=".concat(e,"]"))}catch(l){var i,n,a,c;const s=l;return this.loggers.traceLogger.logTrace(507897291,A.k.Warning,"Fetch Drive Item - Fail [VroomId=".concat(e,"]").concat((0,L.s8)(s))),this.dispatcher.dispatchAction(new S(s.response,null!==(i=null===(n=s.response)||void 0===n?void 0:n.statusText)&&void 0!==i?i:"",null!==(a=null===(c=s.error)||void 0===c?void 0:c.message)&&void 0!==a?a:"",e,t)),Promise.reject(s)}}async cancelUploadSession(e){this.dispatcher.dispatchAction(new i.S(e.id)),this.loggers.traceLogger.logTrace(507897290,A.k.Verbose,"Cancel Upload Session [SessionId=".concat(e.id,"]"));try{const t=await this.webApiProviders.taskService();await t.cancelUploadSession({uploadSession:e}),this.dispatcher.dispatchAction(new n.J(e.id)),this.loggers.traceLogger.logTrace(507897289,A.k.Verbose,"Cancel Upload Session - Success [SessionId=".concat(e.id,"]"))}catch(c){var t,s,r,o;const i=c;return this.dispatcher.dispatchAction(new a.R(i.response,null!==(t=null===(s=i.response)||void 0===s?void 0:s.statusText)&&void 0!==t?t:"",null!==(r=null===(o=i.error)||void 0===o?void 0:o.message)&&void 0!==r?r:"",e.id)),this.loggers.traceLogger.logTrace(507897288,A.k.Warning,"Cancel Upload Session - Fail [SessionId=".concat(e.id,"]").concat((0,L.s8)(i))),Promise.reject(i)}}async getDriveItemThumbnail(e,t,s){this.loggers.traceLogger.logTrace(507897287,A.k.Verbose,"Get DriveItem Thumbnail - Success [ItemUrl=".concat(t,"]"));const r=this.stores.groupDocumentsStore.getDriveItemThumbnail(e,t);if(null!=r)return r;const o=e=>this.stores.groupDocumentsStore.getDriveItemThumbnail(e.groupId,e.itemUrl),i=this.getCurrentViewIds();try{const r=await this.webApiProviders.graph(),n=await r.getDriveItemThumbnail({groupId:e,itemPath:s,itemUrl:t},o,i);return this.dispatcher.dispatchAction(new c.d(e,t,n)),this.loggers.traceLogger.logTrace(507897286,A.k.Verbose,"Get DriveItem Thumbnail - Success [ItemUrl=".concat(t,"]")),n}catch(n){const e=n;return this.loggers.traceLogger.logTrace(507897285,A.k.Warning,"Get DriveItem Thumbnail - Fail [ItemUrl=".concat(t,"]").concat((0,L.s8)(e))),Promise.reject(e)}}async createUploadSession(e,t,s,r,o,i){const n=null!=o?o:U.o.generate();this.dispatcher.dispatchAction(new l.I(s,r,n));try{const r=await this.webApiProviders.taskService(),o=await r.createUploadSession({groupId:e,itemPath:t,session:s},i);return this.dispatcher.dispatchAction(new d.B(o,n)),this.loggers.traceLogger.logTrace(507897284,A.k.Verbose,"Create Upload Session - Success [SessionId=".concat(s.id,"]")),o}catch(p){var a,c,h,g;const e=p;return this.dispatcher.dispatchAction(new u.t(e.response,null!==(a=null===(c=e.response)||void 0===c?void 0:c.statusText)&&void 0!==a?a:"",null!==(h=null===(g=e.error)||void 0===g?void 0:g.message)&&void 0!==h?h:"",s,r.id,n)),this.loggers.traceLogger.logTrace(507897283,A.k.Warning,"Create Upload Session - Fail [SessionId=".concat(s.id,"]").concat((0,L.s8)(e))),Promise.reject(e)}}async uploadBytesToSession(e,t,s,r,o,i,n){try{const a=await this.webApiProviders.taskService(),c=await a.uploadBytesToSession({uploadSession:e,b64Data:t,chunkSize:s,initialByteIndex:r,finalByteIndex:o,totalSize:i},n);return this.dispatcher.dispatchAction(new h.h(c)),this.loggers.traceLogger.logTrace(507897282,A.k.Verbose,"Upload Bytes To Session - Success [SessionId=".concat(e.id,"]")),c}catch(u){var a,c,l,d;const t=u;return e=e.setProperty("lastUploadRequestSucceeded",!1),this.dispatcher.dispatchAction(new g.$(t.response,null!==(a=null===(c=t.response)||void 0===c?void 0:c.statusText)&&void 0!==a?a:"",null!==(l=null===(d=t.error)||void 0===d?void 0:d.message)&&void 0!==l?l:"",e)),this.loggers.traceLogger.logTrace(507897281,A.k.Warning,"Upload Bytes To Session - Fail [SessionId=".concat(e.id,"]").concat((0,L.s8)(u))),Promise.reject(u)}}async getGroupDocumentsInFolder(e,t){const s=this.getCurrentViewIds();return this.getGroupDocumentsInFolderPaged(e,t,s)}async fetchTaskReferenceThumbnails(e,t,s){if(this.loggers.traceLogger.logTrace(507897280,A.k.Verbose,"Fetch TaskReference Thumbnails]"),null==t)return[];const r=s.map((e=>this.fetchTaskReferenceThumbnail(e,t))),o=[];return(await Promise.allSettled(r)).forEach((e=>{"fulfilled"===e.status&&null!=e.value&&o.push(e.value)})),this.loggers.traceLogger.logTrace(507897251,A.k.Verbose,"Fetch TaskReference Thumbnails - Success]"),o}async getGroupDocumentsInFolderPaged(e,t,s,r){try{const o=await this.webApiProviders.graph(),i=await o.getGroupDocumentsInFolderPaged({groupId:e,folderId:t,skipToken:r},s);return this.dispatcher.dispatchAction(new p.W(e,t,i.data)),i.skipToken?this.getGroupDocumentsInFolderPaged(e,t,s,i.skipToken):(this.loggers.traceLogger.logTrace(507897250,A.k.Verbose,"Get GroupDocuments in Folder - Success [GroupId=".concat(e,"][FolderId=").concat(t,"]")),i)}catch(o){const s=o;return this.loggers.traceLogger.logTrace(507897249,A.k.Warning,"Get GroupDocuments in Folder - Fail [GroupId=".concat(e,"][FolderId=").concat(t,"]").concat((0,L.s8)(s))),Promise.reject(s)}}async fetchTaskReferenceThumbnail(e,t){if(null==t||null==e)return null;const s=t.getWorkloadUrl(k.P[k.P.Documents]);if(null==s)return null;const r=this.stores.groupDocumentsStore.getDriveItemThumbnail(t.id,e.url);if(null!=r)return r;let o=null;try{o=e.getItemPath(s)}catch(l){return this.loggers.traceLogger.logTrace(507648161,A.k.Warning,l.message),null}if(!U.o.isPlexTempId(e.url)&&e.isAttachmentPreviewable()&&null!=o)try{return await this.getDriveItemThumbnail(t.id,e.url,o)}catch(l){const s=l;var i,n,a,c;if(!(s.error instanceof b.U))this.dispatcher.dispatchAction(new m.z(t.id,e.url,s.response,null!==(i=null===(n=s.response)||void 0===n?void 0:n.statusText)&&void 0!==i?i:"",null!==(a=null===(c=s.error)||void 0===c?void 0:c.message)&&void 0!==a?a:""));return Promise.reject(l)}return null}async fetchTaskFormResponseThumbnail(e,t){const s=t.getWorkloadUrl(k.P[k.P.Documents]);if(null==s)return null;const r=e.slice(e.lastIndexOf(".")+1);if(-1===C()(y.ig,r))return null;const o=this.stores.groupDocumentsStore.getDriveItemThumbnail(t.id,e);if(null!=o)return o;const i=decodeURIComponent(s),n=decodeURIComponent(e).replace(i,"");try{return await this.getDriveItemThumbnail(t.id,e,n)}catch(u){const s=u;var a,c,l,d;if(!(s.error instanceof b.U))this.dispatcher.dispatchAction(new m.z(t.id,e,s.response,null!==(a=null===(c=s.response)||void 0===c?void 0:c.statusText)&&void 0!==a?a:"",null!==(l=null===(d=s.error)||void 0===d?void 0:d.message)&&void 0!==l?l:""));return Promise.reject(u)}}async fetchTaskFormResponseThumbnails(e,t){let s=[];const r=P.V.getLatestResponseAnswers(e);e.questions.forEach((e=>{if(e.questionType===D.x.FileUpload){var o;const i=null===(o=r.find((t=>t.questionId===e.id)))||void 0===o?void 0:o.answer1,n=(i?P.V.getImageUrls(i):[]).map((e=>this.fetchTaskFormResponseThumbnail(e,t)));s=s.concat(n)}}));const o=[];return(await Promise.allSettled(s)).forEach((e=>{"fulfilled"===e.status&&null!=e.value&&o.push(e.value)})),this.loggers.traceLogger.logTrace(507839184,A.k.Verbose,"Fetch Task Form Response Thumbnails - Success [groupId=".concat(t.id,"][formId=").concat(e.formId,"]")),o}async fetchFormResponse(e,t){try{let s;if(F.B.isUnoContext&&this.webApiProviders.retailService){const r=await this.webApiProviders.retailService();s=await r.fetchFormResponseAsync({taskId:e,formId:t})}else{const r=await this.webApiProviders.taskService();s=await r.getFormResponseAsync({taskId:e,formId:t})}return this.loggers.traceLogger.logTrace(507839182,A.k.Verbose,"Fetch Form Response - Success [FormId=".concat(t,"][TaskId=").concat(e,"]")),this.dispatcher.dispatchAction(new v.h(e,t,s)),s}catch(n){var s,r,o,i;const a=n;return this.dispatcher.dispatchAction(new I.f(a.response,null!==(s=null===(r=a.response)||void 0===r?void 0:r.statusText)&&void 0!==s?s:"",null!==(o=null===(i=a.error)||void 0===i?void 0:i.message)&&void 0!==o?o:"",e,t)),this.loggers.traceLogger.logTrace(507839181,A.k.Warning,"Fetch Form Response - Fail [FormId=".concat(t,"][TaskId=").concat(e,"] ").concat((0,L.s8)(a))),Promise.reject(a)}}}},61035:(e,t,s)=>{s.d(t,{V:()=>o});class r{constructor(e){this.id=e.id,this.order=e.order,this.title=e.title,this.titleRT=e.titleRT,this.subtitle=e.subtitle,this.subtitleRT=e.subtitleRT,this.questionType=e.questionType}}r.fromWebResource=e=>new r({id:e.id,order:e.order,title:e.title,titleRT:e.formsProRTQuestionTitle,subtitle:e.subtitle,subtitleRT:e.formsProRTSubtitle,questionType:e.type});class o{static getLatestResponse(e){return e.responses[0]}static getLatestResponseAnswers(e){let t=[];const s=this.getLatestResponse(e);if(null!==s&&void 0!==s&&s.answers)try{t=JSON.parse(s.answers)}catch(r){throw new Error("Failed to parse form response answers: ".concat(s.answers,", Error: ").concat(r))}return t}constructor(e){this.formId=e.formId,this.displayName=e.displayName,this.questions=e.questions,this.responses=e.responses,this.formWebUrl=e.formWebUrl,this.formResponse=e.formResponse}}o.getImageUrls=e=>{try{return JSON.parse(e).map((e=>e.link))}catch(t){throw new Error("Failed to parse form response file upload answer: ".concat(e,", Error: ").concat(t))}},o.fromWebResource=e=>new o({formId:e.formId,displayName:e.displayName,questions:e.questions.map((e=>r.fromWebResource(e))),responses:e.responses,formWebUrl:e.formWebUrl,formResponse:e.formResponse})},715:(e,t,s)=>{var r;s.d(t,{x:()=>r}),function(e){e.Rating="Question.Rating",e.Date="Question.DateTime",e.FileUpload="Question.FileUpload",e.Choice="Question.Choice",e.Text="Question.TextField",e.Ranking="Question.Ranking",e.MatrixChoiceGroup="Question.MatrixChoiceGroup",e.MatrixChoice="Question.MatrixChoice",e.NetPromoterScore="Question.NPS"}(r||(r={}))}}]);
//# sourceMappingURL=driveitemmodule.93b2822e.chunk.js.map