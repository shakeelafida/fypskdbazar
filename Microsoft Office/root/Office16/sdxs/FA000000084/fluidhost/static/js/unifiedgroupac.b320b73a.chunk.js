"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[92796],{36591:(e,t,o)=>{o.d(t,{C:()=>r});class r{constructor(e,t,o,r,i){this.dispatcher=e,this.logicModuleProviders=t,this.entityStoreSet=o,this.clientSettings=r,this.loggers=i}}},13155:(e,t,o)=>{o.r(t),o.d(t,{UnifiedGroupActionCreator:()=>O});var r=o(32512),i=o(32084),n=o(72261),s=o(63148),a=o(65060),l=o(33701),d=o(36591),c=o(38752),u=o(78332),h=o(7811),p=o(64226),v=o(96891),f=o(95783),g=o(45078),P=o(65818),G=o(44430),M=o(40468),T=o(95810),y=o(219),m=o(18113),I=o(55491),w=o.n(I),C=o(54320),F=o.n(C),S=o(28673),E=o.n(S),A=o(33411),U=o.n(A),x=o(9376),b=o.n(x),N=o(86178),D=o.n(N),R=o(51171),k=o(79537),L=o(74844),q=o(91246),_=o(52274),j=o(54439),W=o(82841),B=o(30035);class O extends d.C{get name(){return v.M.UnifiedGroupActionCreator}fetchGroup(e,t,o){this.fetchGroupInternal(e,t,o).catch((()=>{}))}fetchGroupPhoto(e){this.logicModuleProviders.unifiedGroupModule().then((t=>{t.fetchPhotosForGroupSet([e]).catch((()=>{}))}))}async ensureGroupPhotoForPlan(e){(await this.logicModuleProviders.planModule()).fetchPlanAsync(e,!1,m.Q.Priority10).then((t=>{const o=this.entityStoreSet.planStore.getContainerIdForPlan(e);t.plan.container.containerType===P.K.Group&&o&&this.fetchGroupPhoto(o)}),(t=>{this.loggers.traceLogger.logTrace(507880094,L.k.Warning,"Cannot load plan [planId=".concat(e,"]").concat((0,W.s8)(t),"[StackTrace=").concat(k.f.getStackTrace(t.error),"]"))}))}fetchJoinedPlans(e){const t=this.entityStoreSet.userStore.getUserDetailsById(this.entityStoreSet.appContextStore.getCurrentUserId());this.fetchFavoritePlansForCurrentUserAsync(!!e);const o=t?E()(t.recentPlans.references):[];this.fetchRecentPlansForCurrentUserAsync(),0===o.length&&this.fetchAllPlansForUser()}async fetchFavoritePlansForCurrentUserAsync(e){const t=await this.logicModuleProviders.planModule(),o=await this.logicModuleProviders.notificationModule();t.fetchFavoritePlansAsync().then((async t=>{const[o,r]=await Promise.all([this.logicModuleProviders.taskModule(),this.logicModuleProviders.containerModule()]);w()(t,(t=>{e&&o.fetchPlanTasksAsync(t.id).catch((e=>{this.loggers.traceLogger.logTrace(507880093,L.k.Warning,"Failed Fetch Plan Tasks ".concat((0,W.s8)(e)))})),r.fetchContainer(t.plan.container,!0).catch((e=>{this.loggers.traceLogger.logTrace(507880092,L.k.Warning,"Failed Fetch Container ".concat((0,W.s8)(e)))}))}))}),(e=>{var t,r;const i=null===(t=e.response)||void 0===t?void 0:t.status,n=null===(r=e.response)||void 0===r?void 0:r.statusText;o.showErrorInternal(p.fc.GetJoinedGroupsError,i,n,void 0,e.response)}))}async fetchRecentPlansForCurrentUserAsync(){const e=await this.logicModuleProviders.planModule(),t=await this.logicModuleProviders.notificationModule();e.fetchRecentPlansAsync().then((async e=>{const t=this.entityStoreSet.appContextStore.getCurrentUserId(),o=this.entityStoreSet.userStore.getUserDetailsById(t),r=o?E()(o.favoritePlans.references):[],i=await this.logicModuleProviders.containerModule();w()(e,(e=>{-1===r.indexOf(e.id)&&i.fetchContainer(e.plan.container,!0).catch((e=>{this.loggers.traceLogger.logTrace(507880091,L.k.Warning,"Failed Fetch Container ".concat((0,W.s8)(e)))}))}))}),(e=>{var o,r;const i=null===(o=e.response)||void 0===o?void 0:o.status,n=null===(r=e.response)||void 0===r?void 0:r.statusText;t.showErrorInternal(p.fc.GetJoinedGroupsError,i,n,void 0,e.response)}))}async fetchPlansForGroup(e){const t=await this.logicModuleProviders.notificationModule();this.logicModuleProviders.unifiedGroupModule().then((o=>{o.fetchPlansForGroup(e).catch((o=>{t.handleRequestFailures(o,[f.t3.NotImplemented],[],p.fc.GetPlansForGroupError,e)}))}))}resolvePlansForGroups(e){this.batchResolveGroupsToPlans(e,!1)}async fetchGroupSensitivityLabel(e){(await this.logicModuleProviders.containerModule()).fetchGroupSensitivityLabelAsync(e).catch((()=>{}))}fetchConversationThreadInGroup(e,t){this.logicModuleProviders.unifiedGroupModule().then((o=>{o.getConversationThreadAsync(e,t).then((async e=>{const t=[];e.forEach((e=>{var o;null!=(null===(o=e.fromField)||void 0===o?void 0:o.emailAddress)&&(this.entityStoreSet.userStore.getUserByEmail(e.fromField.emailAddress.address)||t.push(e.fromField.emailAddress.address))}));(await this.logicModuleProviders.userModule()).fetchUsersAsync(t)}),(o=>{if(!(o.error instanceof _.U)){var n,s,a,l,d;(null===(n=o.response)||void 0===n?void 0:n.status)===f.t3.NotFound&&j.j.completeTransaction(this.dispatcher,{transactionId:t,action:new i.x(e,t)}),this.dispatcher.dispatchAction(new r.v("GET_CONVO_THREAD_FAILED",o.response,null!==(s=null===(a=o.response)||void 0===a?void 0:a.statusText)&&void 0!==s?s:"",null!==(l=null===(d=o.error)||void 0===d?void 0:d.message)&&void 0!==l?l:""))}}))}))}warmUpGroupMailbox(e,t){this.logicModuleProviders.unifiedGroupModule().then((o=>{o.warmUpGroupMailbox(e,t)}))}checkCurrentUserToGroupsMembershipsAsync(e){if(0===e.length)throw new R.L("requestGroupIds");this.logicModuleProviders.unifiedGroupModule().then((t=>{t.checkCurrentUserToGroupsMembershipsAsync(e).catch((()=>{}))}))}async createGroupAndPlan(e,t,o){j.j.beginTransaction(this.dispatcher,{name:"createUnifiedGroup",transactionId:o},this.loggers.logHandler);const r=await this.logicModuleProviders.notificationModule();this.logicModuleProviders.unifiedGroupModule().then((i=>{i.validateNamesBeforeCreateRecursive(e,t.title,0,0).then((n=>{i.createGroup(n).then((async e=>{const s=(t=t.setProperty("title",e.displayName)).toWebSerializable();s.Owner=e.id,s.container.externalId=e.id,s.container.containerType=P.K.Group;const a=T.c.builder.fromWebResource(s).build(),l=M.T.builder.withPlan(a).build(),d=e.setProperty("autoSubscribeNewMembers",n.autoSubscribeNewMembers);(await this.logicModuleProviders.planModule()).createPlanAsync(l,!0).then((async e=>{if(d.autoSubscribeNewMembers){const e=d.setProperty("autoSubscribeNewMembers",!0);i.updateUnifiedGroup(d,e).then((t=>{r.announceUnifiedGroupUpdates(d,e)})).catch((()=>{}))}j.j.completeTransaction(this.dispatcher,{transactionId:o}),r.enqueueHiddenToastNotification("SharedComponents_CreatePlanToastTitle",[],e.plan.title);try{(await this.logicModuleProviders.telemetryModule()).logPlanCreatedUsage(this.name)}catch(t){}}),(e=>{if(!(e.error instanceof _.U)){var t,i;const n=null===(t=e.response)||void 0===t?void 0:t.status,s=null===(i=e.response)||void 0===i?void 0:i.statusText;r.showErrorInternal(p.fc.CreatePlanError,n,s,void 0,e.response,[a.title]),j.j.completeTransactionWithError(this.dispatcher,{transactionId:o,errorMessage:"CREATE_PLAN_FAILED"})}}))}),(t=>{if(!(t.error instanceof _.U)){var i,n;const s=null===(i=t.response)||void 0===i?void 0:i.status,a=null===(n=t.response)||void 0===n?void 0:n.statusText;r.showErrorInternal(p.fc.CreateGroupError,s,a,void 0,t.response,[e.displayName]),j.j.completeTransactionWithError(this.dispatcher,{transactionId:o,errorMessage:"CREATE_GROUP_FAILED"})}}))}),(e=>{j.j.completeTransaction(this.dispatcher,{transactionId:o,action:new n.c(e),additionalData:{errorCode:e}})}))}))}updateTransactionStatusForMovePlan(e,t,o){this.dispatcher.dispatchAction(new s.Z(e,{containerId:t,transactionStatus:o}))}async createGroupAndAddUsersForMovePlan(e,t,o){this.updateTransactionStatusForMovePlan(o,null,y.x.Pending);const[r,i,n]=await Promise.all([this.logicModuleProviders.containerModule(),this.logicModuleProviders.notificationModule(),this.logicModuleProviders.unifiedGroupModule()]);try{const l=await n.validateNamesBeforeCreateRecursive(e,e.displayName,0,0),d=await n.createGroup(l),u={containerType:P.K.Group,externalId:d.id};await this.fetchGroupInternal(d.id,!0,g.tI.FetchGroupDetailsRetryCount);try{await r.addUsersToContainerAsync(u,t),this.updateTransactionStatusForMovePlan(o,u.externalId,y.x.Pending)}catch(c){const e=c;if(!(e.error instanceof _.U)){var s,a;const o=null===(s=e.response)||void 0===s?void 0:s.status,r=null===(a=e.response)||void 0===a?void 0:a.statusText;o===f.t3.NotImplemented?this.loggers.traceLogger.logTrace(507291426,L.k.Error,"addUsersToGroup - Not Implemented"):i.showErrorInternal(p.fc.AddUsersToGroupError,o,r,t.length.toString(),e.response)}}}catch(c){const t=c;if(!(t.error instanceof _.U)){var l,d;const o=null===(l=t.response)||void 0===l?void 0:l.status,r=null===(d=t.response)||void 0===d?void 0:d.statusText;i.showErrorInternal(p.fc.CreateGroupError,o,r,void 0,t.response,[e.displayName])}this.updateTransactionStatusForMovePlan(o,null,y.x.Failed)}}async createTaskConversationThread(e,t,o,r,i){if(!i)throw new R.L("subject");const n=await this.logicModuleProviders.notificationModule();this.logicModuleProviders.unifiedGroupModule().then((s=>{s.createGroupConversationThread(e,t,o,r,i).then((()=>{n.enqueueHiddenToastNotification("SharedComponents_TaskCommentPostedToastTitle")})).catch((t=>{if(!(t.error instanceof _.U)){var o,r;const i=null===(o=t.response)||void 0===o?void 0:o.status,s=null===(r=t.response)||void 0===r?void 0:r.statusText;n.showErrorInternal(p.fc.PostGroupConversationThreadReplyError,i,s,e,t.response)}}))}))}async postReplyInGroupConversationThread(e,t,o,r,i){if(!i)throw new R.L("fallbackSubject");const n=await this.logicModuleProviders.notificationModule();this.logicModuleProviders.unifiedGroupModule().then((s=>{s.postReplyInGroupConversationThread(e,t,o).then((()=>{n.enqueueHiddenToastNotification("SharedComponents_TaskCommentPostedToastTitle")})).catch((s=>{if(!(s.error instanceof _.U)){var l,d;const g=null===(l=s.response)||void 0===l?void 0:l.status,P=null===(d=s.response)||void 0===d?void 0:d.statusText;var c,u,h,v;if(g===f.t3.NotFound)this.handlePostReplyNotFound(e,t,o,r,i,s);else this.dispatcher.dispatchAction(new a.d(e,t,o,s.response,null!==(c=null===(u=s.response)||void 0===u?void 0:u.statusText)&&void 0!==c?c:"",null!==(h=null===(v=s.error)||void 0===v?void 0:v.message)&&void 0!==h?h:"")),n.showErrorInternal(p.fc.PostGroupConversationThreadReplyError,g,P,e,s.response)}}))}))}async joinGroup(e){const t=await this.logicModuleProviders.notificationModule();this.logicModuleProviders.unifiedGroupModule().then((o=>{o.joinGroup(e).catch((o=>{if(!(o.error instanceof _.U)){var i,n,s,a,l,d;const c=null===(i=o.response)||void 0===i?void 0:i.status,u=null===(n=o.response)||void 0===n?void 0:n.statusText;t.showErrorInternal(p.fc.JoinUnifiedGroupError,c,u,e,o.response),this.dispatcher.dispatchAction(new r.v("PLW_JOIN_UNIFIEDGROUP_FAILED",o.response,null!==(s=null===(a=o.response)||void 0===a?void 0:a.statusText)&&void 0!==s?s:"",null!==(l=null===(d=o.error)||void 0===d?void 0:d.message)&&void 0!==l?l:""))}}))}))}async leaveGroup(e){const t=await this.logicModuleProviders.notificationModule();this.logicModuleProviders.unifiedGroupModule().then((o=>{o.leaveGroup(e).catch((o=>{if(!(o.error instanceof _.U)){var i,n,s,a,l,d;const c=null===(i=o.response)||void 0===i?void 0:i.status,u=null===(n=o.response)||void 0===n?void 0:n.statusText;t.showErrorInternal(p.fc.LeaveUnifiedGroupError,c,u,e,o.response),this.dispatcher.dispatchAction(new r.v("PLW_LEAVE_UNIFIEDGROUP_FAILED",o.response,null!==(s=null===(a=o.response)||void 0===a?void 0:a.statusText)&&void 0!==s?s:"",null!==(l=null===(d=o.error)||void 0===d?void 0:d.message)&&void 0!==l?l:""))}}))}))}validateNamesBeforeUpdate(e,t){this.logicModuleProviders.unifiedGroupModule().then((o=>{const r=t.id+u.Ek.ValidateGroupName;t.displayName!==e.displayName?(j.j.beginTransaction(this.dispatcher,{name:"validateNamesBeforeUpdate",transactionId:r},this.loggers.logHandler),o.validateGroupNamesAsync(t,!1).then((o=>{o.errorCode===h.Lg.OK?this.updateUnifiedGroup(e,t):(o.errorCode===h.Lg.MissingPrefixSuffix&&this.dispatcher.dispatchAction(new l._(o.displayNamePrefix||null,o.displayNameSuffix||null,o.mailNicknamePrefix||null,o.mailNicknameSuffix||null)),j.j.completeTransaction(this.dispatcher,{transactionId:r,action:new n.c(o.errorCode),additionalData:{errorCode:o.errorCode}}))}),(()=>{j.j.completeTransactionWithError(this.dispatcher,{transactionId:r,errorMessage:""}),this.updateUnifiedGroup(e,t)}))):this.updateUnifiedGroup(e,t)}))}async fetchGroupInternal(e,t,o){const[r,i]=await Promise.all([this.logicModuleProviders.containerModule(),this.logicModuleProviders.notificationModule()]);try{const o=await r.fetchContainer({externalId:e,containerType:P.K.Group},t);o.unifiedGroupDetails&&!o.unifiedGroupDetails.isFullyProvisioned()&&r.pollForGroupFullyProvisioned(o.unifiedGroupDetails);const n=this.entityStoreSet.appContextStore.getCurrentPlanId(),s=n?this.entityStoreSet.planStore.getContainerIdForPlan(n):this.entityStoreSet.appContextStore.getCurrentGroupId();if(o.unifiedGroupDetails&&o.unifiedGroupDetails.id===s){o.unifiedGroupDetails.currentUserRelationToGroup===G.N.NonMember&&i.showInfoInternal(p.fc.NonMemberInfo)}return o}catch(s){var n;const r=s;return(null===r||void 0===r||null===(n=r.response)||void 0===n?void 0:n.status)===f.t3.NotFound&&null!=o&&o>0?(await(0,B.y)(1e3),this.fetchGroupInternal(e,t,o-1)):(i.handleRequestFailures(r,[],[f.t3.Forbidden,f.t3.NotFound],p.fc.GetUnifiedGroupError,e),Promise.reject(r))}}async fetchAllPlansForUser(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=await this.logicModuleProviders.notificationModule();this.logicModuleProviders.unifiedGroupModule().then((r=>{r.getJoinedGroups(e,t).then((e=>{const t=e.skipToken,o=U()(e.data,(e=>e.id));this.batchResolveGroupsToPlans(o,!1),t&&this.fetchAllPlansForUser(t,!1)}),(e=>{o.handleRequestFailures(e,[f.t3.NotImplemented],[],p.fc.GetJoinedGroupsError,void 0,void 0,void 0)}))}))}batchResolveGroupsToPlans(e,t){if(F()(e))return;const o=this.entityStoreSet.appContextStore.getApiBatchLimits().ResolveGroupsToPlansBatchedAsync,r=e.slice(0);for(;r.length>0;){let e=[];e=r.length<=o?r.splice(0):r.splice(0,o),this.logicModuleProviders.unifiedGroupModule().then((o=>{o.resolveGroupsToPlansBatchedAsync(e).then((async o=>{const r=await this.logicModuleProviders.taskModule(),i=[];b()(e).forEach((e=>{const n=o[e];n&&!F()(n)&&(i.push(...n),t&&n.forEach((e=>{r.fetchPlanTasksAsync(e.id)})))}))}),(()=>{}))}))}}handlePostReplyNotFound(e,t,o,r,n,s){const l=this.entityStoreSet.containerStore.getContainerConversationThread(e,t)||[];let d=!1;if(!F()(l)){const e=l[0].createdDateTime,t=D()().subtract(c.B.clientSettings.MaxConversationCreationPeriod,"second");e.isAfter(t)&&(d=!0)}if(d)setTimeout((()=>{this.loggers.usageLogger.logData("UnifiedGroupActionCreator","RetryingPostReplyOnNewThreadAfterNotFound",{threadId:t}),this.postReplyInGroupConversationThread(e,t,o,r,n)}),5e3);else{var u,h,p,v;this.loggers.usageLogger.logData("UnifiedGroupActionCreator","CreatingNewThreadAfterNotFound",{threadId:t});const l=s;this.dispatcher.dispatchAction(new a.d(e,t,o,l.response,null!==(u=null===(h=l.response)||void 0===h?void 0:h.statusText)&&void 0!==u?u:"",null!==(p=null===(v=l.error)||void 0===v?void 0:v.message)&&void 0!==p?p:"")),this.dispatcher.dispatchAction(new i.x(e,t)),this.createTaskConversationThread(e,q.o.generate(),o,r,n)}}async updateUnifiedGroup(e,t){const o=await this.logicModuleProviders.unifiedGroupModule(),r=await this.logicModuleProviders.notificationModule();o.updateUnifiedGroup(e,t).then((o=>{r.announceUnifiedGroupUpdates(e,t)})).catch((t=>{if(!(t.error instanceof _.U)){var o,i;const n=null===(o=t.response)||void 0===o?void 0:o.status,s=null===(i=t.response)||void 0===i?void 0:i.statusText;r.showErrorInternal(p.fc.UpdateUnifiedGroupError,n,s,e.id,t.response)}}))}constructor(e,t,o,r){super(e,t,o,c.B.clientSettings,r)}}},30035:(e,t,o)=>{async function r(e){return new Promise((t=>setTimeout(t,e)))}o.d(t,{y:()=>r})},54439:(e,t,o)=>{o.d(t,{j:()=>d});var r=o(29274),i=o(74427),n=o(57860),s=o(47204),a=o(74568),l=o(79947);class d{static beginTransaction(e,t,o){let{transactionId:i,name:n,logQos:s,action:l,additionalData:c}=t;if(!0===s){const e=new a.W({name:"Tx:"+n},o);d.qosEventsInFlight[i]=e}e.batchDispatchActions(new r.S(n,i,c),l)}static cancelTransaction(e,t){let{transactionId:o,action:r,additionalData:n}=t;const s=d.qosEventsInFlight[o];s&&(s.end({resultType:l.f.ExpectedFailure,extraData:n}),delete d.qosEventsInFlight[o]),e.batchDispatchActions(r,new i.D(o,n))}static completeTransaction(e,t){let{transactionId:o,action:r,additionalData:i}=t;const s=d.qosEventsInFlight[o];s&&(s.end({resultType:l.f.Success,extraData:i}),delete d.qosEventsInFlight[o]),e.batchDispatchActions(r,new n.M(o,i))}static completeTransactionWithBatch(e,t){let{transactionId:o,actions:r,additionalData:i}=t;const s=d.qosEventsInFlight[o];s&&(s.end({resultType:l.f.Success,extraData:i}),delete d.qosEventsInFlight[o]),e.batchDispatchActions(...r,new n.M(o,i))}static completeTransactionWithError(e,t){let{transactionId:o,errorMessage:r,action:i,additionalData:n}=t;const a=d.qosEventsInFlight[o];a&&(a.end({resultType:l.f.Failure,error:r,extraData:n}),delete d.qosEventsInFlight[o]),e.batchDispatchActions(i,new s.Y(o,r,n))}}d.qosEventsInFlight={}}}]);
//# sourceMappingURL=unifiedgroupac.b320b73a.chunk.js.map