/*! For license information please see SharepointNotificationService.a3001fa8.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[33884],{87934:(e,t,n)=>{n.r(t),n.d(t,{SharepointNotificationService:()=>jo});var r=n(51238),o=n(95996),i=n(33788),s=n(60835);const a="writeToJsonObject",c="writeToFacetJsonObject",u="processJsonObject";function d(e){return null!==e&&"undefined"!==typeof e}function l(e,t){return(t|=0)<e.Min?e.Min:t>e.Max?e.Max:t}function p(e,t,n){return d(t)?Array.isArray(t)?B(t,n,((t,n)=>p(e,t,n))):l(e,t):null}p.bind(null,{Min:-128,Max:127}),p.bind(null,{Min:0,Max:255}),p.bind(null,{Min:-32768,Max:32767});const f={Min:0,Max:65535},h=(p.bind(null,f),p.bind(null,{Min:-2147483648,Max:2147483647})),m=p.bind(null,{Min:0,Max:4294967295}),v={Min:Number.MIN_SAFE_INTEGER,Max:Number.MAX_SAFE_INTEGER},I=(p.bind(null,v),{Min:0,Max:Number.MAX_SAFE_INTEGER});p.bind(null,I);const C=function(e,t){return d(e)?Array.isArray(e)?B(e,t,C):e:null},g=function(e,t){return d(e)?Array.isArray(e)?B(e,t,g):d(e)&&""!==e?e:null:null},y=function(e,t){return d(e)?Array.isArray(e)?B(e,t,y):g(e.toISOString(),t):null},P=new Date(0);class S{constructor(e){this.value=e}static createNew(){return new S("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})))}toString(){return this.value}valueOf(){return this.toString().toLowerCase()}}S.Empty=new S("00000000-0000-0000-0000-000000000000");const A=function(e,t){return d(e)?Array.isArray(e)?B(e,t,A):e!==S.Empty?g(e.toString(),t):null:null},T=S.Empty;function w(e){return function(e){return null!==e&&["number","string","boolean","object"].indexOf(typeof e)>=0}(e)&&!Array.isArray(e)}function x(e){return null!==e&&"object"===typeof e&&!Array.isArray(e)}function N(e){if(x(e)){const t={};for(const n in e)t[n]=N(e[n]);return t}if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;++n){let r=e[n];w(r)&&t.push(r)}return t}return e}const R=function(e,t){return d(e)?Array.isArray(e)?B(e,t,R):N(e):null};class b{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.Major=e,this.Minor=t,this.Build=n,this.Revision=r}toString(){let e=this.Major+"."+this.Minor;return(this.Build>0||this.Revision>0)&&(e+="."+this.Build,this.Revision>0&&(e+="."+this.Revision)),e}valueOf(){function e(e){return(e>>12&15).toString(16)+(e>>8&15).toString(16)+(e>>4&15).toString(16)+(15&e).toString(16)}return e(this.Major)+e(this.Minor)+e(this.Build)+e(this.Revision)}}const D=function(e,t){return d(e)?Array.isArray(e)?B(e,t,D):g(e.toString(),t):null};new b;function O(e){const t=[];for(let n=0;n<e;++n)t.push(n);return t}function U(e){const t=[];for(let n=0;n<e;++n)t.push(1<<n);return t}function k(e){return Object.keys(e).sort(((t,n)=>e[t]-e[n]))}function E(e){return Object.keys(e).filter((e=>"None"!==e)).sort(((t,n)=>e[t]-e[n]))}function M(e,t,n,r){if(!d(e))return null;if(Array.isArray(e))return B(e,r,((e,r)=>M(e,t,n,r)));if(8&r)return m(e,r);const o=Math.min(t.length,n.length);for(let i=0;i<o;++i)if(t[i]===e)return g(n[i],r);return g(e.toString(),r)}function L(e,t,n,r){if(!d(e))return null;if(Array.isArray(e))return B(e,r,((e,r)=>L(e,t,n,r)));if(8&r)return m(e,r);const o=[],i=Math.min(t.length,n.length);for(let s=0;s<i;++s){const r=t[s];if(e&r&&(o.push(n[s]),(e&=~r)<1))break}return e>0&&o.push(e.toString()),o.length<1?g("None",r):g(o.join(","),r)}function F(e,t){return e&t}function V(e,t){return e|t}function W(e){return~e}function B(e,t,n){if(!d(e)||e.length<1)return null;const r=[];for(const o of e){const e=n(o,t);d(e)&&!Array.isArray(e)&&r.push(e)}return r}const j=function(e){return 16777215&(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)|(255&e)<<24|4},H=function(e){return(-16777216&e)>>24};function _(e,t){try{return t(e)}finally{e.exit()}}class G{constructor(){this.artifacts=new Map,this.parent=G.current,G.current=this}static getOrCreateArtifact(e,t){for(let r=G.current;r;r=r.parent){const e=r.artifacts.get(t);if(e)return e}const n=e();return d(G.current)&&G.current.artifacts.set(t,n),n}exit(){G.current=this.parent}}G.current=null;const J=Symbol();function K(){return{SettingProvider:{getSetting:(e,t)=>t}}}function q(){return G.getOrCreateArtifact(K,J)}const X=function(e,t){return d(e)?Array.isArray(e)?B(e,t,X):e.toJsonValue(t):null},z=function(e,t,n){return d(e)?Array.isArray(e)?B(e,t,((e,t)=>z(e,t,n))):(1&t||4&t||e.TypeName!=n||(t|=1),e.toJsonValue(t)):null};function Q(e,t,n,r){if(d(n))for(const o of n){let t=e[o];x(t)||(e[o]=t={}),e=t}d(r)&&(e[t]=r)}class Y{update(e){}toJsonValue(e){const t=function(e,t){return 1&t||4&t?{}:2&t?{__metadata:{type:e}}:{__type:e}}(this.TypeName,e);return this[u](t,e,this[a],this[c]),t}toFacetJsonValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.toJsonValue(j(e,t))}toJson(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return JSON.stringify(this.toJsonValue(e))}toFacetJson(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.toJson(j(e,t))}[a](e,t){}[c](e,t){}[u](e,t,n,r){_(new G,(()=>{4&t?r.call(this,e,t):n.call(this,e,t)}))}}class $ extends Y{constructor(){super(...arguments),this.TypeClassification=2}}class Z{static convertTo(e,t){return pe(t)}}class ee{static getOrCreate(){return G.getOrCreateArtifact(ee.create,ee.artifactId)}static getPersonIndex(e){return d(e)?ee.findPerson(e):null}static addPerson(e){if(d(e)){let o=ee.findAndUpdatePerson(e);d(o)||(o=new mn,ee.updatePerson(o,e),ee.getOrCreate().push(o));for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const e of n)d(o.Roles)?o.Roles.indexOf(e)<0&&o.Roles.push(e):o.Roles=[e]}}static addPeople(e){if(d(e)){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const t of e)ee.addPerson(t,...n)}}static create(){return[]}static findAndUpdatePerson(e){const t=ee.findPerson(e);if(t>=0){const n=ee.getOrCreate()[t];return ee.updatePerson(n,e),n}return null}static findPerson(e){const t=ee.getOrCreate();for(var n=0;n<t.length;++n){const r=t[n];if(d(r.Provider)&&""!==r.Provider){if(r.Provider===e.Provider&&r.Id===e.Id)return n;if(d(e.Provider)&&""!==e.Provider)continue}if(d(r.Email)&&""!==r.Email){if(r.Email===e.Email)return n;if(d(e.Email)&&""!==e.Email)continue}if(d(r.Name)&&""!==r.Name&&r.Name===e.Name)return n}return-1}static updatePerson(e,t){d(e.Provider)&&""!==e.Provider||(e.Provider=t.Provider,e.Id=t.Id),d(e.Email)&&""!==e.Email||(e.Email=t.Email),d(e.Name)&&""!==e.Name||(e.Name=t.Name)}}ee.artifactId=Symbol();class te{static convertToArray(e,t){const n=ee.getOrCreate();return t instanceof or?(ee.addPerson(t.Creator,"Creator","InThread"),ee.addPeople(t.AnchorCreators,"AnchorCreator"),ee.addPerson(t.ParentAuthor,"RepliedTo","InThread"),ee.addPeople(t.Participants,"InThread"),ee.addPerson(t.TaskCreator,"TaskCreator"),ee.addPeople(t.TaskAssignees,"ExistingAssignee"),te.processCommentPreview(t.Preview),n):t instanceof rr?(ee.addPerson(t.Creator,"Creator"),ee.addPeople(t.AnchorCreators,"AnchorCreator"),ee.addPerson(t.TaskCreator,"TaskCreator"),ee.addPeople(t.TaskAssignees,"ExistingAssignee"),te.processCommentPreview(t.Preview),n):t instanceof nr?(ee.addPerson(t.Creator,"Creator"),ee.addPerson(t.Mentionee,"Mentioned"),ee.addPerson(t.TaskCreator,"TaskCreator"),ee.addPeople(t.TaskAssignees,"ExistingAssignee"),te.processCommentPreview(t.CommentPreview),n):t instanceof Jn?(ee.addPerson(t.Creator,"Creator"),ee.addPerson(t.Mentionee,"Mentioned"),n):t instanceof sr?(ee.addPerson(t.Creator,"Creator"),ee.addPerson(t.CommentThreadCreator,"CommentThreadCreator"),ee.addPeople(t.Assignees,"NewAssignee"),te.processCommentPreview(t.CommentPreview),n):t instanceof cr?(ee.addPerson(t.Creator,"Creator"),ee.addPerson(t.TaskCreator,"TaskCreator"),ee.addPeople(t.Assignees,"ExistingAssignee"),ee.addPeople(t.NewAssignees,"NewAssignee"),te.processCommentPreview(t.CommentPreview),n):t instanceof ar?(ee.addPerson(t.Creator,"Creator"),ee.addPerson(t.TaskCreator,"TaskCreator"),ee.addPeople(t.Assignees,"ExistingAssignee"),te.processCommentPreview(t.CommentPreview),n):t instanceof ur?(ee.addPerson(t.Creator,"Creator"),ee.addPerson(t.TaskCreator,"TaskCreator"),ee.addPeople(t.Assignees,"Assignee"),ee.addPeople(t.PreviousAssignees,"PreviousAssignee"),n):t instanceof dr?(ee.addPerson(t.Creator,"Creator"),n):t instanceof pr?(ee.addPerson(t.Creator,"Creator"),ee.addPerson(t.CommentCreator,"CommentCreator"),ee.addPerson(t.LatestReactor,"LatestReactor"),n):t instanceof hr?(ee.addPerson(t.Creator,"Creator"),ee.addPeople(t.NudgedUsers,"NudgedUser"),n):t instanceof mr?(ee.addPerson(t.Creator,"Creator"),ee.addPeople(t.Mentionees,"Mentioned"),ee.addPeople(t.PreviousMentionees,"PreviousMentionee"),n):t instanceof fr?(ee.addPerson(t.Creator,"Creator"),ee.addPerson(t.LatestReactor,"LatestReactor"),ee.addPeople(t.TargetActors,"TargetActor"),n):t instanceof vr?(ee.addPerson(t.Creator,"Creator"),ee.addPeople(t.Actors,"Actor"),n):t instanceof Ir?(ee.addPerson(t.Creator,"Creator"),n):t instanceof Cr?(ee.addPerson(t.Creator,"Creator"),ee.addPeople(t.Recipients,"Recipient"),te.processPersonStateInfo(t.ContentStateInfo),n):n}static processCommentPreview(e){if(d(e))if(te.processPreviewFragment(e.Anchor,"AnchorCreator"),e instanceof tr){if(te.processPreviewFragment(e.Comment,"CommentCreator","InThread"),te.processPreviewFragment(e.RootComment,"RepliedTo","InThread"),d(e.RecentComments))for(const t of e.RecentComments)te.processPreviewFragment(t,"InThread")}else te.processPreviewFragment(e.Comment,"CommentCreator")}static processPreviewFragment(e){if(d(e)){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];ee.addPerson(e.Creator,...n)}}static processPersonStateInfo(e){e instanceof Tr&&d(e)&&ee.addPeople(e.Person,"RuleTrigger")}}class ne{static convertToOptional(e,t){return!!de(t)||t.NotifiedInBand}}class re{static convertTo(e,t){if(t instanceof qn&&d(t.Data)){const e="Office"+pe(t.Data);return t.Data instanceof Gn?e+On(t.Data.Action,0):e}return pe(t)}}class oe{static convertTo(e,t){return t instanceof qn&&d(t.Data)&&d(t.Data.SourceAppId)?t.Data.SourceAppId.toString():d(t.SourceAppId)?t.SourceAppId.toString():"3d9f2b8c-fab8-4011-a098-2652bdd0b55d"}}class ie{static convertTo(e,t){switch(t.SourcePlatform){case Rn.Win32:case Rn.WinRT:case Rn.Windows:return yn.Windows;case Rn.Android:return yn.Android;case Rn.Mac:return yn.MacOS;case Rn.iOS:return yn.iOS;case Rn.Linux:return yn.Linux;case Rn.tvOS:return yn.tvOS;default:return yn.Unknown}}}class se{static convertTo(e,t){var n;if(!d(t)||!d(t.Creator)||!d(t.Creator.RawId)&&t.Creator.RawIdKind!=En.Self)return null;const r=new Sn,o=t.Creator.RawProvider==Un.LiveId,i=null!==(n=t.Creator.RawId)&&void 0!==n?n:"";return r.IdKind=o?vn.MSA:vn.AAD,r.TenantId=t.Creator.TenantId,d(t.Creator.RawIdKind)?t.Creator.RawIdKind==En.OID?r.Id=o?"OID:"+i:i:t.Creator.RawIdKind==En.PUID?r.Id=o?i:"PUID:"+i:t.Creator.RawIdKind==En.CID?r.Id="CID:"+i:r.Id="Self":r.Id=o?"CID:"+i:i,r}}class ae{static convertTo(e,t){return t.TypeClassification}}class ce{static convertToOptional(e,t){if(!le(t))return t.NotifiedInBand}}class ue{static convertToOptional(e,t){if(le(t))return!0}}function de(e){return e instanceof jn&&(!!q().SettingProvider.getSetting("SendSignalToONotifyViaPreprocessor",!1)&&(!!function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const o of n)if(0===F(e,o))return!1;return!0}(function(e){return F(q().SettingProvider.getSetting("Pipelines."+e.TypeName,e.DefaultPipelines),e.AllowedPipelines)}(e),Vn.Substrate)&&(!d(e.NotifiedInBand)||!e.NotifiedInBand)))}function le(e){return e instanceof qn&&(!!d(e.Data)&&de(e.Data))}function pe(e){let t=e.TypeName,n="";const r=t.lastIndexOf(".");return r>=0&&(n=t.substring(0,r),t=t.substring(r+1)),"Common"===n?t:n+t}const fe="Name",he="Email",me="Provider",ve="PictureUrl",Ie="Roles",Ce="User",ge="Unknown",ye="File",Pe="Windows",Se="Android",Ae="Linux",Te="tvOS",we="IdKind",xe="TenantId",Ne="DriveId",Re="DriveItemId",be="SiteUrl",De="SiteId",Oe="WebId",Ue="ListId",ke="ItemId",Ee="Unspecified",Me="Count",Le="CustomerContent",Fe="EUII",Ve="Completed",We="InProgress",Be="None",je="RawProvider",He="RawId",_e="RawIdKind",Ge="Created",Je="Observed",Ke="SourceApp",qe="SourcePlatform",Xe="SourceSessionId",ze="Timestamp",Qe="ActivitySource",Ye="PreprocessorOptions",$e="Creator",Ze="CustomProperties",et="Application",tt="AppName",nt="SourceAppVersion",rt="Device",ot="SourceAppContext",it="NotifiedInBand",st="SuppressSendToSubstrate",at="SensitivityLabelId",ct="ContentId",ut="Data",dt="NavigationId",lt="Action",pt="StartTime",ft="EndTime",ht="Status",mt="Locale",vt="Item",It="NotStarted",Ct="Title",gt="DueDate",yt="Priority",Pt="Table",St="Content",At="Common.PreviewOptions",Tt="Anchor",wt="Comment",xt="ThreadId",Nt="CommentThreadId",Rt="Options",bt="Common.CommentPreview",Dt="ThreadLength",Ot="RootComment",Ut="RecentComments",kt="CommentThreadIsTask",Et="CommentPreview",Mt="Preview",Lt="CommentPreviewAbsenceReason",Ft="PreviewAbsenceReason",Vt="TaskCreatedDate",Wt="Updates",Bt="LatestEmoji",jt="EmojiCounts",Ht="LatestReaction",_t="ReactionCounts",Gt="TargetId",Jt="TargetPreview",Kt="TotalReactorCount",qt="NudgeEmoji",Xt="MessagePreview",zt="State",Qt="StatusLabel",Yt="PreviousState",$t="Source",Zt="ComponentEdit",en="CorrelationId",tn="ContainerKind",nn="ContentChangeRuleTriggered",rn="ContentSourceName",on="ContentStateInfo",sn="ActivityCompliance",an="Purple",cn="Green",un="Pink",dn="Orange",ln=Object.assign,pn=0,fn=2,hn=3;class mn extends Y{constructor(){super(),this.TypeName="Unified.Person"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,"Id",null,g(this.Id,t)),Q(e,fe,null,g(this[fe],t)),Q(e,he,null,g(this[he],t)),Q(e,me,null,g(this[me],t)),Q(e,ve,null,g(this[ve],t)),Q(e,Ie,null,g(this[Ie],t)))}}!function(e){const t=O(2),n=k(e)}({[Ce]:0,System:1});const vn={AAD:0,MSA:1},In=function(e){const t=O(2),n=k(e);return(e,r)=>M(e,t,n,r)}(vn),Cn={[ge]:0,EXO:1,SPO:2,OXO:3,MileIQ:4,AFS:5,Teams:6,Stream:7,ODB:8,MicrosoftPowerBI:9,Yammer:10},gn=function(e){const t=O(11),n=k(e);return(e,r)=>M(e,t,n,r)}(Cn),yn=(function(e){const t=O(4),n=k(e)}({[ge]:0,Message:1,[ye]:2,Calendar:3}),{[ge]:0,[Pe]:1,[Se]:2,iOS:3,MacOS:4,[Ae]:5,[Te]:6}),Pn=function(e){const t=O(7),n=k(e);return(e,r)=>M(e,t,n,r)}(yn);class Sn extends Y{constructor(){super(),this.TypeName="SIGS.Actor",this[we]=0}[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||(Q(e,"ActorIdType",null,In(this[we],t)),Q(e,"ActorId",null,g(this.Id,t)),Q(e,"AadTenantId",null,g(this[xe],t)),Q(e,"ActorType",null,g(Ce,t)))}}class An extends Y{[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||Q(e,"Url",null,g(this.Url,t))}}class Tn extends An{constructor(){super(),this.TypeName="SIGS.GraphDocumentInfo"}[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||(Q(e,Ne,null,g(this[Ne],t)),Q(e,Re,null,g(this[Re],t)))}}class wn extends Tn{constructor(){super(),this.TypeName="SIGS.SharePointDocumentInfo"}[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||(Q(e,be,null,g(this[be],t)),Q(e,xe,null,A(this[xe],t)),Q(e,De,null,A(this[De],t)),Q(e,Oe,null,A(this[Oe],t)),Q(e,Ue,null,A(this[Ue],t)),Q(e,ke,null,A(this[ke],t)))}}const xn={[ge]:0,Word:1,Excel:2,PowerPoint:3,Outlook:4,OneNote:5,FluidApp:6,Visio:7,Planner:8,Whiteboard:9,TeamsApp:10},Nn=function(e){const t=O(11),n=k(e);return(e,r)=>M(e,t,n,r)}(xn),Rn={[ge]:0,Win32:1,WinRT:2,[Se]:3,Mac:4,iOS:5,Web:6,Server:7,[Pe]:8,[Ae]:9,[Te]:10},bn=function(e){const t=O(11),n=k(e);return(e,r)=>M(e,t,n,r)}(Rn),Dn=(function(e){const t=O(3),n=k(e)}({[Ee]:0,EditSession:1,PreExisting:2}),{Create:0,Update:1,Delete:2}),On=function(e){const t=O(3),n=k(e);return(e,r)=>M(e,t,n,r)}(Dn),Un={[ge]:0,LiveId:1,OrgId:2,ActiveDirectory:3,ADAL:4,SSPI:5,OAuth2:6,Badger:7,[Me]:8},kn=function(e){const t=O(9),n=k(e);return(e,r)=>M(e,t,n,r)}(Un),En={OID:0,PUID:1,CID:2,Self:3},Mn=function(e){const t=O(4),n=k(e);return(e,r)=>M(e,t,n,r)}(En),Ln=function(e){const t=O(12),n=k(e),r=[[n[0],"AccessControl",n[2],n[3],n[4],n[5],n[6],n[7],n[8],"SystemMetaData",n[10],n[11]]],o=new Map([[fn,r[0]],[hn,r[0]]]),i=e=>4&e?(e=>{var t;return null!==(t=o.get(e))&&void 0!==t?t:n})(H(e)):n;return(e,n)=>M(e,t,i(n),n)}({[Ee]:0,AccessControlData:1,[Le]:2,[Fe]:3,SupportData:4,AccountData:5,PublicPersonalData:6,EUPI:7,OII:8,SystemMetadata:9,PublicNonPersonalData:10,[Me]:11}),Fn=function(e){const t=O(3),n=k(e);return(e,r)=>M(e,t,n,r)}({[Ve]:0,[We]:1,CompletedMissingStart:2}),Vn={[Be]:0,Host:1,Substrate:2};!function(e){const t=U(2),n=E(e)}(Vn);class Wn extends Y{constructor(){super(),this.TypeName="Base.UserInfo"}[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||(Q(e,"Id",null,g(this.Id,t)),Q(e,fe,null,g(this[fe],t)),Q(e,he,null,g(this[he],t)),Q(e,me,null,g(this[me],t)),Q(e,xe,null,g(this[xe],t)),Q(e,je,null,kn(this[je],t)),Q(e,He,null,g(this[He],t)),Q(e,_e,null,Mn(this[_e],t)))}}class Bn extends ${constructor(){super(),ln(this,{Id:T,[Ge]:P,Finalized:P,[Je]:P,[Ke]:0,[qe]:0,[Xe]:T})}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,"Id",null,A(this.Id,t)),Q(e,ze,null,y(this[Ge],t)),Q(e,"AppSessionId",[Qe],A(this[Xe],t))),n===hn&&(Q(e,"SignalInstanceId",[Ye],A(this.Id,t)),Q(e,"SendToONotify",[Ye],C(ue.convertToOptional({},this),t))),n!==fn&&n!==hn||(Q(e,"ActorDetails",[Ze],X(this[$e],1|t)),Q(e,tt,[et],Nn(this[Ke],t)),Q(e,"AppVer",[et],D(this[nt],t)),Q(e,"Platform",[Ze,"DeviceDetails"],bn(this[qe],t)),Q(e,"OsVer",[rt],D(this.SourcePlatformVersion,t)),Q(e,"DeviceId",[rt],g(this.SourceDeviceId,t)),Q(e,"UserAgent",[rt],g(this.SourceUserAgent,t)),Q(e,"ClientIp",[rt],g(this.SourceIpAddress,t)),Q(e,"Context",[Ze,"ApplicationDetails"],R(this[ot],t)),Q(e,it,[Ze],C(ce.convertToOptional({},this),t))),n===pn&&(Q(e,"HostTimestamp",null,y(this[Je],t)),Q(e,tt,[Qe],Nn(this[Ke],t)),Q(e,"AppVersion",[Qe],D(this[nt],t)),Q(e,"AppPlatform",[Qe],bn(this[qe],t)),Q(e,"AppContext",[Qe],R(this[ot],t)),Q(e,it,null,C(ne.convertToOptional({},this),t)))}}class jn extends Bn{get DefaultPipelines(){return Vn.Substrate}get AllowedPipelines(){return V(Vn.Host,Vn.Substrate)}[c](e,t){super[c](e,t);var n=H(t);n===pn&&Q(e,st,null,C(this[st],t)),n!==pn&&1!==n||(Q(e,at,null,g(this[at],t)),Q(e,"Type",null,g(Z.convertTo({},this),t)),Q(e,"People",null,X(te.convertToArray({},this),1|t)))}}class Hn extends jn{}class _n extends Hn{constructor(){super(),this.ContentOrigin=0}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,ct,[ut],g(this[ct],t)),Q(e,dt,[ut],g(this[dt],t)))}}class Gn extends _n{constructor(){super(),this[lt]=0}get AllowedPipelines(){return this.Action!==Dn.Create?F(super.AllowedPipelines,W(Vn.Host)):super.AllowedPipelines}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||Q(e,"ContentAction",[ut],On(this[lt],t))}}class Jn extends Gn{get DefaultPipelines(){return this.SourceApp===xn.Whiteboard?Vn.Substrate:Vn.Host}get AllowedPipelines(){return this.Action===Dn.Update?Vn.None:this.SourceApp===xn.Whiteboard?Vn.Substrate:super.AllowedPipelines}}class Kn extends Bn{constructor(){super(),this[pt]=P,this[ft]=P}[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||(Q(e,pt,null,y(this[pt],t)),Q(e,ft,null,y(this[ft],t)),Q(e,ht,null,Fn(this[ht],t)),Q(e,"CV",null,g(this.CorrelationVector,t)),Q(e,mt,null,g(this[mt],t)),Q(e,"Workload",[et],gn(this.AppWorkload,t)),Q(e,ke,[vt],g(this[ke],t)),Q(e,"ContainerType",[vt],g(this.ItemContainerKind,t)),Q(e,"ContainerId",[vt],g(this.ItemContainerId,t)),Q(e,"ContainerTypeId",[Ze],g(this.CustomContainerTypeId,t)),Q(e,"SignalType",null,g(re.convertTo({},this),t)),Q(e,"Actor",null,X(se.convertTo({},this),1|t)),Q(e,"Os",[rt],Pn(ie.convertTo({DefaultValue:0},this),t)),Q(e,"Compliance",null,Ln(ae.convertTo({DefaultValue:0},this),t)),Q(e,"AadAppId",[et],g(oe.convertTo({},this),t)),Q(e,"ItemType",[vt],g(ye,t)))}}class qn extends Kn{[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||(Q(e,"FileDetails",[Ze],z(this.DocumentInfo,-2&t,"SIGS.DocumentInfo")),Q(e,"ActivityDetails",[Ze],z(this[ut],-2&j(1,t),"Base.NormalActivity")))}}const Xn={UnsupportedClient:0,ProtectedDocument:1,Unnecessary:2},zn=function(e){const t=O(3),n=k(e),r=[["Unsupported_Client","Encrypted","NotNeeded"]],o=new Map([[pn,r[0]],[1,r[0]]]),i=e=>4&e?(e=>{var t;return null!==(t=o.get(e))&&void 0!==t?t:n})(H(e)):n;return(e,n)=>M(e,t,i(n),n)}(Xn),Qn=function(e){const t=O(3),n=k(e);return(e,r)=>M(e,t,n,r)}({[It]:0,[We]:1,[Ve]:2}),Yn=function(e){const t=O(4),n=k(e);return(e,r)=>M(e,t,n,r)}({Urgent:0,Important:1,Medium:2,Low:3}),$n=function(e){const t=U(5),n=E(e);return(e,r)=>L(e,t,n,r)}({[Be]:0,Assignees:1,[Ct]:2,[gt]:4,[ht]:8,[yt]:16}),Zn=function(e){const t=O(1),n=k(e);return(e,r)=>M(e,t,n,r)}({Like:0});(function(e){const t=O(3),n=k(e)})({[ge]:0,Local:1,Sharepoint:2}),function(e){const t=O(4),n=k(e)}({[ge]:0,ReuseFile:1,SmartLookup:2,TellMe:3}),function(e){const t=O(4),n=k(e)}({Slide:0,[Pt]:1,Image:2,Other:3}),function(e){const t=O(6),n=k(e)}({[It]:0,[We]:1,ReadyForReview:2,[Ve]:3,Blocked:4,Custom:5});class er extends Y{constructor(){super(),this.TypeName=bt}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,"LocationText",null,g(this.Location,t)),Q(e,Tt,null,X(this[Tt],1|t)),Q(e,wt,null,X(this[wt],1|t)),Q(e,Nt,null,g(this[xt],t)),Q(e,Rt,null,z(this[Rt],-2&t,At)))}}class tr extends er{constructor(){super(),this.TypeName="Common.CommentReplyPreview",this[Dt]=0}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,Ot,null,X(this[Ot],1|t)),Q(e,Ut,null,X(this[Ut],1|t)),Q(e,"ThreadCommentCount",null,h(this[Dt],t)))}}class nr extends Jn{constructor(){super(),this.TypeName="Common.Mention"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,"ParentContentId",[ut],g(this.CommentContentId,t)),Q(e,Nt,[ut],g(this[Nt],t)),Q(e,kt,[ut],C(this[kt],t)),Q(e,Mt,null,z(this[Et],-2&t,bt)),Q(e,Ft,[ut],zn(this[Lt],t)))}}class rr extends Gn{constructor(){super(),this.TypeName="Common.Comment"}get DefaultPipelines(){return this.SourceApp!==xn.FluidApp?Vn.Host:super.DefaultPipelines}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,Nt,[ut],g(this[xt],t)),Q(e,kt,[ut],C(this.ThreadIsTask,t)),Q(e,Mt,null,z(this[Mt],-2&t,bt)),Q(e,Ft,[ut],zn(this[Ft],t)))}}class or extends rr{constructor(){super(),this.TypeName="Common.CommentReply"}}class ir extends Hn{get DefaultPipelines(){return Vn.Host}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,Nt,[ut],g(this[Nt],t)),Q(e,dt,[ut],g(this[dt],t)),Q(e,Mt,null,z(this[Et],-2&t,bt)),Q(e,Ft,[ut],zn(this[Lt],t)))}}class sr extends ir{constructor(){super(),this.TypeName="Common.TaskCreation"}}class ar extends ir{}class cr extends ar{constructor(){super(),this.TypeName="Common.TaskReassignment"}}class ur extends Gn{constructor(){super(),this.TypeName="Common.CanvasTask"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,Ct,[ut],g(this[Ct],t)),Q(e,Vt,[ut],y(this[Vt],t)),Q(e,gt,[ut],y(this[gt],t)),Q(e,ht,[ut],Qn(this[ht],t)),Q(e,yt,[ut],Yn(this[yt],t)),Q(e,Wt,[ut],$n(this[Wt],t)))}}class dr extends Hn{}class lr extends _n{[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,Bt,[ut],g(this[Bt],t)),Q(e,jt,[ut],X(this[jt],1|t)))}}class pr extends lr{constructor(){super(),this.TypeName="Common.CommentReactionUpdate"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,Ht,[ut],Zn(this[Ht],t)),Q(e,_t,[ut],X(this[_t],1|t)))}}class fr extends lr{constructor(){super(),this.TypeName="Common.TargetedReactionUpdate"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,Gt,[ut],g(this[Gt],t)),Q(e,Jt,[ut],R(this[Jt],t)),Q(e,Kt,[ut],m(this[Kt],t)))}}class hr extends Gn{constructor(){super(),this.TypeName="Common.Nudge"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,qt,[ut],g(this[qt],t)),Q(e,Xt,[ut],R(this[Xt],t)))}}class mr extends Gn{constructor(){super(),this.TypeName="Common.Recap"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||Q(e,St,["Recap"],R(this[St],t))}}class vr extends Gn{constructor(){super(),this.TypeName="Common.StatusLabel"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,zt,[Qt],X(this[zt],1|t)),Q(e,Yt,[Qt],X(this[Yt],1|t)),Q(e,Xt,[Qt],R(this[Xt],t)))}}class Ir extends _n{constructor(){super(),this.TypeName="Common.ComponentEdit"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,$t,[Zt],g(this[$t],t)),Q(e,lt,[Zt],g(this[lt],t)),Q(e,en,[Zt],g(this[en],t)))}}class Cr extends _n{constructor(){super(),this.TypeName="Common.ContentChangeRuleTriggered",this[tn]=Sr}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,tn,[nn],Pr(this[tn],t)),Q(e,rn,[nn],g(this[rn],t)),Q(e,on,[nn],z(this[on],-2&t,"ContentChangeRuleTriggered.ContentStateInfo")))}}class gr extends qn{constructor(){super(),this.TypeName="Common.ActivitySignalWithoutContent",this.TypeClassification=3}[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||Q(e,sn,[Ze],g(Fe,t))}}class yr extends qn{constructor(){super(),this.TypeName="Common.ActivitySignalWithContent"}[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||Q(e,sn,[Ze],g(Le,t))}}(function(e){const t=O(10),n=k(e)})({Circle:0,CircleHalfFilled:1,RightArrowCircle:2,CheckmarkCircle:3,CircleLineFilled:4,[an]:5,[cn]:6,Grey:7,[un]:8,[dn]:9}),function(e){const t=O(12),n=k(e)}({Red:0,[dn]:1,Yellow:2,DarkBrown:3,LightGreen:4,[cn]:5,DarkTeal:6,Blue:7,[an]:8,[un]:9,Silver:10,Gray:11});const Pr=function(e){const t=O(2),n=k(e);return(e,r)=>M(e,t,n,r)}({Paragraph:0,[Pt]:1}),Sr=0;class Ar extends Y{}class Tr extends Ar{constructor(){super(),this.TypeName="ContentChangeRuleTriggered.PersonStateInfo"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||Q(e,"Dummy",["Person"],g("",t))}}class wr extends Y{constructor(){super(),this.TypeName="Vroom.WrappedActivity",this.Id=T}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||(Q(e,"Id",null,A(this.Id,t)),Q(e,"activity",null,z(this.Activity,-2&t,"Base.Activity")))}}class xr extends Y{constructor(){super(),this.TypeName="Vroom.PatchStreamPayload"}[c](e,t){super[c](e,t);var n=H(t);n!==pn&&1!==n||Q(e,"value",null,X(this.Activities,1|t))}}class Nr extends Y{constructor(){super(),this.TypeName="Transport.PreprocessorPayload"}[c](e,t){super[c](e,t);var n=H(t);n!==fn&&n!==hn||Q(e,"activities",null,z(this.Signals,-2&t,"Base.ActivitySignal"))}}!function(e){const t=O(11),n=k(e)}({Success:0,UnknownError:1,BadRequest:2,AccessDenied:3,SignalTypeNotFound:4,SignalAlreadyExists:5,Disabled:6,InternalError:7,Throttled:8,ServiceUnavailable:9,[ge]:10});var Rr=n(83125),br=n(30946),Dr=n(29018),Or=n(72376),Ur=n(40635),kr=n(37805),Er=n(93537),Mr=n(48680);const Lr="@onedrive.errorReasonForTelemetry";function Fr(e,t){return F(t instanceof Jn&&t.SourceApp===xn.Whiteboard?t.DefaultPipelines:Xr(e,"Pipelines."+t.TypeName,t.DefaultPipelines),t.AllowedPipelines)}function Vr(e,t,n){return Xr(e,t,n)}function Wr(e){return zr(e)&&"string"===typeof e.code&&Qr(e.message)&&Yr(e[Lr])}function Br(e){return zr(e)&&Wr(e.error)}function jr(e){return zr(e)&&"string"===typeof e.Id&&Qr(e.ServerId)&&Qr(e.Message)&&Yr(e.Status)&&("undefined"===typeof e.Error||Wr(e.Error))}function Hr(e){return zr(e)&&$r(e.Status,0,"Success")&&"undefined"===typeof e.Error}function _r(e){return zr(e)&&"string"===typeof e.Id&&Yr(e.Status)&&Qr(e.Message)}function Gr(e){return zr(e)&&$r(e.Status,0,"Success")}function Jr(e,t,n,o){const{siteUrl:i,siteId:s,webId:a,listId:c,listItemUniqueId:u}=n,d=function(e,t){if(e){if("Enterprise"===e.tokenProvider.identityType&&e.tenantId)return"SPO:SPO_".concat(t.siteId,"@SPO_").concat(e.tenantId);if("Consumer"===e.tokenProvider.identityType)return e.rosterId}return}(e,n),l=new wn;l.SiteUrl=i,l.TenantId=null!==e&&void 0!==e&&e.tenantId?new S(e.tenantId):void 0,l.SiteId=new S(s),l.WebId=new S(a),l.ListId=new S(c),l.ItemId=new S(u);const p=function(e){if(e.TypeClassification===qr)return new yr;return new gr}(o);return o.SignalId||(o.SignalId=new S((0,r.A)())),p.Id=o.SignalId,p.Creator=o.Creator,p.Created=o.Created,p.Finalized=o.Finalized,p.Observed=o.Observed,p.SourceApp=o.SourceApp,p.SourceAppVersion=o.SourceAppVersion,p.SourcePlatform=o.SourcePlatform,p.SourcePlatformVersion=o.SourcePlatformVersion,p.SourceDeviceId=o.SourceDeviceId,p.SourceUserAgent=o.SourceUserAgent,p.SourceIpAddress=o.SourceIpAddress,p.SourceAppContext=o.SourceAppContext,p.NotifiedInBand=o.NotifiedInBand,p.StartTime=o.Created,p.EndTime=o.Created,p.ItemId=t,p.Data=o,p.DocumentInfo=l,p.AppWorkload=Cn.SPO,p.ItemContainerId=d,p.CustomContainerTypeId=null===e||void 0===e?void 0:e.containerTypeId,p}function Kr(e,t,n){return _(new G,(()=>(q().SettingProvider={getSetting:(t,n)=>Xr(e,t,n)},t.toFacetJson(n))))}const qr=2;function Xr(e,t,n){return(0,Mr.AU)("ActivityTransport."+t,n,null===e||void 0===e?void 0:e.settingsProvider)}function zr(e){return"object"===typeof e&&null!==e}function Qr(e){return"undefined"===typeof e||"string"===typeof e}function Yr(e){return"undefined"===typeof e||"number"===typeof e||"string"===typeof e}function $r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"undefined"===typeof e||n.includes(e)}const Zr="OutgoingActivity",eo="ActivityResult";function to(e,t,n,r,o){const i=io(eo,t,Fr(e,t));i.TryCount=n.tries.length;const s=n.result.headers.get("SPRequestGuid");if(s&&(i.RequestId=s),i.Status=n.result.status,i.Success=!1,r){const e=function(e,t){const n=t.toLowerCase();return e.value.find((e=>e.Id.toLowerCase()===n))}(r,t.Id.toString());e&&(i.Success=!e.Error&&(!e.Status||"Success"===e.Status),e.Error?i.Error=e.Error.code:i.Success||(i.Error=e.Status),e.ServerId&&(i.ServerId=e.ServerId))}else o&&(i.Error=o.error.code);return i}function no(e,t,n,r,o){let i,s;t instanceof qn&&d(t.Data)?(i=so(eo,t,Fr(e,t.Data)),s=t.Data.Id):(i=oo(eo,t),s=t.Id),i.TryCount=n.tries.length;const a=n.result.headers.get("Request-Id");if(a&&(i.RequestId=a),i.Status=n.result.status,i.Success=!1,r){const e=function(e,t){const n=t.toLowerCase();return e.find((e=>e.Id.toLowerCase()===n))}(r,s.toString());e&&(i.Success=!e.Status||"Success"===e.Status,i.Success||(i.Error=e.Status,e.Message&&(i.Message=e.Message)))}else o&&(i.Error=o.error.code);return i}function ro(e,t,n){const r=oo(eo,e);r.TryCount=t.tries.length;const o=t.result.headers.get("Request-Id");return o&&(r.RequestId=o),r.Status=t.result.status,r.Success=t.result.ok,n&&(r.Error=n.error.code),r}function oo(e,t){return ao(e,t)}function io(e,t,n){const r=ao(e,t);return r.Pipelines=n,r}function so(e,t,n){let r;return d(t.Data)?(r=io(e,t.Data,n),r.ActivitySignalId=t.Id.toString()):r=oo(e,t),r}function ao(e,t){const n={eventName:e,category:"Generic",TypeName:t.TypeName,ActivityId:t.Id.toString(),Age:new Date(Date.now()).valueOf()-t.Created.valueOf()};return t instanceof Gn&&(n.Action=t.Action),t instanceof rr&&(n.HasParent=t instanceof or&&d(t.ParentAuthor),n.HasPreview=d(t.Preview),d(t.PreviewAbsenceReason)&&(n.PreviewAbsenceReason=t.PreviewAbsenceReason)),(t instanceof nr||t instanceof ir)&&(n.HasPreview=d(t.CommentPreview),d(t.CommentPreviewAbsenceReason)&&(n.PreviewAbsenceReason=t.CommentPreviewAbsenceReason)),n}async function co(e,t){const n=e.logger?{...e,logger:new Rr.p("ActivityTransport",e.logger)}:e;t.forEach(Co.bind(null,n));const r=await async function(e,t){const n=[];for await(const r of async function*(e,t){const n=await async function(e){if(!lo(e))return;try{return await(0,br.A7)(e.tokenProvider,e)}catch{return}}(e),r=await async function(e){if(!lo(e))return;const{siteUrl:t,driveId:n,fileId:r}=e;try{return await(0,s.sN)(e.tokenProvider,t,n,r)}catch{return}}(e);for(const s of t)if(n&&Po(s)){var o;const t=oo(Zr,s);null===(o=e.logger)||void 0===o||o.send(t),yield s}else if(yo(s)){const t=Fr(e,s);if(t&Vn.Host){var i;const n=io(Zr,s,t);null===(i=e.logger)||void 0===i||i.send(n),yield s}if(n&&r&&t&Vn.Substrate){var a;const o=Jr(e,n,r,s),i=so(Zr,o,t);null===(a=e.logger)||void 0===a||a.send(i),yield o,s.SuppressSendToSubstrate=!0}}}(e,t))n.push(r);return n}(n,t);return(await Promise.all([mo(n,r.filter(yo)),vo(n,r.filter(Po))])).every((e=>e))}class uo{constructor(e,t,n){this.provider=e,this.kind=t,this.id=n}}function lo(e){var t,n,r;return!!(null!==(t=e.senderIdentity)&&void 0!==t&&t.oid||null!==(n=e.senderIdentity)&&void 0!==n&&n.puid||po(e)&&null!==(r=e.senderIdentity)&&void 0!==r&&r.cid)}function po(e){return Vr(e,"EnableCidSupport",!0)}function fo(e){return Vr(e,"UseInstrumentedAuthorizedFetchWithRetry",!0)}function ho(e){return Vr(e,"UseSerializeToJson",!0)}async function mo(e,t){var n;if(t.length<1)return!0;const r=new xr;r.Activities=t.map(go);const o=(0,Dr.$)(e.siteUrl),i={getToken:t=>{const n={...t,siteUrl:e.siteUrl,driveId:e.driveId,itemId:e.fileId};return e.tokenProvider.getToken(["".concat(o,"/files.readwrite.all")],n)},url:"".concat(o,"/_api/v2.1/drives/").concat(e.driveId,"/items/").concat(e.fileId,"/office_activityStream"),tenantId:null===(n=e.senderIdentity)||void 0===n?void 0:n.tenantId,requestInit:{method:"PATCH",headers:{"Content-Type":"application/json"},body:ho(e)?Kr(e,r,pn):r.toFacetJson(pn)},retryPolicy:Or._9,tokenPolicy:(0,Or.N$)(e.tokenProvider)},s=fo(e)&&e.logger?await(0,Ur.g)({...i,logger:e.logger,nameForLogging:"SendActivitiesToHost"}):await(0,Ur.y)(i),a=await s.result.json();return function(e,t,n,r){const o=n.result.ok&&(s=r,zr(s)&&Array.isArray(s.value)&&s.value.every(jr))?r:void 0,i=!n.result.ok&&Br(r)?r:void 0;var s;for(const c of t){var a;const t=to(e,c,n,o,i);null===(a=e.logger)||void 0===a||a.send(t)}}(e,t,s,a),s.result.ok&&(zr(c=a)&&Array.isArray(c.value)&&c.value.every(Hr));var c}async function vo(e,t){if(t.length<1)return!0;try{return(await Promise.all(t.map(Io.bind(null,e)))).every((e=>e))}catch{return!1}}async function Io(e,t){var n;if(!function(e){return d(e.Creator)&&d(e.Creator.RawIdKind)}(t))return!1;let r,o,i;const s=function(e){var t,n;if(!function(e){return Vr(e,"EnableNewSubstrateUrls",!0)}(e))switch(null===(n=e.environment)||void 0===n?void 0:n.audience){case"GCC":return"https://substrate.office365.us";case"GCC-High":case"DoD":return"https://substrate-dod.office365.us";default:return"https://substrate.office.com"}switch(null===(t=e.environment)||void 0===t?void 0:t.audience){case"GCC-High":return"https://substrate.office365.us";case"DoD":return"https://substrate-dod.office365.us";default:return"https://substrate.office.com"}}(e),a=t instanceof qn;if(a){r="".concat(s,"/signalpreprocessor/v1/office");const e=new Nr;e.Signals=[t],o=e,i=hn}else r="".concat(s,"/api/v2.0/me/signals"),o=t,i=fn;const c=[429,500];(function(e){return Vr(e,"AddResponsesToRetryWhitelist",!0)})(e)&&c.push(709,710);const u={getToken:t=>e.tokenProvider.getToken(["".concat(s,"/Signals-Internal.ReadWrite")],t),url:r,tenantId:null===(n=e.senderIdentity)||void 0===n?void 0:n.tenantId,requestInit:{method:"POST",headers:{"Content-Type":"application/json",Prefer:'exchange.behavior="SignalAccessV2,OpenComplexTypeExtensions"',"X-SignalInstanceId":t.Id.toString(),"X-AnchorMailbox":e.senderIdentity.upn},body:ho(e)?Kr(e,o,i):o.toFacetJson(i)},retryPolicy:{maxRetries:2,backoffFn:(0,kr.FT)(500),filter:(0,Er.sC)(c)}},l=fo(e)&&e.logger?await(0,Ur.g)({...u,logger:e.logger,nameForLogging:"SendSignalToSubstrate"}):await(0,Ur.y)(u),p=await l.result.json();return function(e,t,n,r,o){const i=!n.result.ok&&Br(r)?r:void 0;if(o){const o=n.result.ok&&(c=r,Array.isArray(c)&&c.every(_r))?r:void 0;for(const r of t){var s;const t=no(e,r,n,o,i);null===(s=e.logger)||void 0===s||s.send(t)}}else for(const u of t){var a;const t=ro(u,n,i);null===(a=e.logger)||void 0===a||a.send(t);break}var c}(e,[t],l,p,a),a?l.result.ok&&(f=p,Array.isArray(f)&&f.every(Gr)):l.result.ok;var f}function Co(e,t){if(e.senderIdentity&&!t.Creator)if(po(e)){const{provider:n,kind:r,id:o}=function(e,t){const{LiveId:n,ADAL:r}=Un,{OID:o,PUID:i,CID:s}=En,{oid:a,puid:c,cid:u}=t;if("Consumer"===e.identityType)return c?new uo(n,i,c):u?new uo(n,s,u):a?new uo(n,o,a):new uo(n);const d="Enterprise"===e.identityType?r:void 0;return a?new uo(d,o,a):c?new uo(d,i,c):u?new uo(d,s,u):new uo(d)}(e.tokenProvider,e.senderIdentity);t.Creator=new Wn,t.Creator.Id=o,t.Creator.Name=e.senderIdentity.name,t.Creator.Email=e.senderIdentity.upn,t.Creator.TenantId=e.senderIdentity.tenantId,t.Creator.RawProvider=n,t.Creator.RawId=t.Creator.Id,t.Creator.RawIdKind=r}else t.Creator=new Wn,t.Creator.Id=function(e){var t,n,r;if("Consumer"===e.tokenProvider.identityType&&null!==(t=e.senderIdentity)&&void 0!==t&&t.puid)return e.senderIdentity.puid;if(null!==(n=e.senderIdentity)&&void 0!==n&&n.oid)return e.senderIdentity.oid;if(null!==(r=e.senderIdentity)&&void 0!==r&&r.puid)return e.senderIdentity.puid;return}(e),t.Creator.Name=e.senderIdentity.name,t.Creator.Email=e.senderIdentity.upn,t.Creator.TenantId=e.senderIdentity.tenantId,t.Creator.RawProvider=function(e){if("Consumer"===e.tokenProvider.identityType)return Un.LiveId;if("Enterprise"===e.tokenProvider.identityType)return Un.ADAL;return}(e),t.Creator.RawId=t.Creator.Id,t.Creator.RawIdKind=function(e){var t,n,r;if("Consumer"===e.tokenProvider.identityType&&null!==(t=e.senderIdentity)&&void 0!==t&&t.puid)return En.PUID;if(null!==(n=e.senderIdentity)&&void 0!==n&&n.oid)return En.OID;if(null!==(r=e.senderIdentity)&&void 0!==r&&r.puid)return En.PUID;return}(e)}function go(e){const t=new wr;return t.Activity=e,t.Id=e.Id,t}function yo(e){return e instanceof jn}function Po(e){return e instanceof Kn}var So=n(74086);const Ao="1",To="fluid",wo="s",xo="d",No="f",Ro="c",bo="a",Do="p",Oo="v",Uo="x";function ko(e){const t=new URL(e.siteUrl),n=encodeURIComponent(t.pathname),r=encodeURIComponent(e.driveId),o=encodeURIComponent(e.itemId),i=encodeURIComponent(e.dataStorePath);let s="".concat(wo,"=").concat(n,"&").concat(xo,"=").concat(r,"&").concat(No,"=").concat(o,"&").concat(Ro,"=").concat(i,"&").concat(To,"=").concat(Ao);return e.appName&&(s+="&".concat(bo,"=").concat(encodeURIComponent(e.appName))),e.containerPackageName&&(s+="&".concat(Do,"=").concat(encodeURIComponent(e.containerPackageName))),e.fileVersion&&(s+="&".concat(Oo,"=").concat(encodeURIComponent(e.fileVersion))),e.context&&(s+="&".concat(Uo,"=").concat(encodeURIComponent(e.context))),(0,So.O0)(s)}const Eo="GetDocumentInfoError",Mo="AppContextError",Lo="MissingAuthorInformation",Fo="NotificationActivityStreamError",Vo="NonODSPResolvedUrl",Wo="NotifyAtMention",Bo="QueueAtMentionNotification";class jo{get Disposable(){return this}dispose(){}get NotificationService(){return this}async notifyAtMention(e,t,n){const{siteUrl:r,driveId:o,fileId:i}=this.props,s={siteUrl:r,driveId:o,itemId:i,dataStorePath:t};return this.sendNotification(e,t,n,Wo,s)}async queueAtMentionNotification(e){let{recipient:t,atMentionId:n,contentId:r,navigationPath:i,resolvedUrl:a,threadId:c}=e;const{siteUrl:u,driveId:d,fileId:l,appName:p,logger:f}=this.props,h={itemId:l,driveId:d,siteUrl:u},m=((e,t,n)=>{var r;if(!t)return n&&(0,o.Ot)(n,{eventName:Eo}),e;if(!(0,s.g2)(t)){const t=new Error("Invalid file information: ResolvedUrl is not of the expected ODSP type");return n&&(0,o.hO)(n,{eventName:Eo},t),e}return{driveId:t.driveId,siteUrl:t.siteUrl,itemId:t.itemId,containerPackageName:null===(r=t.codeHint)||void 0===r?void 0:r.containerPackageName}})(h,a,f);let v,I;if(a&&(0,s.g2)(a)){var C,g,y;const e={siteUrl:a.siteUrl,driveId:a.driveId,itemId:a.itemId};v=null===(C=a.codeHint)||void 0===C?void 0:C.containerPackageName,I=((e,t)=>{const{siteUrl:n,driveId:r,itemId:o}=t,i=new URL(n).hostname,{siteUrl:s,driveId:a,itemId:c}=e;return i!==new URL(s).hostname||r!==a||o!==c})(h,e)?void 0:await(null===(g=(y=this.props).getFileContext)||void 0===g?void 0:g.call(y,a,r))}const P={...m,dataStorePath:r,containerPackageName:v,appName:p,context:I};return a&&!(0,s.g2)(a)&&(P.dataStorePath="",f&&(0,o.hO)(f,{eventName:Vo})),this.sendNotification(t.userPrincipalName,r,i,Bo,P,n,c,a)}getAppContext(e){let t,n;if(e)try{t={fluidComponents:JSON.parse(e)}}catch(r){r instanceof Error&&(n=r)}return{appContext:t,appContextError:n}}async notifyOfficeActivityStream(e,t,n,o,i,s,a){const{correlationId:c}=this.props,u={...this.props,fileId:o.itemId,driveId:o.driveId,siteUrl:o.siteUrl},d=function(e,t){const n=ko(e);if(t.includeFluidSignature)return n;const r=new URLSearchParams(atob(n));return r.delete("fluid"),btoa(r.toString())}(o,{includeFluidSignature:!0}),l=new nr;return l.Id=new S((0,r.A)()),l.Created=l.Observed=new Date,l.SourceApp=xn.FluidApp,l.SourcePlatform=Rn.Web,l.SourceSessionId=c?new S(c):T,l.SourceAppContext=i,l.ContentId=null!==s&&void 0!==s?s:t,l.NavigationId=d,l.CommentThreadId=a,l.Action=Dn.Create,l.Mentionee=new Wn,l.Mentionee.Email=e,l.CommentPreviewAbsenceReason=Xn.UnsupportedClient,n.addAdditionalProps({activityId:l.Id.toString(),contentId:l.ContentId}),await co(u,[l])}async sendNotification(e,t,n,r,o,s,a,c){const{getHostAppContext:u}=this.props,d=i.m.start("NotifyOfficeActivityStream",this.props.logger);if(!e)return d.setResult(!1,{navigationPath:n.length>0,entryPoint:r,errorType:Lo}),!1;const{appContext:l,appContextError:p}=u?{appContext:u(c)}:this.getAppContext(n);try{const i=await this.notifyOfficeActivityStream(e,t,d,o,l,s,a);return d.setResult(i&&!p,{appContextSent:!!l,notifyActivity:i,navigationPath:n.length>0,entryPoint:r,...p&&{errorType:Mo}},p),i}catch(f){return d.setResult(!1,{appContextSent:!!l,notifyActivity:!1,navigationPath:n.length>0,entryPoint:r,errorType:Fo},f),!1}}constructor(e){if(this.props=e,!this.props.fileId||!this.props.driveId||!this.props.siteUrl)throw new Error("Invalid file information: fileId, driveId or siteUrl might be missing")}}},30946:(e,t,n)=>{function r(e){const t=window.btoa(e);return t.replace(/(\+|\/|\=)/g,(e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError("Unexpected match ".concat(e," encountered in urlEncodeBase64String. Only +/= are to be replaced."))}))}n.d(t,{A7:()=>i});var o=n(60835);async function i(e,t,n){const{siteUrl:r,driveId:i,fileId:a}=t,c=await(0,o.sN)(e,r,i,a,n);if(!c)throw new Error("Failed to fetch file sharepoint ids");return s(c,a)}function s(e,t){const{siteId:n,webId:o,listId:i}=e;return"SPO_".concat(r("".concat(n,",").concat(o,",").concat(i)),"_").concat(t)}}}]);
//# sourceMappingURL=SharepointNotificationService.a3001fa8.chunk.js.map