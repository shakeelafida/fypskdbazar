"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[37308],{64805:(t,e,a)=>{a.d(e,{J:()=>r});class s{get clientSettings(){return this.clientSettingsProvider()}constructor(t,e,a){this.dispatcher=t,this.clientSettingsProvider=e,this.loggers=a}}class r extends s{getCurrentViewIds(){const t=this.stores.appContextStore.getCurrentViewId();return t?[t]:void 0}constructor(t,e,a,s,r){super(t,s,r),this.webApiProviders=e,this.stores=a}}},49636:(t,e,a)=>{a.r(e),a.d(e,{TaskModule:()=>Tt});var s=a(79757),r=a(69292),o=a(41788),n=a(73322),i=a(48475),l=a(40164),c=a(45721),d=a(23359),g=a(90506),u=a(27197),k=a(28571),p=a(96693),h=a(96020),T=a(31316),v=a(713),m=a(73624),F=a(83574),y=a(89469),w=a(69252),D=a(48537),I=a(449),A=a(14e3),b=a(75992);class f extends b.r{loggingData(){return{id:this.failedTaskId}}constructor(t){super(f.actionType),this.failedTaskId=t}}f.actionType="PLW_REORDER_TASKS";class S extends b.r{loggingData(){return{id:this.failedTaskId}}constructor(t){super(S.actionType),this.failedTaskId=t}}S.actionType="PLW_REORDER_TASKS_SUCCEEDED";class P extends b.r{loggingData(){return{id:this.failedTaskId,reorderPhase:this.reorderPhase}}constructor(t,e){super(P.actionType),this.failedTaskId=t,this.reorderPhase=e}}P.actionType="PLW_REORDER_TASKS_FAILED";var x=a(79799),E=a(59393),C=a(40699),B=a(66061),L=a(95783),O=a(78332),V=a(45795),H=a(64805),W=a(9962),j=a(52274),R=a(32561),_=a(80708),U=a(39589),N=a(70252),M=a(74844),q=a(65818),G=a(14740),K=a.n(G),J=a(32520),Z=a.n(J),Q=a(55491),Y=a.n(Q),z=a(54320),X=a.n(z),$=a(10871),tt=a.n($),et=a(33411),at=a.n(et),st=a(35640),rt=a.n(st),ot=a(91246),nt=a(67271),it=a(7670),lt=a(98424),ct=a(98502),dt=a(54439),gt=a(82841),ut=a(21382),kt=a(86053),pt=a(30210);class ht{static parseChannelIdFromTeamsContextKey(t){if(""===t)throw new Error("Context key cannot be empty");const e=t.split("#"),a=parseInt(e[0],10);if(isNaN(a)||2!==e.length||e[1].length<=a)throw new Error("Invalid context key: ".concat(t));return e[1].slice(a)}static findDuplicateTeamsContextKeys(t,e){const a=[];for(const o in t){const e=t[o];e.ownerAppId!==O.uc.MSTeamsWeb&&e.ownerAppId!==O.uc.MSTeamsDesktop||a.push(o)}if(a.length<2)return[];const s={},r=[];for(const o of a){const t="#",a=o.split(t),n=parseInt(a[0],10);if(isNaN(n)||2!==a.length||a[1].length<=n){e.logTrace(507778444,M.k.Warning,"Invalid context encountered when deduping Teams contexts. [contextKey=".concat(o,"]"));continue}const i=a[1].slice(n),l=36;null==s[i]?s[i]={teamIdLength:n,contextKey:o}:s[i].teamIdLength===l?(r.push(s[i].contextKey),s[i]={teamIdLength:n,contextKey:o}):r.push(o)}return r}}class Tt extends H.J{get name(){return"TaskModule"}async createTaskAsync(t,e,a){this.loggers.traceLogger.logTrace(507897177,M.k.Verbose,"Create task [TaskId=".concat(t.id,"]"));const n=t.id+"_createTask";dt.j.beginTransaction(this.dispatcher,{name:"createTask",transactionId:n,action:new s.M(t)},this.loggers.logHandler);const i=e=>{var a,s,o,i;dt.j.completeTransactionWithError(this.dispatcher,{transactionId:n,errorMessage:"",action:new r.N(t,e.response,null!==(a=null===(s=e.response)||void 0===s?void 0:s.statusText)&&void 0!==a?a:"",null!==(o=null===(i=e.error)||void 0===i?void 0:i.message)&&void 0!==o?o:"")})};if(e)try{await e}catch(l){const e=l;return this.loggers.traceLogger.logTrace(507897176,M.k.Warning,"Create task - Dependent promise fail [TaskId=".concat(t.id,"]").concat((0,gt.s8)(e))),i(e),Promise.reject(e)}try{const e=await this.webApiProviders.taskService(),a=await e.createTaskAsync({newTaskEntitySet:t});return this.loggers.traceLogger.logTrace(507897175,M.k.Verbose,"Create task - Success [TaskId=".concat(t.id,"]")),dt.j.completeTransaction(this.dispatcher,{transactionId:n,action:new o.r(a,t.task.id),additionalData:a.task}),a}catch(l){const e=l;return this.loggers.traceLogger.logTrace(507897174,M.k.Warning,"Create task - Fail [TaskId=".concat(t.id,"]").concat((0,gt.s8)(e))),e.error instanceof j.U||null==a?i(e):a(e,(()=>i(e))),Promise.reject(e)}}async createTaskApprovalAsync(t,e){var a,s,r,o;const l=this.stores.taskStore.getTask(t),c=ut.G(kt.p.Strings.AddApprover_TaskEditorWrapper_SendApprovalRequest_Title,null===l||void 0===l?void 0:l.title),d=ut.G(kt.p.Strings.AddApprover_TaskEditorWrapper_SendApprovalRequest_AttachmentName,null===l||void 0===l?void 0:l.title);let g=null,u="",k=null;if(l){const e=this.stores.planStore.getPlan(l.planId);if(e){var p;const a=e.container.externalId,s=null!=a?this.stores.containerStore.getContainer(a):null,r=(null===s||void 0===s?void 0:s.containerType)===q.K.Group?s:null;g=null!==(p=null===r||void 0===r?void 0:r.unifiedGroup)&&void 0!==p?p:null;try{if(k=(0,pt.g)(e.contexts,V.s.Teams),!k)throw new Error("Plan context key cannot be null or empty");u=ht.parseChannelIdFromTeamsContextKey(k)}catch(D){const a="Failed to parse channel id from teams plan context key for plan ".concat(e.id,". ").concat(D);return this.loggers.traceLogger.logTrace(507569109,M.k.Warning,"Create task approval - ".concat(a," [TaskId=").concat(t,"]")),Promise.reject(ct.g.generateAjaxClientError(null,a))}}}this.dispatcher.dispatchAction(new n.Z(t));const h=null!==(a=null===(s=g)||void 0===s?void 0:s.id)&&void 0!==a?a:"",T=null!==(r=null===(o=g)||void 0===o?void 0:o.displayName)&&void 0!==r?r:"",v=ut.G(kt.p.Strings.AddApprover_TaskEditorWrapper_SendApprovalRequest_Details,T);try{const a=await this.webApiProviders.taskService(),s=await a.createApproval({taskId:t,approverIds:e,rosterContext:{teamId:h,channelId:u},title:c,attachmentName:d,details:v});return this.loggers.traceLogger.logTrace(507790346,M.k.Verbose,"Create task approval - Success [TaskId=".concat(t,"]")),s}catch(D){var m,F,y,w;const e=D;return this.loggers.traceLogger.logTrace(507790345,M.k.Warning,"Create task approval - Fail [TaskId=".concat(t,"] ").concat((0,gt.s8)(e))),this.dispatcher.dispatchAction(new i.C(e.response,null!==(m=null===(F=e.response)||void 0===F?void 0:F.statusText)&&void 0!==m?m:"",null!==(y=null===(w=e.error)||void 0===w?void 0:w.message)&&void 0!==y?y:"",t)),Promise.reject(e)}}async updateTaskAsync(t,e,a,s){var r,o,n,i,g,u;this.loggers.traceLogger.logTrace(507897173,M.k.Verbose,"Update task [TaskId=".concat(t.id,"]"));const k=e.id+"_updateTask",p=ot.o.generate(),h=t.task.getDiff(e.task),T=null!=t.taskDetails&&null!=e.taskDetails?t.taskDetails.getDiff(e.taskDetails):{},v=null!=(null===(r=t.taskFormatData)||void 0===r?void 0:r.assignmentBoardFormat)&&null!=(null===(o=e.taskFormatData)||void 0===o?void 0:o.assignmentBoardFormat)?t.taskFormatData.assignmentBoardFormat.getDiff(e.taskFormatData.assignmentBoardFormat):{},m=null!=(null===(n=t.taskFormatData)||void 0===n?void 0:n.bucketBoardFormat)&&null!=(null===(i=e.taskFormatData)||void 0===i?void 0:i.bucketBoardFormat)?t.taskFormatData.bucketBoardFormat.getDiff(e.taskFormatData.bucketBoardFormat):{},F=null!=(null===(g=t.taskFormatData)||void 0===g?void 0:g.progressBoardFormat)&&null!=(null===(u=e.taskFormatData)||void 0===u?void 0:u.progressBoardFormat)?t.taskFormatData.progressBoardFormat.getDiff(e.taskFormatData.progressBoardFormat):{};dt.j.beginTransaction(this.dispatcher,{name:"updateTask",transactionId:k,action:new l.f(t,e,p)},this.loggers.logHandler);const y=t=>{let e=t.originalTaskEntitySet.task,a=t.updatedTaskEntitySet.task;const s=this.stores.taskStore.getTaskWithoutPendingUpdates(t.originalTaskEntitySet.id),r=null!=s&&null!=e&&null!=a;if(!X()(h)||r){if(null==s)throw ct.g.generateAjaxClientError(null,new W.m("taskWithoutPending","taskStore"));e=s,a=e.applyDiffs(h)}let o=t.originalTaskEntitySet.taskDetails,n=t.updatedTaskEntitySet.taskDetails;if(null!=t.originalTaskEntitySet.taskDetails&&null!=t.updatedTaskEntitySet.taskDetails&&!X()(T)){const e=this.stores.taskStore.getTaskDetailsWithoutPendingUpdates(t.originalTaskEntitySet.id);if(null==e)throw ct.g.generateAjaxClientError(null,new W.m("detailsWithoutPending","taskStore"));o=e,n=o.applyDiffs(T)}let i=t.originalTaskEntitySet.taskFormatData,l=t.updatedTaskEntitySet.taskFormatData;if(null!=t.originalTaskEntitySet.taskFormatData&&null!=t.updatedTaskEntitySet.taskFormatData){const e=this.stores.taskStore.getTaskboardTaskFormattingWithoutPendingUpdates(t.originalTaskEntitySet.id);let a=null,s=null;null==t.originalTaskEntitySet.taskFormatData.assignmentBoardFormat||null==t.updatedTaskEntitySet.taskFormatData.assignmentBoardFormat||null==(null===e||void 0===e?void 0:e.assignmentBoardFormat)||X()(v)||(a=e.assignmentBoardFormat,s=a.applyDiffs(v));let r=null,o=null;null==t.originalTaskEntitySet.taskFormatData.bucketBoardFormat||null==t.updatedTaskEntitySet.taskFormatData.bucketBoardFormat||null==(null===e||void 0===e?void 0:e.bucketBoardFormat)||X()(m)||(r=e.bucketBoardFormat,o=r.applyDiffs(m));let n=null,c=null;null==t.originalTaskEntitySet.taskFormatData.progressBoardFormat||null==t.updatedTaskEntitySet.taskFormatData.progressBoardFormat||null==(null===e||void 0===e?void 0:e.progressBoardFormat)||X()(F)||(n=e.progressBoardFormat,c=n.applyDiffs(F)),(a||r||n)&&(i=U._.builder.withPropertyBag({assignedBoardFormat:a||void 0,bucketBoardFormat:r||void 0,progressBoardFormat:n||void 0}).build()),(s||o||c)&&(l=U._.builder.withPropertyBag({assignedBoardFormat:s||void 0,bucketBoardFormat:o||void 0,progressBoardFormat:c||void 0}).build())}return{originalTaskEntitySet:_.F.builder.withTask(e).withDetails(o).withFormatData(i).build(),updatedTaskEntitySet:_.F.builder.withTask(a).withDetails(n).withFormatData(l).build()}},w=a=>{var s,r,o,n;dt.j.completeTransactionWithError(this.dispatcher,{transactionId:k,errorMessage:"",action:new c.K(t,e,p,a.response,null!==(s=null===(r=a.response)||void 0===r?void 0:r.statusText)&&void 0!==s?s:"",null!==(o=null===(n=a.error)||void 0===n?void 0:n.message)&&void 0!==o?o:"")})};if(a)try{await a}catch(D){const e=D;return this.loggers.traceLogger.logTrace(507897172,M.k.Warning,"Update task - Dependent promise fail [TaskId=".concat(t.id,"]").concat((0,gt.s8)(e))),w(e),Promise.reject(e)}try{const a=await this.webApiProviders.taskService(),s=await a.updateTaskAsync({originalTaskEntitySet:t,updatedTaskEntitySet:e},y);return this.loggers.traceLogger.logTrace(507897171,M.k.Verbose,"Update task - Success [TaskId=".concat(t.id,"]")),dt.j.completeTransaction(this.dispatcher,{transactionId:k,action:new d.U(t,s,p)}),s}catch(D){const e=D;return this.loggers.traceLogger.logTrace(507897170,M.k.Warning,"Update task - Fail [TaskId=".concat(t.id,"]").concat((0,gt.s8)(e))),e.error instanceof j.U||null==s?w(e):s(e,(()=>w(e))),Promise.reject(e)}}async deleteTaskAsync(t,e){this.loggers.traceLogger.logTrace(507897169,M.k.Verbose,"DeleteTask [TaskId=".concat(t,"][Version=").concat(e,"]"));const a=this.stores.taskStore.getTask(t);if(null==a)throw ct.g.generateAjaxClientError(null,new W.m("task","taskStore"));this.dispatcher.dispatchAction(new g.N(_.F.builder.withTask(a).build()));try{const a=await this.webApiProviders.taskService(),s=await a.deleteTaskAsync({taskId:t,itemVersion:e});return this.loggers.traceLogger.logTrace(507897168,M.k.Verbose,"DeleteTask - Success [TaskId=".concat(t,"][Version=").concat(e,"]")),this.dispatcher.dispatchAction(new u.o(s)),s}catch(i){var s,r,o,n;const l=i;return this.loggers.traceLogger.logTrace(507897167,M.k.Warning,"DeleteTask - Fail [TaskId=".concat(t,"][Version=").concat(e,"] ").concat((0,gt.s8)(l))),this.dispatcher.dispatchAction(new k.a(_.F.builder.withTask(a).build(),l.response,null!==(s=null===(r=l.response)||void 0===r?void 0:r.statusText)&&void 0!==s?s:"",null!==(o=null===(n=l.error)||void 0===n?void 0:n.message)&&void 0!==o?o:"")),Promise.reject(l)}}async undeleteTaskAsync(t){this.loggers.traceLogger.logTrace(507897166,M.k.Verbose,"Undelete task [TaskId=".concat(t.id,"]")),this.dispatcher.dispatchAction(new p.G(t));try{const e=await this.webApiProviders.taskService(),a=await e.undeleteTaskAsync({taskId:t.id,itemVersion:t.task.itemVersion});return this.loggers.traceLogger.logTrace(507897165,M.k.Verbose,"Undelete task - Success [TaskId=".concat(t.id,"]")),this.dispatcher.dispatchAction(new h.N(a)),a}catch(o){var e,a,s,r;const n=o;return this.loggers.traceLogger.logTrace(507897164,M.k.Warning,"Undelete task - Fail [TaskId=".concat(t.id,"]").concat((0,gt.s8)(n))),this.dispatcher.dispatchAction(new T.f(t,n.response,null!==(e=null===(a=n.response)||void 0===a?void 0:a.statusText)&&void 0!==e?e:"",null!==(s=null===(r=n.error)||void 0===r?void 0:r.message)&&void 0!==s?s:"")),Promise.reject(n)}}async fetchTaskAsync(t,e,a){this.loggers.traceLogger.logTrace(507897163,M.k.Verbose,"Fetching Task [TaskId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]"));const s=this.stores.taskStore.getTask(t),r=this.stores.taskStore.getTaskDetails(t),o=this.stores.taskStore.getTaskboardTaskFormatting(t);if(!e&&s&&r&&o&&o.assignmentBoardFormat&&o.bucketBoardFormat&&o.progressBoardFormat)return Promise.resolve(_.F.builder.withTask(s).withDetails(r).withFormatData(o).build());let n,i;e||(n=t=>{const e=this.stores.taskStore.getTask(t.taskId),a=this.stores.taskStore.getTaskDetails(t.taskId),s=this.stores.taskStore.getTaskboardTaskFormatting(t.taskId);return null==e||null==a||null==s||null==s.assignmentBoardFormat||null==s.bucketBoardFormat||null==s.progressBoardFormat?null:_.F.builder.withTask(e).withDetails(a).withFormatData(s).build()},i=this.getCurrentViewIds());const l=t+O.Ek.FetchTask;dt.j.beginTransaction(this.dispatcher,{name:"fetchTask",transactionId:l},this.loggers.logHandler);try{const s=await this.webApiProviders.taskService(),r=await s.getTaskEntitySetAsync({taskId:t},n,i,a);return this.loggers.traceLogger.logTrace(507897162,M.k.Verbose,"Fetching Task - Success [TaskId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"][taskCreationSourceType=").concat(r.task.taskCreationSourceType,"]")),dt.j.completeTransaction(this.dispatcher,{transactionId:l,action:new v.U(r)}),r}catch(c){const a=c;return this.loggers.traceLogger.logTrace(507897161,M.k.Warning,"Fetching Task - Fail [TaskId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]").concat((0,gt.s8)(a))),dt.j.completeTransactionWithError(this.dispatcher,{transactionId:l,errorMessage:"",additionalData:null!=a.response?{statusCode:a.response.status}:void 0}),Promise.reject(a)}}async fetchPlanTasksAsync(t,e){this.loggers.traceLogger.logTrace(507897160,M.k.Verbose,"Fetching Plan Tasks [PlanId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]"));const a=[];try{const s=await this.fetchPlanTasksRecursiveAsync(t,a,void 0,e);return this.loggers.traceLogger.logTrace(507897159,M.k.Verbose,"Fetching Plan Tasks - Success [PlanId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]")),s}catch(s){const a=s;return this.loggers.traceLogger.logTrace(507897158,M.k.Warning,"Fetching Plan Tasks - Fail [PlanId=".concat(t,"][Force=").concat(null!==e&&void 0!==e&&e,"]").concat((0,gt.s8)(a))),Promise.reject(a)}}async fetchTasksAssignedToUserAsync(t){this.loggers.traceLogger.logTrace(507897157,M.k.Verbose,"Fetching My Tasks");try{const e=await this.fetchTasksAssignedToUserRecursiveAsync(t,void 0);return this.loggers.traceLogger.logTrace(507897156,M.k.Info,"Fetching User Assigned Tasks - Success"),e}catch(e){const t=e;return this.loggers.traceLogger.logTrace(507897155,M.k.Warning,"Fetching User Assigned Tasks - Fail ".concat((0,gt.s8)(t))),Promise.reject(t)}}async fetchTaskApprovalDetailsAsync(t){this.loggers.traceLogger.logTrace(507897154,M.k.Verbose,"Fetching Task Approval Details"),this.dispatcher.dispatchAction(new m.n(t));try{const e=await this.webApiProviders.taskService(),a=await e.getApprovalDetailsAsync({taskId:t});return this.loggers.traceLogger.logTrace(507897153,M.k.Verbose,"Fetching Task Approval Details - Success"),this.dispatcher.dispatchAction(new F.j(t,a.properties)),a}catch(o){var e,a,s,r;const n=o;return this.loggers.traceLogger.logTrace(507897152,M.k.Warning,"Fetching Task Approval Details - Fail ".concat((0,gt.s8)(n))),this.dispatcher.dispatchAction(new y.E(n.response,null!==(e=null===(a=n.response)||void 0===a?void 0:a.statusText)&&void 0!==e?e:"",null!==(s=null===(r=n.error)||void 0===r?void 0:r.message)&&void 0!==s?s:"",t)),Promise.reject(n)}}async cancelApprovalAsync(t){this.loggers.traceLogger.logTrace(507790350,M.k.Verbose,"Canceling Approval"),this.dispatcher.dispatchAction(new w.x(t));try{const e=await this.webApiProviders.taskService(),a=await e.cancelApproval({taskId:t});return this.loggers.traceLogger.logTrace(507639747,M.k.Verbose,"Canceling Approval - Success"),a}catch(o){var e,a,s,r;const n=o;return this.loggers.traceLogger.logTrace(507790349,M.k.Warning,"Canceling Approval - Fail ".concat((0,gt.s8)(n))),this.dispatcher.dispatchAction(new D.W(n.response,null!==(e=null===(a=n.response)||void 0===a?void 0:a.statusText)&&void 0!==e?e:"",null!==(s=null===(r=n.error)||void 0===r?void 0:r.message)&&void 0!==s?s:"",t)),Promise.reject(n)}}async updateTaskApprovalAsync(t,e,a){this.loggers.traceLogger.logTrace(507790348,M.k.Verbose,"Updating task approval status"),this.dispatcher.dispatchAction(new I.O(t));try{const s=await this.webApiProviders.taskService(),r=await s.updateApproval({taskId:t,response:e,comments:a});return this.loggers.traceLogger.logTrace(507639746,M.k.Verbose,"Updating task approval status - Success"),r}catch(i){var s,r,o,n;const e=i;return this.loggers.traceLogger.logTrace(507790347,M.k.Warning,"Updating task approval status - Fail ".concat((0,gt.s8)(e))),this.dispatcher.dispatchAction(new A.L(e.response,null!==(s=null===(r=e.response)||void 0===r?void 0:r.statusText)&&void 0!==s?s:"",null!==(o=null===(n=e.error)||void 0===n?void 0:n.message)&&void 0!==o?o:"",t)),Promise.reject(e)}}fixTaskOrderHintPrecision(t,e,a,s,r,o){var n,i,l;this.loggers.traceLogger.logTrace(507635296,M.k.Info,"FixTaskOrderHintPrecision [TaskId=".concat(e.id,"]"));const c=null==e.task?this.stores.taskStore.getTask(e.id):e.task,d=null!=c?this.stores.planStore.getPlan(c.planId):null,g=null!=c?this.stores.taskStore.getTasksForPlan(c.planId):null;if(null==e||null==e.taskFormatData||null!=t&&null==t.taskFormatData||null==c||null==d||null==g||X()(g))return this.loggers.traceLogger.logTrace(507635295,M.k.Info,"FixTaskOrderHintPrecision - Invalid data [TaskId=".concat(e.id,"]")),o(),void a();const u=tt()(this.stores.userStore.getContainerUsers(d.container.externalId),"id"),k=[];if(null==t&&null!=e.taskFormatData.assignmentBoardFormat||null!=(null===t||void 0===t||null===(n=t.taskFormatData)||void 0===n?void 0:n.assignmentBoardFormat)&&null!=e.taskFormatData.assignmentBoardFormat){const a=tt()(this.stores.taskStore.getTaskboardTaskFormattingForPlan(c.planId,N.s.AssignedTo),"id"),s=this.filterTaskGroupsByCompletion((0,it.Fy)(g,a,u,this.stores.appContextStore.getCurrentUserId()),c.isComplete());Y()(s,(a=>{var s;const r=e.taskFormatData?U._.getAssignedToOrderHint(e.taskFormatData,a.pivotValue):null;null==r||X()(a.pivotValue)&&0!==rt()(null===(s=e.taskFormatData)||void 0===s||null===(s=s.assignmentBoardFormat)||void 0===s?void 0:s.orderHintsByAssignee)||null!=t&&(t.taskFormatData?U._.getAssignedToOrderHint(t.taskFormatData,a.pivotValue):null)===r||k.push(this.getTaskGroupReorderData(a,e.id,U._.getAssignedToOrderHint,U._.setAssignedToOrderHint))}))}if(null==t&&null!=e.taskFormatData.bucketBoardFormat||null!=(null===t||void 0===t||null===(i=t.taskFormatData)||void 0===i?void 0:i.bucketBoardFormat)&&null!=e.taskFormatData.bucketBoardFormat&&(null===t||void 0===t?void 0:t.taskFormatData.bucketBoardFormat.orderHint)!==e.taskFormatData.bucketBoardFormat.orderHint){const t=tt()(this.stores.taskStore.getTaskboardTaskFormattingForPlan(c.planId,N.s.Bucket),"id"),a=this.filterTaskGroupsByCompletion((0,it.M1)(g,t,c.bucketId?K()([this.stores.bucketStore.getBucket(c.bucketId)]):[]).filter((t=>null!=t.pivotValue)),c.isComplete());a.length>0&&k.push(this.getTaskGroupReorderData(a[0],e.id,U._.getBucketOrderHint,U._.setBucketOrderHint))}if(null==t&&null!=e.taskFormatData.progressBoardFormat||null!=(null===t||void 0===t||null===(l=t.taskFormatData)||void 0===l?void 0:l.progressBoardFormat)&&null!=e.taskFormatData.progressBoardFormat&&(null===t||void 0===t?void 0:t.taskFormatData.progressBoardFormat.orderHint)!==e.taskFormatData.progressBoardFormat.orderHint){const t=tt()(this.stores.taskStore.getTaskboardTaskFormattingForPlan(c.planId,N.s.Progress),"id"),a=(0,it.py)(g,t);Y()(a,(t=>{t.pivotValue===(0,nt.Fk)(c.percentComplete)&&k.push(this.getTaskGroupReorderData(t,e.id,U._.getProgressOrderHint,U._.setProgressOrderHint))}))}const p=this.hasInternalOrderHints(e);if(p&&(e=this.fixInternalOrderHintPrecision(e)),X()(k)&&!p)return this.loggers.traceLogger.logTrace(507635294,M.k.Verbose,"FixTaskOrderHintPrecision - No updates needed [TaskId=".concat(e.id,"]")),o(),void a();this.dispatcher.dispatchAction(new f(c.id)),s(k,!0).then((n=>{this.loggers.traceLogger.logTrace(507897123,M.k.Verbose,"FixTaskOrderHintPrecision - Reordered above groups [TaskId=".concat(e.id,"]")),o(),r(t,e,n).then((t=>{this.loggers.traceLogger.logTrace(507897122,M.k.Verbose,"FixTaskOrderHintPrecision - Fixed task [TaskId=".concat(e.id,"][taskCreationSourceType=").concat(c.taskCreationSourceType,"]")),s(t,!1).then((()=>{this.loggers.traceLogger.logTrace(507897121,M.k.Verbose,"FixTaskOrderHintPrecision - Reordered bottom groups [TaskId=".concat(e.id,"]")),this.dispatcher.dispatchAction(new S(c.id))}),(()=>{this.loggers.traceLogger.logTrace(507897120,M.k.Verbose,"FixTaskOrderHintPrecision - Failed to reorder bottom groups [TaskId=".concat(e.id,"]")),this.dispatcher.dispatchAction(new P(c.id,"Reorder below tasks"))}))}),(()=>{this.loggers.traceLogger.logTrace(507897119,M.k.Info,"FixTaskOrderHintPrecision - Failed to fix task [TaskId=".concat(e.id,"][taskCreationSourceType=").concat(c.taskCreationSourceType,"]")),a(),this.dispatcher.dispatchAction(new P(c.id,"Fix task"))}))}),(()=>{this.loggers.traceLogger.logTrace(507897118,M.k.Verbose,"FixTaskOrderHintPrecision - Failed to reorder above groups [TaskId=".concat(e.id,"]")),o(),a(),this.dispatcher.dispatchAction(new P(c.id,"Reorder above tasks"))}))}async fetchPlanTasksRecursiveAsync(t,e,a,s){let r=t=>{if(null!=t.nextContinuationToken)return null;const e=this.stores.taskStore.getTasksForPlan(t.planId);if(X()(e))return null;const a=at()(e,(t=>{const e=this.stores.taskStore.getTaskDetails(t.id),a=this.stores.taskStore.getTaskboardTaskFormatting(t.id);return _.F.builder.withTask(t).withDetails(null!==e&&void 0!==e?e:void 0).withFormatData(null!==a&&void 0!==a?a:void 0).build()}));return{xCorrelationId:"",statusCode:L.t3.OK,data:{NextContinuationToken:null,Results:a}}};const o=this.stores.planStore.getContainerIdForPlan(t);let n=this.getCurrentViewIds();s&&(r=void 0,n=void 0);try{const s=await this.webApiProviders.taskService(),i=await s.getTasksForPlanAsync({planId:t,nextContinuationToken:a},r,n);e.push(...i.data.Results.map((t=>t.id)));const l=new x.a(t,o,i.data.Results,i.data.NextContinuationToken,null==a,null!=i.data.NextContinuationToken?null:e);return this.dispatcher.dispatchAction(l),null!=i.data.NextContinuationToken?this.fetchPlanTasksRecursiveAsync(t,e,i.data.NextContinuationToken):i}catch(g){var i,l,c,d;const e=g;return this.dispatcher.dispatchAction(new E.q(e.response,null!==(i=null===(l=e.response)||void 0===l?void 0:l.statusText)&&void 0!==i?i:"",null!==(c=null===(d=e.error)||void 0===d?void 0:d.message)&&void 0!==c?c:"",t)),Promise.reject(e)}}async fetchTasksAssignedToUserRecursiveAsync(t,e){const a=this.getCurrentViewIds();try{const s=await this.webApiProviders.taskService(),r=await s.getTasksAssignedToCurrentUserAsync({nextContinuationToken:e},a);return this.dispatcher.dispatchAction(new C.e(t,r.data.Results,r.data.NextContinuationToken,null==e)),null!=r.data.NextContinuationToken?this.fetchTasksAssignedToUserRecursiveAsync(t,r.data.NextContinuationToken):r}catch(i){var s,r,o,n;const e=i;return this.dispatcher.dispatchAction(new B.y(e.response,null!==(s=null===(r=e.response)||void 0===r?void 0:r.statusText)&&void 0!==s?s:"",null!==(o=null===(n=e.error)||void 0===n?void 0:n.message)&&void 0!==o?o:"",t)),Promise.reject(e)}}filterTaskGroupsByCompletion(t,e){const a=[];return Y()(t,(t=>{const s={pivotValue:t.pivotValue,dataEntities:[],isOpen:t.isOpen};for(;t.dataEntities&&t.dataEntities.length>0;){const a=t.dataEntities.shift();a&&s.dataEntities&&a.isComplete()===e&&s.dataEntities.push(a)}a.push(s)})),a}getTaskGroupReorderData(t,e,a,s){const r=Z()(t.dataEntities,(t=>t.id===e)),o={aboveTasks:null,belowTasks:null,nextOrderHint:lt.O.generateOrderHintBetween(null,null),pivotValue:t.pivotValue,getOrderHint:a,setOrderHint:s};return t.dataEntities&&r>0&&(o.aboveTasks=t.dataEntities.slice(0,r)),t.dataEntities&&r<t.dataEntities.length-1&&(o.belowTasks=t.dataEntities.slice(r+1)),o}hasInternalOrderHints(t){var e,a;return!X()(t.task.assignments)||!X()(null===(e=t.taskDetails)||void 0===e?void 0:e.checklist)||!X()(null===(a=t.taskDetails)||void 0===a?void 0:a.references)}fixInternalOrderHintPrecision(t){const e=_.F.builder.withTask(t.task).withDetails(t.taskDetails).withFormatData(t.taskFormatData);if(null!=t.task.assignments){const a=(t,e)=>lt.O.compareOrderHints(t.order,e.order),s=(t,e)=>t.setProperty("order",e);e.withTask(t.task.setProperty("assignments",this.fixCollectionOrder(t.task.assignments,a,s)))}if(null!=t.taskDetails){const a=R.U.builder.forClone(t.taskDetails);if(!X()(t.taskDetails.checklist)){const e=(t,e)=>lt.O.compareOrderHints(e.orderHint,t.orderHint),s=(t,e)=>t.setProperty("orderHint",e);a.checklist=this.fixCollectionOrder(t.taskDetails.checklist,e,s)}if(!X()(t.taskDetails.references)){const e=(t,e)=>lt.O.compareOrderHints(t.previewPriority,e.previewPriority),s=(t,e)=>t.setProperty("previewPriority",e);a.references=this.fixCollectionOrder(t.taskDetails.references,e,s)}e.taskDetails=a.build()}return e.build()}fixCollectionOrder(t,e,a){const s={};let r=[];Y()(t,((t,e)=>r.push({key:e,value:t}))),r=r.sort(((t,a)=>e(t.value,a.value)));let o=null;return Y()(r,(t=>{o=lt.O.generateOrderHintBetween(o,null),s[t.key]=a(t.value,o)})),s}}},25588:(t,e,a)=>{var s;a.d(e,{s:()=>s}),function(t){t.TeamsTab="teamsTab",t.SharePointPage="sharePointPage",t.MeetingNotes="meetingNotes",t.LoopPage="loopPage",t.Other="other"}(s||(s={}))},30210:(t,e,a)=>{a.d(e,{Z:()=>h,g:()=>T});var s=a(25588),r=a(54320),o=a.n(r),n=a(32520),i=a.n(n),l=a(57273),c=a.n(l),d=a(87424),g=a.n(d),u=a(45795),k=a(78332),p=a(67053);function h(t,e){if(!t||o()(t.contexts)||!e)return!1;const a=Object.keys(t.contexts);return-1!==i()(a,(t=>{const a=e.contextDetails[t];return null!=a&&a.displayAs===s.s.MeetingNotes}))}function T(t,e){if(o()(t))return null;const a=c()(t,((t,a)=>{switch(e){case u.s.Teams:return p.c.isTeamsAppId(t.ownerAppId);case u.s.SharepointApp:return p.c.isSharepointAppId(t.ownerAppId);case u.s.Plex:return t.ownerAppId===k.uc.PlannerWeb;case void 0:return p.c.isTeamsAppId(t.ownerAppId)||p.c.isSharepointAppId(t.ownerAppId)||t.ownerAppId===k.uc.PlannerWeb;default:throw new Error("Invalid client type specified [ClientType=".concat(e,"]"))}})),s=Object.keys(a);return o()(s)?null:g()(s,[t=>a[t].createdDate])[0]}},54439:(t,e,a)=>{a.d(e,{j:()=>c});var s=a(29274),r=a(74427),o=a(57860),n=a(47204),i=a(74568),l=a(79947);class c{static beginTransaction(t,e,a){let{transactionId:r,name:o,logQos:n,action:l,additionalData:d}=e;if(!0===n){const t=new i.W({name:"Tx:"+o},a);c.qosEventsInFlight[r]=t}t.batchDispatchActions(new s.S(o,r,d),l)}static cancelTransaction(t,e){let{transactionId:a,action:s,additionalData:o}=e;const n=c.qosEventsInFlight[a];n&&(n.end({resultType:l.f.ExpectedFailure,extraData:o}),delete c.qosEventsInFlight[a]),t.batchDispatchActions(s,new r.D(a,o))}static completeTransaction(t,e){let{transactionId:a,action:s,additionalData:r}=e;const n=c.qosEventsInFlight[a];n&&(n.end({resultType:l.f.Success,extraData:r}),delete c.qosEventsInFlight[a]),t.batchDispatchActions(s,new o.M(a,r))}static completeTransactionWithBatch(t,e){let{transactionId:a,actions:s,additionalData:r}=e;const n=c.qosEventsInFlight[a];n&&(n.end({resultType:l.f.Success,extraData:r}),delete c.qosEventsInFlight[a]),t.batchDispatchActions(...s,new o.M(a,r))}static completeTransactionWithError(t,e){let{transactionId:a,errorMessage:s,action:r,additionalData:o}=e;const i=c.qosEventsInFlight[a];i&&(i.end({resultType:l.f.Failure,error:s,extraData:o}),delete c.qosEventsInFlight[a]),t.batchDispatchActions(r,new n.Y(a,s,o))}}c.qosEventsInFlight={}}}]);
//# sourceMappingURL=taskmodule.81a1e88a.chunk.js.map