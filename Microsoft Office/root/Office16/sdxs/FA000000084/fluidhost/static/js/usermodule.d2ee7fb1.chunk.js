"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[3642],{64805:(e,t,s)=>{s.d(t,{J:()=>n});class r{get clientSettings(){return this.clientSettingsProvider()}constructor(e,t,s){this.dispatcher=e,this.clientSettingsProvider=t,this.loggers=s}}class n extends r{getCurrentViewIds(){const e=this.stores.appContextStore.getCurrentViewId();return e?[e]:void 0}constructor(e,t,s,r,n){super(e,r,n),this.webApiProviders=t,this.stores=s}}},76043:(e,t,s)=>{s.r(t),s.d(t,{UserModule:()=>O});var r=s(55057),n=s(62455),i=s(8321),o=s(38361),a=s(47454),c=s(32512);class l extends c.v{constructor(e,t,s){super(l.actionType,e,t,s)}}l.actionType="PLW_RESOLVE_USERS_FAILED";var g=s(88928),h=s(65539),d=s(19333),u=s(42784),p=s(15548);class v extends c.v{constructor(e,t,s){super(v.actionType,e,t,s)}}v.actionType="PLW_GET_USERSFORPLANCONTAINER_FAILED";var y,f=s(39202),T=s(33414),A=s(48170),P=s(73438),U=s(8842),w=s(92446),b=s(38752),k=s(78332),I=s(99908),F=s(64805),S=s(9962),L=s(74844),m=s(65818),D=s(91246),C=s(37084),x=s.n(C),V=s(14740),E=s.n(V),W=s(54320),j=s.n(W),B=s(77508);!function(e){e.PlannerGov="5b4ef465-7ea1-459a-9f91-033317755a51",e.PlannerProd="b737dad2-2f6c-4c65-90e3-ca563267e8b9"}(y||(y={}));var R=s(79537);function M(e,t,s){return e===I.b.Planner?function(e){if(j()(e))return I.h.Invalid;let t=I.h.Invalid;for(const s of e)for(const e of s.servicePlans)if(e.servicePlanId===y.PlannerProd||e.servicePlanId===y.PlannerGov){if("Disabled"===e.provisioningStatus)return I.h.Invalid;if("Success"===e.provisioningStatus){t=I.h.ReadWrite;break}}return t}(t):(R.f.unreachableCase(e,(e=>{s.logTrace(507778504,L.k.Warning,e)})),I.h.Invalid)}var q=s(98502),G=s(25290),N=s(54439),K=s(82841);class O extends F.J{get name(){return"UserModule"}async fetchCurrentUserDetailsAsync(e){this.loggers.traceLogger.logTrace(507896973,L.k.Verbose,"Get Current User Details");let t=e=>this.stores.userStore.getUserDetailsById(b.B.currentUserId);e&&(t=void 0);try{const e=await this.webApiProviders.taskService(),s=await e.getCurrentUserDetailsAsync({},t);return this.loggers.traceLogger.logTrace(507896972,L.k.Verbose,"Get Current User Details - Success"),s}catch(s){const e=s;return this.loggers.traceLogger.logTrace(507896971,L.k.Warning,"Get Current User Details - Failure ".concat((0,K.s8)(e))),Promise.reject(e)}}async fetchUserLicensesAsync(e,t){this.loggers.traceLogger.logTrace(507896970,L.k.Verbose,"Fetch User Licenses [requestPriority=".concat(t,"]"));try{const s=await this.webApiProviders.taskService(),n=await s.getLicensesForUser({userId:e},void 0,void 0,t),i={Planner:M(I.b.Planner,n,this.loggers.traceLogger)};return this.dispatcher.dispatchAction(new r.i(e,i)),i}catch(c){var s,i,o,a;const t=c;return this.loggers.traceLogger.logTrace(507896969,L.k.Warning,"Fetch User Licenses - Failure ".concat((0,K.s8)(t))),this.dispatcher.dispatchAction(new n.g(e,t.response,null!==(s=null===(i=t.response)||void 0===i?void 0:i.statusText)&&void 0!==s?s:"",null!==(o=null===(a=t.error)||void 0===a?void 0:a.message)&&void 0!==o?o:"")),Promise.reject(t)}}async fetchUserAsync(e,t){this.loggers.traceLogger.logTrace(507896968,L.k.Verbose,"Get User [Force=".concat(t,"]"));let s=e=>{const t=this.stores.userStore.getUserById(e.userId);return null==t?null:t};t&&(s=void 0);try{const r=await this.webApiProviders.graph(),n=await r.getUserAsync({userId:e},s);return this.loggers.traceLogger.logTrace(507896967,L.k.Verbose,"Get User - Success [Force=".concat(t,"]")),this.dispatcher.dispatchAction(new i.A([n])),n}catch(r){const e=r;return this.loggers.traceLogger.logTrace(507896966,L.k.Warning,"Get User - Failure ".concat((0,K.s8)(e))),Promise.reject(e)}}async fetchUserPhotoAsync(e){if(this.loggers.traceLogger.logTrace(507896965,L.k.Verbose,"Fetch User Photo"),!(0,G.W_)(e.id))return Promise.reject(q.g.generateAjaxClientError(null,"User ID is not a GUID"));const t=e=>{const t=this.stores.userStore.getUserPhotoById(e.user.id);return t===B.S1.Photo?null:t},s=this.getCurrentViewIds();try{const l=await this.webApiProviders.graph(),g=await l.getUserPhoto({user:e},t,s);if(null!=g&&""!==g){this.loggers.traceLogger.logTrace(507896964,L.k.Verbose,"Fetch User Photo - Success");const t={};return t[e.id]=g,this.dispatcher.dispatchAction(new o.c(t)),g}{var r,n,i,c;this.loggers.traceLogger.logTrace(507896963,L.k.Info,"Fetch User Photo - Failure [Reason=empty photo]");const t=q.g.generateAjaxClientError(null,"No image was returned for user thumbnail");return this.dispatcher.dispatchAction(new a.P(e.id,t.response,null!==(r=null===(n=t.response)||void 0===n?void 0:n.statusText)&&void 0!==r?r:"",null!==(i=null===(c=t.error)||void 0===c?void 0:c.message)&&void 0!==i?i:"")),Promise.reject(t)}}catch(l){const e=l;return this.loggers.traceLogger.logTrace(507896962,L.k.Warning,"Fetch User Photo - Failure ".concat((0,K.s8)(e))),Promise.reject(e)}}async fetchUsersAsync(e,t){var s;const r=null!==(s=this.stores.appContextStore.getApiBatchLimits().ResolveUsersMaxBatchSize)&&void 0!==s?s:25;if(this.loggers.traceLogger.logTrace(507896961,L.k.Verbose,"Batch Fetching Users [Number=".concat(e.length,"][Force=").concat(null!==t&&void 0!==t&&t,"][BatchSize=").concat(r,"]")),0===e.length)return[];const n=t?[]:E()(e.map((e=>this.stores.userStore.getUserById(e))));if(n.length===e.length)return n;const o=t?e:e.filter((e=>null==this.stores.userStore.getUserById(e)));let a,c;if(!t){a=e=>{const t=E()(e.userIds.map((e=>this.stores.userStore.getUserById(e))));return t.length===e.userIds.length?t:null};const e=this.stores.appContextStore.getCurrentViewId();c=e?[e]:void 0}const g=await this.webApiProviders.graph(),h=[];x()(o,r).forEach((e=>{h.push(g.resolveUsersAsync({userIds:e},a,c).then((e=>(this.dispatcher.dispatchAction(new i.A(e)),e))))}));try{const t=await Promise.all(h);let s=[];return t.forEach((e=>{s=s.concat(e)})),s=s.concat(n),this.loggers.traceLogger.logTrace(507896960,L.k.Verbose,"Batch Fetching Users - Success [Unresolved Count=".concat(e.length-s.length,"]")),s}catch(y){var d,u,p,v;const e=y;return this.loggers.traceLogger.logTrace(507896931,L.k.Warning,"Batch Fetching Users - Failure ".concat((0,K.s8)(e))),this.dispatcher.dispatchAction(new l(e.response,null!==(d=null===(u=e.response)||void 0===u?void 0:u.statusText)&&void 0!==d?d:"",null!==(p=null===(v=e.error)||void 0===v?void 0:v.message)&&void 0!==p?p:"")),Promise.reject(e)}}fetchUsersForContainerAsync(e,t,s){return this.fetchUsersForContainerRecursiveAsync([],e,t,s)}async fetchUsersWithKeyword(e){this.loggers.traceLogger.logTrace(507896930,L.k.Verbose,"Fetching Users With Keyword");try{const t=await this.webApiProviders.taskService(),s=await t.getFilteredTenantUsersByKeyword({keyword:e});return this.loggers.traceLogger.logTrace(507896929,L.k.Verbose,"Fetching Users With Keyword - Success"),this.dispatcher.dispatchAction(new i.A(s)),s}catch(t){const e=t;return this.loggers.traceLogger.logTrace(507896928,L.k.Warning,"Fetching Users With Keyword - Failure ".concat((0,K.s8)(e))),Promise.reject(e)}}async fetchUserAccessibleSensitivityLabelsAsync(){this.loggers.traceLogger.logTrace(507896927,L.k.Verbose,"Fetching all sensitivity labels exposed to the user [TenantId=".concat(b.B.tenantId,"]"));const e=this.stores.tenantStore.getCurrentSensitivityLabels();if(null!=e)return this.loggers.traceLogger.logTrace(507896926,L.k.Verbose,"Fetching all sensitivity labels exposed to the user - Cache Hit [TenantId=".concat(b.B.tenantId,"]")),e;try{const e=await this.webApiProviders.taskService(),t=await e.getSensitivityLabelsAsync();return this.loggers.traceLogger.logTrace(507896925,L.k.Verbose,"Fetching all sensitivity labels exposed to the user - Success [TenantId=".concat(b.B.tenantId,"]")),this.dispatcher.dispatchAction(new f.K(t)),t}catch(i){var t,s,r,n;const e=i;return this.loggers.traceLogger.logTrace(507896924,L.k.Warning,"Fetching all sensitivity labels exposed to the user - Failure [TenantId=".concat(b.B.tenantId,"]").concat((0,K.s8)(e))),this.dispatcher.dispatchAction(new T.e(e.response,null!==(t=null===(s=e.response)||void 0===s?void 0:s.statusText)&&void 0!==t?t:"",null!==(r=null===(n=e.error)||void 0===n?void 0:n.message)&&void 0!==r?r:"")),Promise.reject(e)}}async fetchUserAccessibleSensitivityPolicySettingsAsync(){this.loggers.traceLogger.logTrace(507896923,L.k.Verbose,"Fetching sensitivity policy settings exposed to the user [TenantId=".concat(b.B.tenantId,"]"));const e=this.stores.tenantStore.getCurrentSensitivityPolicySettings();if(null!=e)return this.loggers.traceLogger.logTrace(507896922,L.k.Verbose,"Fetching sensitivity policy settings exposed to the user - Cache Hit [TenantId=".concat(b.B.tenantId,"]")),e;try{const e=await this.webApiProviders.taskService(),t=await e.getSensitivityPolicySettingsAsync();return this.loggers.traceLogger.logTrace(507896921,L.k.Verbose,"Fetching sensitivity policy settings exposed to the user - Success [TenantId=".concat(b.B.tenantId,"]")),this.dispatcher.dispatchAction(new A.Y(t)),t}catch(i){var t,s,r,n;const e=i;return this.loggers.traceLogger.logTrace(507896920,L.k.Warning,"Fetching sensitivity policy settings exposed to the user - Failure [TenantId=".concat(b.B.tenantId,"]").concat((0,K.s8)(e))),this.dispatcher.dispatchAction(new P.A(e.response,null!==(t=null===(s=e.response)||void 0===s?void 0:s.statusText)&&void 0!==t?t:"",null!==(r=null===(n=e.error)||void 0===n?void 0:n.message)&&void 0!==r?r:"")),Promise.reject(e)}}async removeDeletedPlansFromUserDetailsAsync(e){this.loggers.traceLogger.logTrace(507896919,L.k.Verbose,"Remove Deleted Plans From User Details");const t=this.stores.userStore.getCurrentUserDetails();let s=t;e.forEach((e=>{null!=s.favoritePlans.references[e]&&(s=s.removeFavoritePlan(e)),null!=s.recentPlans.references[e]&&(s=s.removeRecentPlan(e))}));try{const e=await this.updateUserDetailsAsync(t,s);return this.loggers.traceLogger.logTrace(507896918,L.k.Verbose,"Remove Deleted Plans From User Details Success"),e}catch(r){const e=r;return this.loggers.traceLogger.logTrace(507896917,L.k.Warning,"Remove Deleted Plans From User Details Failure ".concat((0,K.s8)(e))),Promise.reject(e)}}async updateUserDetailsAsync(e,t){this.loggers.traceLogger.logTrace(507896916,L.k.Verbose,"Updating user details");const s=e.getDiff(t);let r,n,i;if(null!==s&&void 0!==s&&s.recentPlans){const s=Object.keys(e.recentPlans.references).length,o=Object.keys(t.recentPlans.references).length;if(s>o){for(const r in e.recentPlans.references)if(null==t.recentPlans.references[r]){n=r;break}}else if(s<o){for(const n in t.recentPlans.references)if(null==e.recentPlans.references[n]){r={planId:n,title:t.recentPlans.references[n].title,lastAccess:t.recentPlans.references[n].lastAccess};break}}else for(const r in t.recentPlans.references){const s={},n=e.recentPlans.references[r],o=t.recentPlans.references[r];if(n.title!==o.title&&(s.title=o.title),n.lastAccess.getTime()!==o.lastAccess.getTime()&&(s.lastAccess=o.lastAccess),!j()(s)){i={key:r,diff:s};break}}}if(!s||j()(s))return this.loggers.traceLogger.logTrace(507896912,L.k.Verbose,"Updating user details - Success [ApiCall=".concat(!1,"]")),t;{const p=D.o.generate(),v=new g.h(t,p),y=e.id+k.Ek.UpdateUserDetails;N.j.beginTransaction(this.dispatcher,{name:"updateUserDetails",transactionId:y,action:v},this.loggers.logHandler);try{const o=await this.webApiProviders.taskService(),a=await o.updateUserDetailsAsync({originalUserDetails:e,updatedUserDetails:t},(e=>{const t=this.stores.userStore.getUserDetailsByIdWithoutPendingUpdates(e.originalUserDetails.id);if(!t)throw this.loggers.traceLogger.logTrace(507896915,L.k.Warning,"User details not found in store while updating"),q.g.generateAjaxClientError(null,new S.m("storeOriginalDetails","userStore"));let o=t.applyDiffs(s);if(null!==s&&void 0!==s&&s.recentPlans)if(o=o.setProperty("recentPlans",t.recentPlans),r)o=o.setRecentPlan(r.planId,r.lastAccess,r.title);else if(n)o=o.removeRecentPlan(n);else if(i){var a,c;const e=o.recentPlans.references[i.key];o=o.setRecentPlan(i.key,null!==(a=i.diff.lastAccess)&&void 0!==a?a:e.lastAccess,null!==(c=i.diff.title)&&void 0!==c?c:e.title)}return{originalUserDetails:t,updatedUserDetails:o}}));return this.loggers.traceLogger.logTrace(507896914,L.k.Verbose,"Updating user details - Success [ApiCall=".concat(!0,"]")),N.j.completeTransaction(this.dispatcher,{transactionId:y,action:new h.w(a,p)}),a}catch(u){var o,a,c,l;const t=u;this.loggers.traceLogger.logTrace(507896913,L.k.Warning,"Updating User Details - Failure ".concat((0,K.s8)(t)));const s=new d.k(e,p,t.response,null!==(o=null===(a=t.response)||void 0===a?void 0:a.statusText)&&void 0!==o?o:"",null!==(c=null===(l=t.error)||void 0===l?void 0:l.message)&&void 0!==c?c:"");return N.j.completeTransactionWithError(this.dispatcher,{transactionId:y,errorMessage:"",action:s}),Promise.reject(t)}}}async fetchMobileAppLinkViaCurrentUserEmailAsync(e){this.loggers.traceLogger.logTrace(507896911,L.k.Verbose,"Fetch MobileAppLink [Culture=".concat(e,"]"));try{const t=await this.webApiProviders.taskService(),s=await t.getMobileAppLinkViaCurrentUserEmailAsync({culture:e});return this.loggers.traceLogger.logTrace(507896910,L.k.Verbose,"Fetch MobileAppLink - Success [Culture=".concat(e,"]")),s}catch(t){return this.loggers.traceLogger.logTrace(507896909,L.k.Warning,"Fetch MobileAppLink - Fail [Culture=".concat(e,"] ").concat((0,K.s8)(t))),Promise.reject(t)}}async fetchSuiteNav(e){this.loggers.traceLogger.logTrace(507896908,L.k.Verbose,"Fetch SuiteNav [Culture=".concat(e,"]"));try{const t=await this.webApiProviders.taskService(),s=await t.getSuiteNav({culture:e});return this.dispatcher.dispatchAction(new U.f(s)),this.loggers.traceLogger.logTrace(507896907,L.k.Verbose,"Fetch SuiteNav - Success [Culture=".concat(e,"]")),s}catch(i){var t,s,r,n;const o=i;return this.dispatcher.dispatchAction(new w.f(o.response,null!==(t=null===(s=o.response)||void 0===s?void 0:s.statusText)&&void 0!==t?t:"",null!==(r=null===(n=o.error)||void 0===n?void 0:n.message)&&void 0!==r?r:"")),this.loggers.traceLogger.logTrace(507896906,L.k.Warning,"Fetch SuiteNav - Fail [Culture=".concat(e,"] ").concat((0,K.s8)(i))),Promise.reject(o)}}async fetchUsersForContainerRecursiveAsync(e,t,s,r){if(t.containerType===m.K.User){const s=this.stores.userStore.getCurrentUser();return this.dispatcher.batchDispatchActions(new u.F(t.externalId,[s],!0),new p.x(t.externalId,1)),e.push(s),e}this.loggers.traceLogger.logTrace(507896905,L.k.Verbose,"Fetching Users for Container [containerId=".concat(t.externalId,"][containerType=").concat(t.containerType,"][Force=").concat(null!==r&&void 0!==r&&r,"]"));let n=e=>{if(this.stores.userStore.getLoadingContainerUsersComplete(e.container.externalId)){const t=this.stores.userStore.getContainerUsers(e.container.externalId);if(null!=t)return{data:t}}return null},i=this.getCurrentViewIds();r&&(n=void 0,i=void 0);try{const o=await this.webApiProviders.graph(),a=await o.getMembersOfContainerAsync({container:t,skipToken:s},n,i),c=a.data;if(this.dispatcher.dispatchAction(new u.F(t.externalId,c,null==s)),e.push(...c),this.loggers.traceLogger.logTrace(507896904,L.k.Verbose,"Fetching Users for Container - Success [containerId=".concat(t.externalId,"][containerType=").concat(t.containerType,"][Force=").concat(null!==r&&void 0!==r&&r,"]")),null!=a.skipToken&&""!==a.skipToken)return this.fetchUsersForContainerRecursiveAsync(e,t,a.skipToken,r);{const s=this.stores.userStore.getContainerUsers(t.externalId),r=null!=s?s.length:0;return this.dispatcher.dispatchAction(new p.x(t.externalId,r)),e}}catch(g){var o,a,c,l;const e=g;return this.dispatcher.dispatchAction(new v(e.response,null!==(o=null===(a=e.response)||void 0===a?void 0:a.statusText)&&void 0!==o?o:"",null!==(c=null===(l=e.error)||void 0===l?void 0:l.message)&&void 0!==c?c:"")),this.loggers.traceLogger.logTrace(507896903,L.k.Warning,"Fetching Users for Container [containerId=".concat(t.externalId,"][containerType=").concat(t.containerType,"][Force=").concat(null!==r&&void 0!==r&&r,"]").concat((0,K.s8)(e))),Promise.reject(e)}}}},54439:(e,t,s)=>{s.d(t,{j:()=>l});var r=s(29274),n=s(74427),i=s(57860),o=s(47204),a=s(74568),c=s(79947);class l{static beginTransaction(e,t,s){let{transactionId:n,name:i,logQos:o,action:c,additionalData:g}=t;if(!0===o){const e=new a.W({name:"Tx:"+i},s);l.qosEventsInFlight[n]=e}e.batchDispatchActions(new r.S(i,n,g),c)}static cancelTransaction(e,t){let{transactionId:s,action:r,additionalData:i}=t;const o=l.qosEventsInFlight[s];o&&(o.end({resultType:c.f.ExpectedFailure,extraData:i}),delete l.qosEventsInFlight[s]),e.batchDispatchActions(r,new n.D(s,i))}static completeTransaction(e,t){let{transactionId:s,action:r,additionalData:n}=t;const o=l.qosEventsInFlight[s];o&&(o.end({resultType:c.f.Success,extraData:n}),delete l.qosEventsInFlight[s]),e.batchDispatchActions(r,new i.M(s,n))}static completeTransactionWithBatch(e,t){let{transactionId:s,actions:r,additionalData:n}=t;const o=l.qosEventsInFlight[s];o&&(o.end({resultType:c.f.Success,extraData:n}),delete l.qosEventsInFlight[s]),e.batchDispatchActions(...r,new i.M(s,n))}static completeTransactionWithError(e,t){let{transactionId:s,errorMessage:r,action:n,additionalData:i}=t;const a=l.qosEventsInFlight[s];a&&(a.end({resultType:c.f.Failure,error:r,extraData:i}),delete l.qosEventsInFlight[s]),e.batchDispatchActions(n,new o.Y(s,r,i))}}l.qosEventsInFlight={}}}]);
//# sourceMappingURL=usermodule.d2ee7fb1.chunk.js.map