"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[5828],{64805:(e,t,r)=>{r.d(t,{J:()=>a});class o{get clientSettings(){return this.clientSettingsProvider()}constructor(e,t,r){this.dispatcher=e,this.clientSettingsProvider=t,this.loggers=r}}class a extends o{getCurrentViewIds(){const e=this.stores.appContextStore.getCurrentViewId();return e?[e]:void 0}constructor(e,t,r,o,a){super(e,o,a),this.webApiProviders=t,this.stores=r}}},75411:(e,t,r)=>{r.r(t),r.d(t,{UnifiedGroupModule:()=>ae});var o=r(75992);class a extends o.r{loggingData(){return{numGroupsChecked:String(this.groupIds.length)}}constructor(e){super(a.actionType),this.groupIds=e}}a.actionType="PLW_CHECK_CURRENT_USER_TO_GROUPS_MEMBERSHIPS";var s=r(6775),i=r(27921),c=r(32512);class n extends c.v{constructor(e,t,r,o){super(n.actionType,t,r,o),this.requestGroupIds=e}}n.actionType="PLW_CHECK_CURRENT_USER_TO_GROUPS_MEMBERSHIPS_FAILED";var d=r(58245),l=r(47816),g=r(85224),p=r(33701),h=r(4597),u=r(12756),v=r(9300),G=r(77292),T=r(95799),I=r(51873),w=r(24590),y=r(86697),k=r(3519),P=r(8165),m=r(31364),b=r(39894);class S extends c.v{constructor(e,t,r){super(S.actionType,e,t,r)}}S.actionType="PLW_GET_JOINEDGROUPS_FAILED";var A=r(45498);class f extends c.v{constructor(e,t,r){super(f.actionType,e,t,r)}}f.actionType="PLW_RESOLVEGROUPSTOPLANS_FAILED";var C=r(77992),L=r(32185),F=r(7811),N=r(64805),E=r(65818),V=r(80708),x=r(11910),j=r(18113),D=r(86178),M=r.n(D),U=r(74844),R=r(37084),W=r.n(R),_=r(55491),B=r.n(_),q=r(34677),O=r.n(q),J=r(54320),K=r.n(J),H=r(93672),Q=r.n(H),z=r(36475),Y=r.n(z),X=r(76209),Z=r(98502),$=r(91246),ee=r(9962),te=r(38752),re=r(54439),oe=r(82841);class ae extends N.J{get name(){return"UnifiedGroupModule"}async checkCurrentUserToGroupsMembershipsAsync(e,t,r){const o=null==t?j.Q.Priority5:t;this.loggers.traceLogger.logTrace(507896902,U.k.Verbose,"User to group membership check [isMSIT=".concat(null!==r&&void 0!==r&&r,"]")),!0!==r&&this.dispatcher.dispatchAction(new a(e));try{const t=await this.webApiProviders.graph(),a=await t.checkCurrentUserToGroupsMembershipsAsync({groupIds:e},o);return this.loggers.traceLogger.logTrace(507896901,U.k.Verbose,"User to group membership check - Success [isMSIT=".concat(null!==r&&void 0!==r&&r,"]")),!0===r?this.dispatcher.dispatchAction(new s.e(e,a)):this.dispatcher.dispatchAction(new i.M(e,a)),a}catch(p){const t=p;var c,d,l,g;if(this.loggers.traceLogger.logTrace(507896900,U.k.Warning,"User to group membership check - Fail [isMSIT=".concat(null!==r&&void 0!==r&&r,"] ").concat((0,oe.s8)(t))),!0!==r)this.dispatcher.dispatchAction(new n(e,t.response,null!==(c=null===(d=t.response)||void 0===d?void 0:d.statusText)&&void 0!==c?c:"",null!==(l=null===(g=t.error)||void 0===g?void 0:g.message)&&void 0!==l?l:""));return Promise.reject(p)}}async fetchGroupPhotoAsync(e,t){this.loggers.traceLogger.logTrace(507896899,U.k.Verbose,"Fetch Group Photo [GroupId=".concat(e,"]"));const r=e=>this.stores.containerStore.getContainerPhotoById(e.groupId),o={};try{const a=await this.webApiProviders.graph(),s=await a.getGroupPhoto({groupId:e},r,t);return null!=s&&""!==s?(o[e]=s,this.loggers.traceLogger.logTrace(507896898,U.k.Verbose,"Fetch Group Photo - Success [GroupId=".concat(e,"]")),o):(this.loggers.traceLogger.logTrace(507896897,U.k.Warning,"Fetch Group Photo - Fail [GroupId=".concat(e,"]")),Promise.reject({groupId:e,error:"No image was returned for user thumbnail"}))}catch(a){const t=a;return this.loggers.traceLogger.logTrace(507896896,U.k.Warning,"Fetch Group Photo - Fail [GroupId=".concat(e,"] ").concat((0,oe.s8)(t))),Promise.reject({groupId:e,error:t})}}fetchPhotosForGroupSet(e,t){this.loggers.traceLogger.logTrace(507896867,U.k.Verbose,"Fetch Photos For GroupSet [GroupIds=".concat(e.join(","),"]"));const r=this.stores.appContextStore.getApiBatchLimits().GetUserPhotosBatchedAsync||10;return new Promise(((o,a)=>{if(K()(e))return o();B()(W()(e,r),(r=>{const a=[];B()(r,(e=>{null==this.stores.containerStore.getContainerPhotoById(e)&&a.push(this.fetchGroupPhotoAsync(e,t))})),K()(a)?o():Promise.allSettled(a).then((t=>{let r={};t.forEach((e=>{if("fulfilled"===e.status&&null!=e.value)r=O()(r,e.value);else if("rejected"===e.status){const t=e.reason.groupId;r[t]=""}})),this.dispatcher.dispatchAction(new d.W(r)),this.loggers.traceLogger.logTrace(507896866,U.k.Verbose,"Fetch Photos For GroupSet - Success [GroupIds=".concat(e.join(","),"]")),o()}))}))}))}async getConversationThreadAsync(e,t,r,o){this.loggers.traceLogger.logTrace(507896865,U.k.Verbose,"Get Coversation Thread [GroupId=".concat(e,"][ThreadId=").concat(t,"]"));const a=this.getCurrentViewIds();re.j.beginTransaction(this.dispatcher,{name:"fetchConversationThreadInGroup",transactionId:t},this.loggers.logHandler),this.dispatcher.dispatchAction(new l.l(e,t,M()()));try{const s=await this.webApiProviders.graph(),i=await this.webApiProviders.graphService(),c=te.B.clientSettings.Flights.EnableDirectGraphConversationCalls?await i.getGroupConversationThreadAsync({groupId:e,threadId:t},r,a,o):await s.getConversationThreadAsync({groupId:e,threadId:t},r,a,o);return re.j.completeTransaction(this.dispatcher,{transactionId:t,action:new g.f(e,t,c)}),this.loggers.traceLogger.logTrace(507896864,U.k.Verbose,"Get Coversation Thread - Success [GroupId=".concat(e,"][ThreadId=").concat(t,"]")),c}catch(s){const r=s;return this.loggers.traceLogger.logTrace(507896863,U.k.Warning,"Get Coversation Thread - Fail [GroupId=".concat(e,"][ThreadId=").concat(t,"] ").concat((0,oe.s8)(r))),Promise.reject(r)}}async warmUpGroupMailbox(e,t){this.loggers.traceLogger.logTrace(507896862,U.k.Verbose,"Warm Up Group Mailbox [GroupId=".concat(e,"]")),this.dispatcher.dispatchAction(new l.l(e,t,M()()));try{const r=await this.webApiProviders.graph(),o=await this.webApiProviders.graphService();te.B.clientSettings.Flights.EnableDirectGraphConversationCalls?await o.getGroupConversationThreadAsync({groupId:e,threadId:t}):await r.getConversationThreadAsync({groupId:e,threadId:t})}catch(r){}}async validateNamesBeforeCreateRecursive(e,t,r,o){this.loggers.traceLogger.logTrace(507896861,U.k.Verbose,"Validate Group Name [GroupId=".concat(e.id,"]"));const a=this.stores.tenantStore.getCurrentTenantGroupSettings();let s=a?a.DisplayNamePrefix:"",i=a?a.DisplayNameSuffix:"",c=a?a.MailNicknamePrefix:"",n=a?a.MailNicknameSuffix:"";if(0===r){r=3,o=3,(e=e.setProperty("mailNickname",X.A.generateNewMailNickname(t,0,c,n))).mailNickname||(e=e.setProperty("mailNickname",X.A.generateNewMailNickname(t,r,c,n)));let a=t;Q()(a,s)||(a=s+a),Y()(a,i)||(a+=i),e=e.setProperty("displayName",a)}else o>0?o--:(o=3,r++);try{const a=await this.webApiProviders.taskService(),d=await a.validateGroupNamesAsync({unifiedGroup:e,isCreation:!0});if(d.errorCode===F.Lg.OK)return this.loggers.traceLogger.logTrace(507896860,U.k.Verbose,"Validate Group Name - Success [GroupId=".concat(e.id,"]")),e;if(d.errorCode===F.Lg.MissingPrefixSuffix){s=d.displayNamePrefix||"",i=d.displayNameSuffix||"",c=d.mailNicknamePrefix||"",n=d.mailNicknameSuffix||"",this.dispatcher.dispatchAction(new p._(s,i,c,n));let a=t;return Q()(a,s)||(a=s+a),Y()(a,i)||(a+=i),e=(e=e.setProperty("displayName",a)).setProperty("mailNickname",X.A.generateNewMailNickname(t,r,c,n)),this.validateNamesBeforeCreateRecursive(e,t,r,o)}return d.errorCode===F.Lg.MailNicknameNotOK?(e=e.setProperty("mailNickname",X.A.generateNewMailNickname(e.displayName,r,c,n)),this.validateNamesBeforeCreateRecursive(e,t,r,o)):(this.loggers.traceLogger.logTrace(507896859,U.k.Warning,"Validate Group Name - Fail [GroupId=".concat(e.id,"][ErrorCode=").concat(d.errorCode,"]")),Promise.reject(d.errorCode))}catch(d){return this.loggers.traceLogger.logTrace(507896858,U.k.Verbose,"Validate Group Name - Success [GroupId=".concat(e.id,"]")),e}}async createGroup(e,t){this.loggers.traceLogger.logTrace(507896857,U.k.Verbose,"Create Group [GroupId=".concat(e.id,"]")),this.dispatcher.dispatchAction(new h.K(e));try{const r=await this.webApiProviders.taskService(),o=await r.createGroupAsync({unifiedGroupInfo:e},t);return this.dispatcher.dispatchAction(new u.x(o,e.id)),this.loggers.traceLogger.logTrace(507896856,U.k.Verbose,"Create Group - Success [GroupId=".concat(e.id,"]")),o.setProperty("autoSubscribeNewMembers",e.autoSubscribeNewMembers),o}catch(i){var r,o,a,s;const t=i;return this.dispatcher.dispatchAction(new v.b(e.id,t.response,null!==(r=null===(o=t.response)||void 0===o?void 0:o.statusText)&&void 0!==r?r:"",null!==(a=null===(s=t.error)||void 0===s?void 0:s.message)&&void 0!==a?a:"")),this.loggers.traceLogger.logTrace(507896855,U.k.Warning,"Create Group - Fail [GroupId=".concat(e.id,"] ").concat((0,oe.s8)(t))),Promise.reject(t)}}async updateUnifiedGroup(e,t){this.loggers.traceLogger.logTrace(507896854,U.k.Verbose,"Update UnifiedGroup [GroupId=".concat(e.id,"]"));const r=$.o.generate(),o=e.getDiff(t);if(K()(o))return Promise.resolve(t);this.dispatcher.dispatchAction(new G.v(t,r));try{const o=await this.webApiProviders.taskService(),a=await o.updateUnifiedGroupAsync({originalGroup:e,updatedGroup:t});return this.dispatcher.dispatchAction(new T.U(a,r)),this.loggers.traceLogger.logTrace(507896853,U.k.Verbose,"Update UnifiedGroup - Success [GroupId=".concat(e.id,"]")),a}catch(n){var a,s,i,c;const t=n;return this.dispatcher.dispatchAction(new I.w(e,r,t.response,null!==(a=null===(s=t.response)||void 0===s?void 0:s.statusText)&&void 0!==a?a:"",null!==(i=null===(c=t.error)||void 0===c?void 0:c.message)&&void 0!==i?i:"")),this.loggers.traceLogger.logTrace(507896852,U.k.Warning,"Update UnifiedGroup - Fail [GroupId=".concat(e.id,"] ").concat((0,oe.s8)(t))),Promise.reject(t)}}async createGroupConversationThread(e,t,r,o,a){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.loggers.traceLogger.logTrace(507896851,U.k.Verbose,"Create Group Coversation Thread [GroupId=".concat(e,"][ThreadId=").concat(t,"][postId=").concat(r.id,"][taskId=").concat(o.id,"]"));const i=$.o.generate(),c=o.setProperty("conversationThreadId",t);this.dispatcher.dispatchAction(new w.B(c,e,t,r,i,s));try{const c=await this.webApiProviders.taskService(),n=await this.webApiProviders.graphService(),d=te.B.clientSettings.Flights.EnableDirectGraphConversationCalls?await n.createGroupConversationThreadAsync({groupId:e,newPost:r,threadSubject:a}):await c.createGroupConversationThreadAsync({groupId:e,newPost:r,threadSubject:a}),l=o.setProperty("conversationThreadId",d.conversationThreadId),g=o.getDiff(l),p=e=>{const t=this.stores.taskStore.getTaskWithoutPendingUpdates(e.originalTaskEntitySet.id);if(null==t)throw Z.g.generateAjaxClientError(null,new ee.m("originalStoreTask","taskStore"));const r=t.applyDiffs(g);return{originalTaskEntitySet:V.F.builder.withTask(t).build(),updatedTaskEntitySet:V.F.builder.withTask(r).build()}},h=await c.updateTaskAsync({originalTaskEntitySet:V.F.builder.withTask(o).build(),updatedTaskEntitySet:V.F.builder.withTask(l).build()},p);return this.dispatcher.dispatchAction(new y.E(h.task,e,t,d.conversationThreadId,r,d,i,s)),this.loggers.traceLogger.logTrace(507896850,U.k.Verbose,"Create Group Coversation Thread - Success [GroupId=".concat(e,"][ThreadId=").concat(t,"][postId=").concat(r.id,"][taskId=").concat(o.id,"]")),d}catch(p){var n,d,l,g;const a=p;return this.dispatcher.dispatchAction(new k.M(o,e,t,r,i,a.response,null!==(n=null===(d=a.response)||void 0===d?void 0:d.statusText)&&void 0!==n?n:"",null!==(l=null===(g=a.error)||void 0===g?void 0:g.message)&&void 0!==l?l:"",s)),this.loggers.traceLogger.logTrace(507896849,U.k.Warning,"Create Group Coversation Thread - Fail [GroupId=".concat(e,"][ThreadId=").concat(t,"][postId=").concat(r.id,"][taskId=").concat(o.id,"] ").concat((0,oe.s8)(a))),Promise.reject(a)}}async postReplyInGroupConversationThread(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;this.loggers.traceLogger.logTrace(507896848,U.k.Verbose,"Post Reply In Group Coversation Thread [GroupId=".concat(e,"][ThreadId=").concat(t,"][postId=").concat(r.id,"]")),this.dispatcher.dispatchAction(new P.q(e,t,r,o));try{const s=await this.webApiProviders.taskService(),i=await this.webApiProviders.graphService(),c=r.toGraphSerializable();c.createdDateTime=M()().toDate().toISOString(),te.B.clientSettings.Flights.EnableDirectGraphConversationCalls?await i.postReplyInGroupConversationThreadAsync({groupId:e,threadId:t,newPost:r},a):await s.postReplyInGroupConversationThreadAsync({groupId:e,threadId:t,newPost:r},a);const n=x.L.builder.fromGraphPostResource(c,t).withLocallyUniqueId().build();return this.dispatcher.dispatchAction(new m.z(e,n.conversationThreadId,r,n,o)),this.loggers.traceLogger.logTrace(507896847,U.k.Verbose,"Post Reply In Group Coversation Thread - Success [GroupId=".concat(e,"][ThreadId=").concat(t,"][postId=").concat(r.id,"]")),n}catch(s){const o=s;return this.loggers.traceLogger.logTrace(507896846,U.k.Warning,"Post Reply In Group Coversation Thread - Fail [GroupId=".concat(e,"][ThreadId=").concat(t,"][postId=").concat(r.id,"] ").concat((0,oe.s8)(o))),Promise.reject(o)}}async joinGroup(e,t){this.loggers.traceLogger.logTrace(507896845,U.k.Verbose,"Join Group - Success [GroupId=".concat(e,"]"));try{const r=await this.webApiProviders.taskService();await r.joinGroupAsync({groupId:e},t),this.dispatcher.dispatchAction(new L.w(e,E.K.Group)),this.loggers.traceLogger.logTrace(507896844,U.k.Verbose,"Join Group - Success [GroupId=".concat(e,"]"))}catch(r){const t=r;return this.loggers.traceLogger.logTrace(507896843,U.k.Warning,"Join Group - Fail [GroupId=".concat(e,"] ").concat((0,oe.s8)(t))),Promise.reject(t)}}async leaveGroup(e,t){this.loggers.traceLogger.logTrace(507896842,U.k.Verbose,"Leave Group [containerId=".concat(e,"][containerType=").concat(E.K.Group,"]"));try{const r=await this.webApiProviders.taskService();await r.leaveGroupAsync({groupId:e},t),this.loggers.traceLogger.logTrace(507896841,U.k.Verbose,"Leave Group - Success [containerId=".concat(e,"][containerType=").concat(E.K.Group,"]")),this.dispatcher.dispatchAction(new C.v(e,E.K.Group))}catch(r){const t=r;return this.loggers.traceLogger.logTrace(507896840,U.k.Warning,"Leave Group - Fail [containerId=".concat(e,"][containerType=").concat(E.K.Group,"] ").concat((0,oe.s8)(t))),Promise.reject(t)}}async getJoinedGroups(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;this.loggers.traceLogger.logTrace(507896839,U.k.Verbose,"Get Joined Group");try{const o=await this.webApiProviders.taskService(),a=await o.getJoinedGroupsAsync({skipToken:e},r);return this.dispatcher.dispatchAction(new b.F(a.data,t)),this.loggers.traceLogger.logTrace(507896838,U.k.Verbose,"Get Joined Group - Success"),a}catch(c){var o,a,s,i;const e=c;return this.dispatcher.dispatchAction(new S(e.response,null!==(o=null===(a=e.response)||void 0===a?void 0:a.statusText)&&void 0!==o?o:"",null!==(s=null===(i=e.error)||void 0===i?void 0:i.message)&&void 0!==s?s:"")),this.loggers.traceLogger.logTrace(507896837,U.k.Warning,"Get Joined Group - Fail ".concat((0,oe.s8)(e))),Promise.reject(e)}}async validateGroupNamesAsync(e,t,r){this.loggers.traceLogger.logTrace(507896836,U.k.Verbose,"Validate Group Name [GroupId=".concat(e.id,"]"));const o=null!==r&&void 0!==r?r:j.Q.Priority5;try{const r=await this.webApiProviders.taskService(),a=await r.validateGroupNamesAsync({unifiedGroup:e,isCreation:t},o);return this.loggers.traceLogger.logTrace(507896835,U.k.Verbose,"Validate Group Name - Success [GroupId=".concat(e.id,"]")),a}catch(a){const t=a;return this.loggers.traceLogger.logTrace(507896834,U.k.Warning,"Validate Group Name - Fail [GroupId=".concat(e.id,"] ").concat((0,oe.s8)(t))),Promise.reject(t)}}async resolveGroupsToPlansBatchedAsync(e){this.loggers.traceLogger.logTrace(507896833,U.k.Verbose,"Resolve Groups to Plans [GroupIds=".concat(e.join(", "),"]"));try{const t=await this.webApiProviders.taskService(),r=await t.resolveGroupsToPlansBatchedAsync({groupIds:e});return this.dispatcher.dispatchAction(new A.T(r)),this.loggers.traceLogger.logTrace(507896832,U.k.Verbose,"Resolve Groups to Plans - Success [GroupIds=".concat(e.join(","),"]")),r}catch(s){var t,r,o,a;const i=s;return this.dispatcher.dispatchAction(new f(i.response,null!==(t=null===(r=i.response)||void 0===r?void 0:r.statusText)&&void 0!==t?t:"",null!==(o=null===(a=i.error)||void 0===a?void 0:a.message)&&void 0!==o?o:"")),this.loggers.traceLogger.logTrace(507896803,U.k.Warning,"Resolve Groups to Plans - Fail [GroupIds=".concat(e.join(","),"] ").concat((0,oe.s8)(i))),Promise.reject(i)}}async fetchPlansForGroup(e){this.loggers.traceLogger.logTrace(507896802,U.k.Verbose,"Fetch Plans For Group [GroupId=".concat(e,"]"));const t=e+"_fetchPlansForGroup";re.j.beginTransaction(this.dispatcher,{name:"fetchPlansForGroup",transactionId:t},this.loggers.logHandler);try{const r=await this.webApiProviders.taskService(),o=await r.resolveGroupsToPlansBatchedAsync({groupIds:[e]});return re.j.completeTransaction(this.dispatcher,{transactionId:t,action:new A.T(o)}),this.loggers.traceLogger.logTrace(507896801,U.k.Verbose,"Fetch Plans For Group - Success [GroupId=".concat(e,"]")),o}catch(i){var r,o,a,s;const c=i;return re.j.completeTransactionWithError(this.dispatcher,{transactionId:t,errorMessage:"",action:new f(c.response,null!==(r=null===(o=c.response)||void 0===o?void 0:o.statusText)&&void 0!==r?r:"",null!==(a=null===(s=c.error)||void 0===s?void 0:s.message)&&void 0!==a?a:"")}),this.loggers.traceLogger.logTrace(507896800,U.k.Warning,"Fetch Plans For Group - Fail [GroupId=".concat(e,"] ").concat((0,oe.s8)(c))),Promise.reject(c)}}}},54439:(e,t,r)=>{r.d(t,{j:()=>d});var o=r(29274),a=r(74427),s=r(57860),i=r(47204),c=r(74568),n=r(79947);class d{static beginTransaction(e,t,r){let{transactionId:a,name:s,logQos:i,action:n,additionalData:l}=t;if(!0===i){const e=new c.W({name:"Tx:"+s},r);d.qosEventsInFlight[a]=e}e.batchDispatchActions(new o.S(s,a,l),n)}static cancelTransaction(e,t){let{transactionId:r,action:o,additionalData:s}=t;const i=d.qosEventsInFlight[r];i&&(i.end({resultType:n.f.ExpectedFailure,extraData:s}),delete d.qosEventsInFlight[r]),e.batchDispatchActions(o,new a.D(r,s))}static completeTransaction(e,t){let{transactionId:r,action:o,additionalData:a}=t;const i=d.qosEventsInFlight[r];i&&(i.end({resultType:n.f.Success,extraData:a}),delete d.qosEventsInFlight[r]),e.batchDispatchActions(o,new s.M(r,a))}static completeTransactionWithBatch(e,t){let{transactionId:r,actions:o,additionalData:a}=t;const i=d.qosEventsInFlight[r];i&&(i.end({resultType:n.f.Success,extraData:a}),delete d.qosEventsInFlight[r]),e.batchDispatchActions(...o,new s.M(r,a))}static completeTransactionWithError(e,t){let{transactionId:r,errorMessage:o,action:a,additionalData:s}=t;const c=d.qosEventsInFlight[r];c&&(c.end({resultType:n.f.Failure,error:o,extraData:s}),delete d.qosEventsInFlight[r]),e.batchDispatchActions(a,new i.Y(r,o,s))}}d.qosEventsInFlight={}}}]);
//# sourceMappingURL=unifiedgroupmodule.e0330ea5.chunk.js.map