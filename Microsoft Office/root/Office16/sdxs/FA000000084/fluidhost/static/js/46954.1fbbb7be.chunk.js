/*! For license information please see 46954.1fbbb7be.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[46954],{57426:(e,t,o)=>{var r;o.d(t,{n:()=>r}),function(e){e[e.default=1]="default",e[e.copyLink=2]="copyLink",e[e.atMention=3]="atMention"}(r||(r={}))},46954:(e,t,o)=>{o.r(t),o.d(t,{SharepointShareService:()=>v});var r=o(57426),n=o(60835),i=o(33788),s=o(29018),a=o(72376),l=o(40635),c=o(74405),d=o(83545);const p=async(e,t,o,r,n)=>{const p=i.m.start(d.Il.CheckDocumentAccess,r);try{var u;const i=(0,s.$)(t.siteUrl),h={getToken:e=>{const r={...e,siteUrl:t.siteUrl,driveId:t.driveId,itemId:t.itemId};return o.getToken(["".concat(i,"/files.readwrite.all")],r)},url:"".concat(i,"/_api/v2.1/drives/").concat(t.driveId,"/items/").concat(t.itemId,"/oneDrive.checkAccess"),tenantId:n,requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:[{email:e.userPrincipalName,objectId:e.id}]})},retryPolicy:a._9,tokenPolicy:(0,a.N$)(o,!1)},m=r?await(0,l.g)({...h,logger:r,nameForLogging:d.Il.CheckDocumentAccess,getAdditionalProps:async(e,t)=>(0,c.u)(e)}):await(0,l.y)(h),g=await m.result.json();return p.setResult(!0),null===g||void 0===g||null===(u=g.value)||void 0===u||null===(u=u[0])||void 0===u?void 0:u.canWrite}catch(h){throw p.setResult(!1,{errorType:d.NN.CheckDocumentAccessError}),h}};var u=o(95996);const h="GetDocumentInfoError",m=(e,t,o)=>{var r;if(!t)return o&&(0,u.Ot)(o,{eventName:h}),e;if(!(0,n.g2)(t)){const t=new Error("Invalid file information: ResolvedUrl is not of the expected ODSP type");return o&&(0,u.hO)(o,{eventName:h},t),e}return{driveId:t.driveId,siteUrl:t.siteUrl,itemId:t.itemId,containerPackageName:null===(r=t.codeHint)||void 0===r?void 0:r.containerPackageName}};var g=o(44869);class v{get Disposable(){return this}dispose(){}get ShareService(){return this}async checkUserAccess(e){let{resolvedUrl:t,userPrincipalName:o}=e;const r=m(this.props.bootDocumentInfo,t,this.props.logger);return p({userPrincipalName:o,name:""},r,this.props.tokenProvider,this.props.logger,this.props.tenantId)}async grantPermissions(e){let{resolvedUrl:t,userPrincipalNames:o,uxConfiguration:n}=e;const i=m(this.props.bootDocumentInfo,t,this.props.logger),s=this.resolveShareUXConfig(n,{shareMode:r.n.atMention}),a=this.convertResolvedUrlToOdspUrlParts(this.props.bootDocumentInfo,t);return(0,g.zY)({tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.props.localization,defaultRecipients:o,...i,fileId:i.itemId,shareUXConfig:s,tenantId:this.props.tenantId,appName:this.props.appName,sharingContext:this.props.getFileContext?await this.props.getFileContext(a):void 0})}async checkRecipientAccess(e){let{resolvedUrl:t,recipient:o}=e;const r=m(this.props.bootDocumentInfo,t,this.props.logger);return p(o,r,this.props.tokenProvider,this.props.logger,this.props.tenantId)}async grantRecipientsPermission(e){let{resolvedUrl:t,recipients:o,uxConfiguration:n}=e;const i=m(this.props.bootDocumentInfo,t,this.props.logger),s=this.resolveShareUXConfig(n,{shareMode:r.n.atMention}),a=o.map((e=>e.id?e.id:e.userPrincipalName)),l=this.convertResolvedUrlToOdspUrlParts(this.props.bootDocumentInfo,t);return(0,g.zY)({tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.props.localization,defaultRecipients:a,...i,fileId:i.itemId,shareUXConfig:s,tenantId:this.props.tenantId,appName:this.props.appName,sharingContext:this.props.getFileContext?await this.props.getFileContext(l):void 0})}async shareLink(e){let{resolvedUrl:t,componentPath:o,navPayloadOptions:n,uxConfiguration:i,sharingContext:s}=e;const a=this.convertResolvedUrlToOdspUrlParts(this.props.bootDocumentInfo,t),l=this.resolveShareUXConfig(i,{shareMode:r.n.copyLink}),c={tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.props.localization,shareUXConfig:l,tenantId:this.props.tenantId};if(void 0===o){const e=m(this.props.bootDocumentInfo,t,this.props.logger);return(0,g.zY)({...c,...e,fileId:e.itemId})}const d=this.getComponentLocator(o,t);return(0,g.zY)({...c,...d,sharingContext:null!==s&&void 0!==s?s:this.props.getFileContext?await this.props.getFileContext(a,o):void 0,navPayloadOptions:n,fileId:d.itemId})}async generateShareLink(e){let{odspUrlParts:t,containerPackageName:o,componentPath:n,navPayloadOptions:i,uxConfiguration:s,sharingContext:a}=e;const l=this.resolveShareUXConfig(s,{shareMode:r.n.copyLink}),c={tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.props.localization,shareUXConfig:l,tenantId:this.props.tenantId},d=t||{siteUrl:this.props.bootDocumentInfo.siteUrl,driveId:this.props.bootDocumentInfo.driveId,itemId:this.props.bootDocumentInfo.itemId},p={containerPackageName:o,...d};if(void 0===n)return(0,g.zY)({...c,...p,fileId:p.itemId});const u={...p,dataStorePath:n,appName:this.props.appName};return(0,g.zY)({navPayloadOptions:i,fileId:u.itemId,...c,...u,sharingContext:null!==a&&void 0!==a?a:this.props.getFileContext?await this.props.getFileContext(d,n):void 0})}async getPermissions(e){let{resolvedUrl:t}=e;return(async(e,t,o,r)=>{const n=i.m.start(d.Il.GetPermissions,o);try{const i=(0,s.$)(e.siteUrl),d={getToken:o=>{const r={...o,siteUrl:e.siteUrl,driveId:e.driveId,itemId:e.itemId};return t.getToken(["".concat(i,"/files.readwrite.all")],r)},url:"".concat(i,"/_api/v2.1/drives/").concat(e.driveId,"/items/").concat(e.itemId,"/permissions"),tenantId:r,requestInit:{method:"GET"},retryPolicy:a._9,tokenPolicy:(0,a.N$)(t)},p=o?await(0,l.g)({...d,logger:o,nameForLogging:"GetPermissions",getAdditionalProps:async(e,t)=>(0,c.u)(e)}):await(0,l.y)(d),u=await p.result.json(),h=[],m={},g=[],v=e=>{if(e.email){const t={id:e.id,name:e.displayName,userPrincipalName:e.email};m[t.userPrincipalName]||(m[t.userPrincipalName]=t)}else g.push(e.displayName)};null!==u&&void 0!==u&&u.value&&u.value.map((e=>{if(e.grantedTo&&v(e.grantedTo.user),e.grantedToIdentities&&e.grantedToIdentities.map((e=>{v(e.user)})),e.link){const t={text:e.link.localizedDescription,scope:e.link.scope,type:e.link.type};e.link.webUrl&&(t.webUrl=e.link.webUrl),h.push(t)}}));const I={personas:Object.values(m),links:h,groups:g};return n.setResult(!0),I}catch(p){throw n.setResult(!1,{errorType:d.NN.GetPermissionsError}),p}})(m(this.props.bootDocumentInfo,t,this.props.logger),this.props.tokenProvider,this.props.logger,this.props.tenantId)}getComponentLocator(e,t){return{...m(this.props.bootDocumentInfo,t,this.props.logger),dataStorePath:e,appName:this.props.appName}}resolveShareUXConfig(e,t){var o;const r=(0,g.LL)(e)?e:t;var n,i,s,a;null!==r&&void 0!==r&&null!==(o=r.shareControl)&&void 0!==o&&o.props&&(r.shareControl.props={...r.shareControl.props,target:null!==(n=null===(i=r.shareControl.props)||void 0===i?void 0:i.target)&&void 0!==n?n:null===(s=(a=this.props).getShareUXTargetElement)||void 0===s?void 0:s.call(a)});return r}convertResolvedUrlToOdspUrlParts(e,t){return t&&(0,n.g2)(t)?{siteUrl:t.siteUrl,driveId:t.driveId,itemId:t.itemId}:{siteUrl:e.siteUrl,driveId:e.driveId,itemId:e.itemId}}constructor(e){this.props=e}}},48043:(e,t,o)=>{o.d(t,{QW:()=>r,yp:()=>n});class r extends Error{constructor(e,t,o,r,n){super(t||e),this.errorType=e,this.debugErrorMessage=o,this.spoError=r,this.spoErrorCategory=n}}const n={Loading:"Loading",Loaded:"Loaded",Error:"Error"}},44869:(e,t,o)=>{o.d(t,{yO:()=>J,GB:()=>K,Ic:()=>H,_5:()=>Z,LL:()=>B,tD:()=>V,iO:()=>$,zY:()=>Q,zq:()=>_});var r=o(65043),n=o(97950),i=o(51238),s=o(4563),a=o(75460),l=o(29018),c=o(60835),d=o(33608),p=o(48680),u=o(87416),h=o(53015),m=o(78632),g=o(57426),v=o(12179);const I=()=>null;var f=o(83545),P=o(48043),y=o(14525);let C;const S=e=>o(97959)("./".concat(e,"/ShareServiceStrings.json"));function U(e){return async function(e,t){var o;return(null===(o=C)||void 0===o?void 0:o.locale)!==t&&(C={locale:t,stringTablePromise:e(t).then((e=>(0,y.$)(e,t)))}),C.stringTablePromise}(S,e)}var k=o(60257),N=o(95996),E=o(33788);function w(e,t,o,r,n,i){const s=function(e){switch(e){case g.n.default:return"DefaultShare";case g.n.copyLink:return"CopyLink";case g.n.atMention:return"AtMention"}}(t);(0,N.Ot)(e,{eventName:f.Sz.ShareDialogOpened,entrypoint:s,sharePointCorrelationId:i}),r.then((t=>{(0,N.IA)(e,{eventName:f.Il.CompleteShare,succeeded:!0,shared:t,entrypoint:s,sharePointCorrelationId:i}),t&&(0,N.o4)(e,{eventName:f.ay.ShareDocument,entrypoint:s})})).catch((t=>{(0,N.IA)(e,{eventName:f.Il.CompleteShare,succeeded:!1,entrypoint:s,sharePointCorrelationId:i,errorType:t.errorType||f.NN.UnknownShareError,debugErrorMessage:t.debugErrorMessage,spoError:t.spoError,spoErrorCategory:t.spoErrorCategory},t)}));const a=E.m.start(f.Il.RenderShare,e);o.then((e=>{a.setResult(!0,{rendered:e,entrypoint:s,sharePointCorrelationId:i,...T(n,a.startTime)})})).catch((e=>{a.setResult(!1,{entrypoint:s,sharePointCorrelationId:i,errorType:e.errorType||f.NN.UnknownShareError,debugErrorMessage:e.debugErrorMessage,spoError:e.spoError,spoErrorCategory:e.spoErrorCategory,...T(n,a.startTime)},e)}))}function T(e,t){return{payloadLoadStartTime:(0,k.q)(e.payloadLoadStartTime,t),payloadLoadEndTime:(0,k.q)(e.payloadLoadEndTime,t),payloadSendStartTime:(0,k.q)(e.payloadSendStartTime,t),sharePointLoadStartTime:(0,k.q)(e.sharePointLoadStartTime,t)}}const b=/^var\((--[\w-]+)(?:,.*)?\)$/;function D(e,t){if(t)return Object.fromEntries(Object.entries(t).map((t=>{let[o,r]=t;const n=o;let i=r;const s=b.exec(r);if(s){const[,t]=s;i=e().getPropertyValue(t)}return[n,i]})))}var R=o(74086);const L="1",x="fluid",O="s",z="d",M="f",F="c",A="a",G="p",X="v",j="x";function q(e){const t=new URL(e.siteUrl),o=encodeURIComponent(t.pathname),r=encodeURIComponent(e.driveId),n=encodeURIComponent(e.itemId),i=encodeURIComponent(e.dataStorePath);let s="".concat(O,"=").concat(o,"&").concat(z,"=").concat(r,"&").concat(M,"=").concat(n,"&").concat(F,"=").concat(i,"&").concat(x,"=").concat(L);return e.appName&&(s+="&".concat(A,"=").concat(encodeURIComponent(e.appName))),e.containerPackageName&&(s+="&".concat(G,"=").concat(encodeURIComponent(e.containerPackageName))),e.fileVersion&&(s+="&".concat(X,"=").concat(encodeURIComponent(e.fileVersion))),e.context&&(s+="&".concat(j,"=").concat(encodeURIComponent(e.context))),(0,R.O0)(s)}function W(e,t){const o=q(e);if(t.includeFluidSignature)return o;const r=new URLSearchParams(atob(o));return r.delete("fluid"),btoa(r.toString())}function Y(e){return"Consumer"===e.identityType}function $(e){return!!Y(e)||"Enterprise"!==e.identityType}function Q(e){const t={},s=new a.c,l=new a.c,{shareUXConfig:c,localization:d,logger:p,correlationId:u}=e,h=(null===c||void 0===c?void 0:c.shareMode)||g.n.default,y=u||(0,i.A)();p&&w(p,h,l,s,t,y),(0,m.t)(25e3,[l,s]).then((e=>{if(e){const e=new P.QW(f.NN.IframeLoadTimeoutError);V(l,s,e)}})).catch((()=>{}));try{var C,S;t.payloadLoadStartTime=performance.now();let{theme:i,themeProperties:a,target:p}=null!==(C=null===c||void 0===c||null===(S=c.shareControl)||void 0===S?void 0:S.props)&&void 0!==C?C:{theme:void 0,themeProperties:void 0};!i&&a&&(i=(0,v.x)(a),c.shareControl.props.theme=i);const{shareControl:u,setFocusOnDismiss:m}=null!==c&&void 0!==c?c:{shareControl:void 0,setFocusOnDismiss:void 0},g=()=>{!function(e,t,o){e.resolve(o),t.resolve(o)}(l,s,!1),null===m||void 0===m||m()},f=p||document.createElement("div");if("Callout"===(null===u||void 0===u?void 0:u.type)){const i=r.lazy((()=>async function(e){const[t,n]=await Promise.all([U(e),o.e(9444).then(o.bind(o,57864))]);return{default:e=>r.createElement(n.ShareCalloutRenderer,{stringTable:t,...e})}}(d.locale)));n.render(r.createElement(r.Suspense,{fallback:r.createElement(I,null)},r.createElement(i,{onRenderPromise:l,onCompletePromise:s,onDismissCallout:g,perfMarks:t,localization:d,calloutProps:u.props,showShareProps:{...e,correlationId:y},shareMode:h})),f)}else{const i=r.lazy((()=>async function(e){const[t,n]=await Promise.all([U(e),o.e(94680).then(o.bind(o,50780))]);return{default:e=>r.createElement(n.ShareDialogRenderer,{stringTable:t,...e})}}(d.locale)));n.render(r.createElement(r.Suspense,{fallback:r.createElement(I,null)},r.createElement(i,{onRenderPromise:l,onCompletePromise:s,onDismissDialog:g,perfMarks:t,shareMode:h,localization:d,dialogProps:null===u||void 0===u?void 0:u.props,showShareProps:{...e,correlationId:y}})),f)}}catch(k){V(l,s,k)}return s}function _(e,t,o){const[n,i]=r.useState(new a.c);return r.useEffect((()=>{const r=document.createElement("div");document.body.append(r);const n=function(e,t){let o;const r=()=>(o||(o=getComputedStyle(e)),o);return{palette:D(r,t.palette),semanticColors:D(r,t.semanticColors)}}(r,t?(0,s.z)(e,t):e);r.remove(),i(async function(e,t){const{shareUXConfig:o,defaultRecipients:r,fileId:n,driveId:i,siteUrl:s,tenantId:a,tokenProvider:m,logger:v,dataStorePath:I,appName:y,containerPackageName:C,sharingContext:S,navPayloadOptions:U,correlationId:k,settingsProvider:N}=e,E=(null===o||void 0===o?void 0:o.shareMode)||g.n.default;if(!s||!i||!n)throw new P.QW(f.NN.GeneratePayloadError,"File information is missing");if("UnauthenticatedGuest"===m.identityType)throw new P.QW(f.NN.GeneratePayloadError,"UnauthenticatedGuest user is not allowed to use share functionality");const w=Y(m),T=(0,l.$)(s),[b,D,R]=await Promise.all([null!==o&&void 0!==o&&o.fileName?(0,c.sN)(m,s,i,n,v,a).then((e=>({name:o.fileName,sharepointIds:e}))):(0,c.OF)(m,s,i,n,v,a),m.getToken(["".concat(T,"/files.readwrite.all")],{tenantId:a}),w?Promise.resolve(""):(0,d.js)(m,v)]);if(null===b||void 0===b||!b.name||!b.sharepointIds)throw new P.QW(f.NN.GeneratePayloadError,"Failed to fetch file info");const L=D.token,x=void 0!==I?{siteUrl:s,driveId:i,itemId:n,dataStorePath:I,appName:y,containerPackageName:C,context:S}:void 0,O=(0,p.AU)("share.dropItemNameFromPayload",!0,N),z={mode:E,authToken:L,clientId:"fluid",itemName:O?void 0:b.name,isFolder:!1,isODB:T.indexOf("".concat(u.p7,"."))>0,organizationName:(0,h.E)(R)?"":R,webAbsoluteUrl:s,correlationId:k,navId:void 0!==x?W(x,U||{includeFluidSignature:!0}):void 0,listId:b.sharepointIds.listId,listItemId:b.sharepointIds.listItemId,theme:t};r&&(z.defaultRecipients=r,z.accessChecked=!0);return z}(o,n))}),[e,t,o]),n}function V(e,t,o){e.reject(o),t.reject(o)}function B(e){return!!e&&"shareMode"in e}const H=320,J=500,K=92;function Z(e){return Math.min(window.innerWidth,e)}},83545:(e,t,o)=>{o.d(t,{Il:()=>n,NN:()=>i,Sz:()=>s,ay:()=>r});const r={ShareDocument:"ShareDocument"},n={RenderShare:"RenderShare",CompleteShare:"CompleteShare",CheckDocumentAccess:"CheckDocumentAccess",GetPermissions:"GetPermissions"},i={GetPermissionsError:"GetPermissionsError",CheckDocumentAccessError:"CheckDocumentAccessError",GeneratePayloadError:"GeneratePayloadError",SpoShareError:"SpoShareError",SpoTimeoutError:"SpoTimeoutError",IframeLoadTimeoutError:"IframeLoadTimeoutError",UnknownShareError:"UnknownShareError",FluentUiError:"FluentUiError"},s={ShareDialogOpened:"ShareDialogOpened"}}}]);
//# sourceMappingURL=46954.1fbbb7be.chunk.js.map