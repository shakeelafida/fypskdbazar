"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[59941],{93401:(a,e,t)=>{t.r(e),t.d(e,{handleAshaEvent:()=>k,initializeAshaForFluid:()=>y,shutdownAshaForFluid:()=>w,updateAshaAdditionalPartCEventDataFromTelemetryProperties:()=>x});const n={partAMetadata:{},ariaTenantPrefix:"",ariaHeartbeatTenantPrefix:"",isAshaEnabled:!1,isHeartbeatEventEnabled:!1,additionalPartCEventData:{},heartbeatIntervalMs:18e5,pillarIntervalMs:864e5,disabledAshaErrors:[],sendTelemetryEventCallback:()=>{}};var r=t(90589);const i={dataCategories:2,diagnosticLevel:110};let s=[],o=[];function l(){o=[];for(const a in n.additionalPartCEventData)o.push({name:a,dataType:0,value:n.additionalPartCEventData[a].toString()})}function d(a,e){P&&n.isAshaEnabled&&n.sendTelemetryEventCallback({eventName:a,eventContract:{name:"AshaPartAMetadata",dataFields:s},dataFields:[...e,...o],eventFlags:i})}const v=new Set;let c=0,u=0;function E(a){P&&n.isAshaEnabled&&(c=Date.now(),d("".concat(n.ariaTenantPrefix,".Asha.Pillars"),[(0,r.m9)("Pillars",a?a.toString():[...v].join(","))]))}function p(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.pillarIntervalMs;u=window.setTimeout((()=>{v.size>0&&E(),p()}),a)}let h=0;function b(){P&&n.isAshaEnabled&&n.isHeartbeatEventEnabled&&0!==v.size&&d("".concat(n.ariaHeartbeatTenantPrefix,".Asha.Heartbeat"),[(0,r.m9)("Pillars",[...v].join(","))])}function f(){n.isHeartbeatEventEnabled&&0===h&&A()}function m(){0!==h&&(window.clearTimeout(h),h=0)}function A(){b(),h=window.setTimeout((()=>{A()}),n.heartbeatIntervalMs)}let P=!1;function T(a){var e,t,r,i;return!!(!P&&a&&a.partAMetadata&&a.ariaTenantPrefix&&a.ariaHeartbeatTenantPrefix&&a.sendTelemetryEventCallback)&&(n.partAMetadata=a.partAMetadata,n.ariaTenantPrefix=a.ariaTenantPrefix,n.ariaHeartbeatTenantPrefix=a.ariaHeartbeatTenantPrefix,n.isAshaEnabled=a.isAshaEnabled,n.isHeartbeatEventEnabled=a.isHeartbeatEventEnabled,n.additionalPartCEventData=null!==(e=a.additionalPartCEventData)&&void 0!==e?e:n.additionalPartCEventData,n.heartbeatIntervalMs=null!==(t=a.heartbeatIntervalMs)&&void 0!==t?t:n.heartbeatIntervalMs,n.pillarIntervalMs=null!==(r=a.pillarIntervalMs)&&void 0!==r?r:n.pillarIntervalMs,n.disabledAshaErrors=null!==(i=a.disabledAshaErrors)&&void 0!==i?i:n.disabledAshaErrors,n.sendTelemetryEventCallback=a.sendTelemetryEventCallback,function(){s=[];for(const a in n.partAMetadata)s.push({name:a,dataType:0,value:n.partAMetadata[a].toString()})}(),l(),P=!0,!0)}function I(){P&&n.isAshaEnabled&&(!function(a){a?M():g();n.isAshaEnabled=a}(!1),function(a){a?f():m();n.isHeartbeatEventEnabled=a}(!1),P=!1)}function C(a){n.additionalPartCEventData&&function(a,e){const t=Object.keys(a),n=Object.keys(e);return t.length===n.length&&t.every((a=>a in e))&&t.every((t=>a[t]===e[t]))}(n.additionalPartCEventData,a)||(n.additionalPartCEventData=Object.assign(Object.assign({},n.additionalPartCEventData),a),l(),b(),E())}function M(){P&&n.isAshaEnabled&&(f(),function(){if(0===u)if(0===c)p();else{const a=Date.now()-c;n.pillarIntervalMs&&a>=n.pillarIntervalMs||a<=0?(E(),p()):n.pillarIntervalMs&&p(n.pillarIntervalMs-a)}}())}function g(){m(),0!==u&&(window.clearTimeout(u),u=0)}const y=(a,e,t)=>{T({ariaHeartbeatTenantPrefix:a,ariaTenantPrefix:a,isAshaEnabled:!0,isHeartbeatEventEnabled:!0,sendTelemetryEventCallback:t,partAMetadata:{},additionalPartCEventData:F(e)})},w=I,x=a=>{C(F(a))},D=a=>{!function(a){if(!P||!n.isAshaEnabled||!a||v.has(a))return;const e=0===v.size;v.add(a),e?M():b(),E(a)}(a.props.pillar)},S=a=>{var e;e=a.props.pillar,P&&n.isAshaEnabled&&e&&v.has(e)&&(v.delete(e),E(e),b(),0===v.size&&g())},N=a=>{const{props:e}=a,{errorName:t,veto:r,pillar:i,durationMs:s,inStaging:o,isIntentional:l,isInternal:c,isSessionEndingError:u,stack:p,...h}=e;C(F(h)),function(a){var e;if(!P||!n.isAshaEnabled||!a||!a.errorName)return;if(n.disabledAshaErrors)for(const r of n.disabledAshaErrors)if(r.vetoName){if(r.vetoName.toLowerCase()===a.veto.name.toLowerCase()&&r.errorName.toLowerCase()===a.errorName.toLowerCase())return}else if(r.errorName.toLowerCase()===a.errorName.toLowerCase())return;const t=[{name:"Pillar",dataType:0,value:a.veto.pillar},{name:"Veto",dataType:0,value:a.veto.name},{name:"InStaging",dataType:1,value:null===(e=a.inStaging)||void 0===e||e}];if(void 0!==a.isIntentional&&t.push({name:"IsIntentional",dataType:1,value:a.isIntentional}),void 0!==a.isInternal&&t.push({name:"IsInternal",dataType:1,value:a.isInternal}),void 0!==a.durationMs&&t.push({name:"DurationMs",dataType:3,value:a.durationMs}),void 0!==a.isSessionEndingError&&t.push({name:"IsSessionEndingError",dataType:1,value:a.isSessionEndingError}),void 0!==a.extendedProperties)for(const n in a.extendedProperties)t.push({name:"ExtendedProperties_".concat(n),dataType:0,value:a.extendedProperties[n].toString()});v.has(a.veto.pillar)?d("".concat(n.ariaTenantPrefix,".Asha.Error.").concat(a.errorName),t):(t.push({name:"Error",dataType:0,value:a.errorName}),t.push({name:"FailureReason",dataType:0,value:"Inactive Pillar"}),d("".concat(n.ariaTenantPrefix,".Asha.ApiError.DroppedErrors"),t)),a.isSessionEndingError&&(E(),I())}({errorName:t,veto:{name:r,pillar:i},durationMs:s,inStaging:o,isIntentional:l,isInternal:c,isSessionEndingError:u,extendedProperties:{stack:p}})},k=async a=>{const{props:e}=a;switch(e.eventName){case"AshaPillarAdd":return D(a);case"AshaPillarRemove":return S(a);case"AshaError":return N(a)}},H=["containerType","hostCorrelationId","hostName","hostScenarioName"],F=a=>{const e={};for(const t of H){const n=a[t];void 0!==n&&"object"!==typeof n&&(e[t]=n)}return e}}}]);
//# sourceMappingURL=AshaUtils.ccfc992a.chunk.js.map