"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[90055],{66538:(e,t,n)=>{n.r(t),n.d(t,{WSETFoundInPlaces:()=>w,getNonOdspSharingHistory:()=>m,getOdspWsetSharingHistory:()=>g});var r=n(72376),o=n(30946),s=n(40635),i=n(60980);async function a(e){const t=e.split("://");if(t.length<2)return"";const n=t[1],r=(new TextEncoder).encode(n),o=await async function(e){const t=await window.crypto.subtle.digest("SHA-256",e);return t}(r),s="WL_"+function(e){let t="";for(const n of e)switch(n){case"+":t+="-";break;case"/":t+="_";break;case"=":t+="";break;default:t+=n}return t}(function(e){let t="";const n=new Uint8Array(e),r=n.byteLength;for(let o=0;o<r;o+=1)t+=String.fromCharCode(n[o]);return window.btoa(t)}(o));return s}var c=n(56993);const l="https",d="".concat(l,"://").concat("outlook.office.com"),u="".concat(l,"://").concat("teams.microsoft.com");function p(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(e.ReferenceType){case"Mail":return t?function(e){if(void 0===e)return d;return"".concat(h).concat(encodeURIComponent(function(e){const t=function(e){const t=window.atob(e);return Uint8Array.from(t,(e=>e.charCodeAt(0)))}(e);if(t.length<2)return"";const n=t.length-2+5,r=new Uint8Array(n);r[0]=0,r[1]=9,r[2]=0,r[3]=46,r[4]=0;for(let o=1;o<=t.length-2;o+=1)r[o+4]=t[o];return function(e){let t="";for(const n in e)t+=String.fromCharCode(e[n]);return window.btoa(t)}(r)}(e)))}(e.ReferenceId):d;case"Teams":return n?function(e,t){let n=u;e&&t?n="".concat(u,"/l/message/").concat(e,"/").concat(t,'?context={"contextType":"chat"}'):e&&(n="".concat(u,"/l/chat/").concat(e,"/conversations"));return n}(e.TeamsMessageThreadId,e.ServerMessageId):u;default:return}}const h="".concat(d,"/mail/deeplink/read/");const f=(e,t)=>({getToken:e=>t.getToken(["https://substrate.office.com/Files.Read.All"],e),url:e,requestInit:{method:"GET",headers:{Prefer:'exchange.behavior="SubstrateFiles,OpenComplexTypeExtensions"'}},retryPolicy:r._9});async function g(e,t,n){const r=await(0,o.A7)(t,e),i="https://substrate.office.com/api/beta/me/workingsetfiles('SPOID:".concat(r,"')?$select=AllExtensions/SharingHistory&$filter=ItemProperties/Shared/LastSharedWithMailboxOwnerDateTime ne null and Visualization/Type eq 'Fluid'"),a=f(i,t),l=n?await(0,s.g)({...a,logger:n,nameForLogging:"FoundInPlaces"}):await(0,s.y)(a);return(await l.result.json().catch((e=>{n&&(0,c.e)(n,{eventName:"WsetApiJsonParsingError",subErrorName:"FluidLoopComponent"},e)}))).AllExtensions}async function m(e,t,n){var r,o;const i=await a(e);if(""===i)return;const l="https://substrate.office.com/api/beta/me/workingsetfiles?$select=AllExtensions/SharingHistory&$filter=ItemProperties/SharedFile/ExternalResourceId eq '".concat(i,"'"),d=f(l,t),u=n?await(0,s.g)({...d,logger:n,nameForLogging:"FoundInPlaces"}):await(0,s.y)(d);return null!==(r=null===(o=(await u.result.json().catch((e=>{n&&(0,c.e)(n,{eventName:"WsetApiJsonParsingError",subErrorName:"FluidNonLoopComponent"},e)}))).value)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.AllExtensions)&&void 0!==r?r:void 0}class w{get foundInPlacesServicePromise(){return Promise.resolve(this)}async getFoundInPlaces(e){let{documentUrl:t}=e;const n=await this.getWSETFoundInPlacesResponse(this.tokenProvider,t,this.logger),r=this.parseWsetApiResponse(n);return this.transformWSETFoundInPlacesResponse(r)}async getWSETFoundInPlacesResponse(e,t,n){const r=n||this.logger;if(void 0===t)return void(r&&(0,c.e)(r,{eventName:"WsetApiUrlUndefinedError"}));const o=await async function(e,t,n){try{return await(0,i.j)(e,t,n)}catch{return}}(t,e,r);let s;return s=o?await g({siteUrl:o.siteUrl,driveId:o.driveId,fileId:o.itemId},e,r):await m(t,e,r),s}parseWsetApiResponse(e){const t=[],n=new Set;try{var r;null===e||void 0===e||null===(r=e.SharingHistory)||void 0===r||null===(r=r.Instances)||void 0===r||r.forEach((e=>{const r="".concat(e.ReferenceType,",").concat(e.Subject);if(""===e.Subject||!n.has(r)){const o={SharingHistory:{Instances:[e]}};t.push({AllExtensions:o}),n.add(r)}}))}catch(o){this.logger&&(0,c.e)(this.logger,{eventName:"WsetReponseProcessingError"},o)}return{value:t}}transformWSETFoundInPlacesResponse(e,t,n){var r;const o=null===(r=e.value)||void 0===r?void 0:r.map((e=>{var r;const o=null===(r=e.AllExtensions)||void 0===r||null===(r=r.SharingHistory)||void 0===r||null===(r=r.Instances)||void 0===r?void 0:r[0];if(!o)return void(n&&(0,c.e)(n,{eventName:"WsetReponseProcessingError"}));const s=this.normalizeWSETLocation(o.ReferenceType);return{host:s.host,location:s.location,subject:o.Subject,collaborators:(o.Participants||[]).map((e=>({name:e.DisplayName,smtp:e.Smtp}))),url:this.getLocationLink(o,t,this.logger)}}));return{places:null===o||void 0===o?void 0:o.filter((e=>void 0!==e))}}normalizeWSETLocation(e){switch(e){case"Mail":return{host:"Outlook",location:"Email"};case"CalendarEvent":return{host:"Outlook",location:"Calendar"};case"Teams":return{host:"Teams",location:"Chat"};case"Loop":return{host:"Loop",location:"Workspace"};default:return{host:"other",location:"other"}}}getLocationLink(e,t,n){let r=p(e,this.owaDeeplinksEnabled,this.teamsDeeplinksEnabled);return!r&&t&&function(e){try{return new URL(e),!0}catch{return!1}}(t)&&(r=t),r||n&&(0,c.e)(n,{eventName:"InvalidDocumentUrl"}),r}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.tokenProvider=e,this.logger=t,this.owaDeeplinksEnabled=n,this.teamsDeeplinksEnabled=r}}},60980:(e,t,n)=>{n.d(t,{j:()=>p});var r=n(29018),o=n(40635),s=n(74405),i=n(25969),a=n(72376),c=n(66206),l=n(18206);const d=["files.readwrite.all"],u="https://graph.microsoft.com/v1.0";async function p(e,t,n){var p,h;const f=(0,r.$)(e),g="Consumer"===t.identityType&&f===c.W,m=btoa(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,""),w=g?u:"".concat(f,"/_api/v2.0"),I={getToken:e=>{const n={...e,siteUrl:f};return t.getToken(g?d:(0,i.K)(f),g?e:n)},url:"".concat(w,"/shares/u!").concat(m,"/driveItem?select=id,name,parentReference,sharepointIds"),requestInit:{method:"GET",headers:{Prefer:"redeemSharingLink"}},retryPolicy:g?l.XM:a._9,tokenPolicy:g?void 0:(0,a.N$)(t)},v=n?(0,o.g)({...I,logger:n,nameForLogging:"getOdspItemWithSharepointIdsFromLink",doNotLogOnSuccess:!0,getAdditionalProps:async(e,t)=>(0,s.u)(e)}):(0,o.y)(I),E=await(await v).result.json();if(g)return function(e,t){if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");return{itemId:e.id,driveId:e.parentReference.driveId,siteUrl:t,fileName:e.name,listId:"",listItemId:"",siteId:"",webId:"",listItemUniqueId:"",title:""}}(E,f);if(null===(p=E.sharepointIds)||void 0===p||!p.siteUrl)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if(null===(h=E.parentReference)||void 0===h||!h.driveId)throw new Error("Unexpected response: missing parentReference.driveId");if(!E.id)throw new Error("Unexpected response: missing id");return function(e){if("object"!==typeof e)throw new Error("Unexpected response");if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");const{sharepointIds:t}=e;if(!t)throw new Error("Unexpected response: missing sharepointIds");const{listId:n,listItemId:r,siteId:o,webId:s,siteUrl:i,listItemUniqueId:a}=t;if("string"!==typeof n)throw new Error("Unexpected response: missing sharepointIds.listId");if("string"!==typeof r)throw new Error("Unexpected response: missing sharepointIds.listItemId");if("string"!==typeof o)throw new Error("Unexpected response: missing sharepointIds.siteId");if("string"!==typeof s)throw new Error("Unexpected response: missing sharepointIds.webId");if("string"!==typeof i)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if("string"!==typeof a)throw new Error("Unexpected response: missing sharepointIds.listItemUniqueId");return{driveId:e.parentReference.driveId,siteUrl:i,itemId:e.id,listId:n,listItemId:r,siteId:o,webId:s,listItemUniqueId:a,fileName:e.name,title:e.title}}(E)}},30946:(e,t,n)=>{function r(e){const t=window.btoa(e);return t.replace(/(\+|\/|\=)/g,(e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError("Unexpected match ".concat(e," encountered in urlEncodeBase64String. Only +/= are to be replaced."))}))}n.d(t,{A7:()=>s});var o=n(60835);async function s(e,t,n){const{siteUrl:r,driveId:s,fileId:a}=t,c=await(0,o.sN)(e,r,s,a,n);if(!c)throw new Error("Failed to fetch file sharepoint ids");return i(c,a)}function i(e,t){const{siteId:n,webId:o,listId:s}=e;return"SPO_".concat(r("".concat(n,",").concat(o,",").concat(s)),"_").concat(t)}}}]);
//# sourceMappingURL=WSETFoundInPlaces.4843e7af.chunk.js.map