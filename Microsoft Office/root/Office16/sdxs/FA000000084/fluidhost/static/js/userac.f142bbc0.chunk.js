"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[9770],{36591:(e,t,r)=>{r.d(t,{C:()=>i});class i{constructor(e,t,r,i,s){this.dispatcher=e,this.logicModuleProviders=t,this.entityStoreSet=r,this.clientSettings=i,this.loggers=s}}},2269:(e,t,r)=>{r.r(t),r.d(t,{UserActionCreator:()=>G});var i=r(86178),s=r.n(i),o=r(49226),a=r(53672),n=r(24367),l=r(15507),c=r(28296),u=r(59923),d=r(50739),h=r(79558),p=r(91955),g=r(36591),S=r(38629),v=r(38752),P=r(95783),y=r(64226),f=r(96891),T=r(77508),w=r(99908),U=r(81206),b=r(3854),m=r(97498),C=r(52274),M=r(76171),j=r(86053);class A extends M.m{name(){return"ProjectTrialToast"}constructor(e,t,r){const i=j.p.Strings.Toasts_ProjectTrialAcquisitionSuccessful,s=t?j.p.Strings.Toasts_CopyPlanToProject:j.p.Strings.Toasts_OpenProject,o={mainContent:M.m.getMainContent(s,e,"".concat(i," - "),void 0,(()=>null===r||void 0===r?void 0:r(this.id))),ariaAlertMessage:i,onDismiss:()=>{},projectLink:e,toastDataType:M.m.toastDataType};super(A.type,o),this.timeout=-1}}A.type="PROJECT_TRIAL_TOAST";var L=r(35375),I=r(63615),D=r(66878),E=r(18113),F=r(74844),x=r(80493),O=r(21382),R=r(33268),k=r(22514);class G extends g.C{get name(){return f.M.UserActionCreator}async fetchUsers(e,t){(await this.logicModuleProviders.userModule()).fetchUsersAsync(e,t).catch((e=>{}))}async fetchUsersForContainer(e,t,r){const i=await this.logicModuleProviders.userModule(),s=await this.logicModuleProviders.notificationModule();i.fetchUsersForContainerAsync(e,t,r).catch((t=>s.handleRequestFailures(t,[],[P.t3.Forbidden,P.t3.NotFound],y.fc.GetGroupMembersError,e.externalId)))}async fetchUsersWithKeyword(e){return(await this.logicModuleProviders.userModule()).fetchUsersWithKeyword(e)}async fetchUserPhoto(e){(await this.logicModuleProviders.userModule()).fetchUserPhotoAsync(e).catch((e=>{}))}async fetchUserAccessibleSensitivityLabels(){(await this.logicModuleProviders.userModule()).fetchUserAccessibleSensitivityLabelsAsync().catch((e=>{}))}async updateUserCulture(){const e=await this.logicModuleProviders.userModule(),t=[e.fetchUserAsync(v.B.currentUserId,!0),e.fetchCurrentUserDetailsAsync()];Promise.allSettled(t).then((e=>{if("fulfilled"!==e[0].status||"fulfilled"!==e[1].status)return;const t=e[0].value,r=e[1].value;if(null!=t&&null!=r&&null!=r.userData&&(null!=r.userData.settings||null!=t.preferredLanguage)&&(null==r.userData.settings||r.userData.settings.culture!==t.preferredLanguage)){const e=r.setUserCulture(t.preferredLanguage),i=null==t.preferredLanguage?"":t.preferredLanguage.toLowerCase();this.loggers.usageLogger.logData(this.name,"updateUserCulture",{mismatch:String(v.B.culture.toLowerCase()!==i)}),this.updateUserDetails(r,e)}}))}async updateUserDetails(e,t){(await this.logicModuleProviders.userModule()).updateUserDetailsAsync(e,t).catch((e=>{}))}updateUserTheme(e){this.dispatcher.dispatchAction(new l.k(e))}overrideProductLicense(e,t){this.dispatcher.dispatchAction(new c.n(e,t))}overrideProjectUpsellMode(e){this.dispatcher.dispatchAction(new d.i(e))}async addUsersToContainer(e,t){const r=await this.logicModuleProviders.containerModule(),i=await this.logicModuleProviders.notificationModule();r.addUsersToContainerAsync(t,e).then(void 0,(t=>{if(!(t.error instanceof C.U)){var r,s;const o=null===(r=t.response)||void 0===r?void 0:r.status,a=null===(s=t.response)||void 0===s?void 0:s.statusText;o===P.t3.NotImplemented?this.loggers.traceLogger.logTrace(508069716,F.k.Error,"addUsersToGroup - Not Implemented"):i.showErrorInternal(y.fc.AddUsersToGroupError,o,a,e.length.toString(),t.response)}}))}async removeUserFromContainer(e,t){const r=await this.logicModuleProviders.containerModule(),i=await this.logicModuleProviders.notificationModule();r.removeUserFromContainerAsync(t,e).then(void 0,(t=>{if(!(t.error instanceof C.U)){var r,s;const o=null===(r=t.response)||void 0===r?void 0:r.status,a=null===(s=t.response)||void 0===s?void 0:s.statusText;i.showErrorInternal(y.fc.RemoveUserFromGroupError,o,a,e,t.response)}}))}async fetchCurrentUserLicenses(){const e=this.entityStoreSet.appContextStore.getCurrentUserId(),t=this.entityStoreSet.appContextStore.getFlights().EnforceLicenseCheck?E.Q.Priority1:E.Q.Priority5;(await this.logicModuleProviders.userModule()).fetchUserLicensesAsync(e,t).then((t=>{this.loggers.usageLogger.logData(this.name,f.M.GetUserLicenses,{tenantId:v.B.tenantId,userId:e,plannerLicenseStatus:t[w.b.Planner]})})).catch((e=>{}))}async fetchCurrentUserProjectSubscriptionStatus(e){try{var t,r,i,o,a,n;const c=await this.logicModuleProviders.projectModule(),u=await c.fetchCurrentUserSubscriptionStatus(e),d=null===u||void 0===u?void 0:u.trialOffer,h=(null===d||void 0===d||null===(t=d.p1DepartmentalTrial)||void 0===t?void 0:t.eligibilityStatus)||(null===d||void 0===d||null===(r=d.p3DepartmentalTrial)||void 0===r?void 0:r.eligibilityStatus),p=null===(i=u.highestTrialSubscription)||void 0===i?void 0:i.subscriptionStatus,g=p===S.gr.Disabled||p===S.gr.InGracePeriod||p===S.gr.Deprovisioned?f.M.SessionExpiredTrial:f.M.SessionShowsTryProject;if(d)h===S.RG.EligibleToRequestOnly?this.loggers.usageLogger.logData(this.name,"".concat(g,"-","EligibleToRequestOnly")):h===S.RG.EligibleForSelfService&&this.loggers.usageLogger.logData(this.name,"".concat(g,"-","EligibleForSelfService"));else if((null===u||void 0===u||null===(o=u.highestTrialSubscription)||void 0===o?void 0:o.subscriptionType)===S.h3.Trial&&(null===u||void 0===u||null===(a=u.highestTrialSubscription)||void 0===a?void 0:a.subscriptionStatus)===S.gr.Active){var l;const e=s()(null===u||void 0===u||null===(l=u.highestTrialSubscription)||void 0===l?void 0:l.expiryDate).diff(s()(),"days");e>=0&&e<28&&k.q.logFloodgateActivity(b.zs,this.loggers.traceLogger),this.loggers.usageLogger.logData(this.name,f.M.SessionShowsGoToProject)}if(u.hasLicense&&(null===(n=u.currentOrNextSubscription)||void 0===n?void 0:n.subscriptionType)===S.h3.Paid&&this.entityStoreSet.appContextStore.getFlights().EnableImportPlanForProjectUsers){const e=await this.logicModuleProviders.tenantModule();await e.fetchHasProjectCogs()}}catch(c){}}clearProjectSubscriptionStatus(e){this.dispatcher.dispatchAction(new u.w(e))}async acquireProjectTrialForCurrentUser(){try{const e=await this.logicModuleProviders.projectModule();await e.acquireTrialForCurrentUser()}catch(e){}}async fetchCurrentUserProjectTrialOperationStatus(e){try{const t=await this.logicModuleProviders.projectModule();await t.fetchCurrentUserTrialOperationStatus(e)}catch(t){}}async startProjectTrialAndPlanImport(e,t){try{const r=await this.logicModuleProviders.projectModule();if(v.B.clientSettings.Flights.EnableAutoClaimPlanner){(await r.claimSubscription()).assignedProductSkuId&&await this.processImportToProject(e,t)}else{const i=await r.acquireTrialForCurrentUser();null!=i.lowFrictionTrialId&&await this.processTrialOperationStatus(i,i.lowFrictionTrialId,0,e,t)}}catch(r){}}async toggleUserFavoritePlanStatus(e){var t;const r=this.entityStoreSet.appContextStore.getCurrentUserId(),i=null===(t=this.entityStoreSet.userStore.getUserDetailsById(r))||void 0===t?void 0:t.favoritePlans;let s=!1;if(null!=(null===i||void 0===i?void 0:i.references)){s=null!=i.references[e.id];const t=s?i.removePlanReference(e.id):i.setPlanReference(e.id,L.j.builder.withPropertyBag({planTitle:e.title}).build());this.dispatcher.dispatchAction(new h.d(t))}}async updateUserFavoritePlans(e){this.dispatcher.dispatchAction(new h.d(I.H.builder.withPropertyBag({favoritePlanReferences:e}).build()))}async updateUserRecentPlans(e){this.dispatcher.dispatchAction(new p.E(D.E.builder.withPropertyBag({references:e}).build()))}async processTrialOperationStatus(e,t,r,i,s){switch(e.operationStatus){case S.LH.Initialized:case S.LH.Pending:this.checkProjectTrialOperationStatusRecursive(t,r,i,s);break;case S.LH.Completed:await this.processImportToProject(i,s);case S.LH.Failed:}}async processImportToProject(e,t){const r=this.entityStoreSet.appContextStore.getExperiment(U.b.UpsellImportPlan)===U.b.UpsellImportPlan_treatment;let i=null;const s=this.entityStoreSet.appContextStore.getCurrentDialogData();if(s.dialogType===m.h.TryProjectDialog&&(i=r&&t?x.b.safelyOpenExternalUrl((0,R.lo)(t)):x.b.safelyOpenExternalUrl(this.generateProjectRedirectUrl(e),"_blank"),null==i&&this.loggers.traceLogger.logTrace(507581902,F.k.Info,"Project popup was blocked, showing a toast"),this.dispatcher.dispatchAction(new o.u(s))),null==i){let i;const s=e=>{this.dispatcher.dispatchAction(new a.n(e))};i=r&&t?new A((0,R.lo)(t),!0,s):new A(this.generateProjectRedirectUrl(e),!1,s),this.dispatcher.dispatchAction(new n.Z(i))}await this.fetchCurrentUserProjectSubscriptionStatus(!0)}async checkProjectTrialOperationStatusRecursive(e,t,r,i){if(!(t>=this.entityStoreSet.appContextStore.getECSSettings().ProjectTrialOperationStatus.RetryMaxCount))try{const s=await this.logicModuleProviders.projectModule();setTimeout((async()=>{try{const o=await s.fetchCurrentUserTrialOperationStatus(e);await this.processTrialOperationStatus(o,e,t+1,r,i)}catch(o){}}),this.entityStoreSet.appContextStore.getECSSettings().ProjectTrialOperationStatus.RetryInterval)}catch(s){}}generateProjectRedirectUrl(e){switch(e){case T.b4.PlanTimelinePage:const e=this.entityStoreSet.appContextStore.getExperiment(U.b.UpsellTimelinePage);return e===U.b.UpsellTimelinePage_control||e===U.b.UpsellTimelinePage_treatment?O.G((0,R.sN)(),U.b.UpsellTimelinePage):(0,R.XY)();case T.b4.TryProjectDialog:case T.b4.PlanGridPage:default:return(0,R.XY)()}}constructor(e,t,r,i){super(e,t,r,v.B.clientSettings,i)}}}}]);
//# sourceMappingURL=userac.f142bbc0.chunk.js.map