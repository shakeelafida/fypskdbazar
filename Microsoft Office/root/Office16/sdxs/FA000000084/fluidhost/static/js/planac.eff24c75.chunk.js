"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[51306],{36591:(e,t,n)=>{n.d(t,{C:()=>a});class a{constructor(e,t,n,a,i){this.dispatcher=e,this.logicModuleProviders=t,this.entityStoreSet=n,this.clientSettings=a,this.loggers=i}}},64569:(e,t,n)=>{n.r(t),n.d(t,{PlanActionCreator:()=>x});var a=n(23835),i=n(45679),o=n(24367),s=n(72261),r=n(72438),l=n(36591),c=n(38752),d=n(7811),u=n(64226),p=n(96891),h=n(65818),g=n(95952),v=n(76171),P=n(86053);class y extends v.m{name(){return"CopyPlanToast"}constructor(e,t,n,a){let i;const o=a?P.p.Strings.SharedComponents_CopyPlanFinishedToastContent:P.p.Strings.SharedComponents_CopyPlanInProgressToastContent;if(a){if(null==e)throw new Error("ArgumentNullException: planId");if(null==t)throw new Error("ArgumentNullException: planName");if(null==n)throw new Error("ArgumentNullException: planLink");i={toastDataType:v.m.toastDataType,mainContent:v.m.getMainContent(t,n,"".concat(o," - ")),ariaAlertMessage:o,onDismiss:()=>{},planName:t,planId:e,hasCopyPlanFinished:a}}else i={toastDataType:v.m.toastDataType,mainContent:o,ariaAlertMessage:o,onDismiss:()=>{},planName:t,planId:e,hasCopyPlanFinished:a};super(y.type,i)}}y.type="COPY_PLAN_TOAST";var f=n(40468),w=n(95810),m=n(52274),T=n(97498),D=n(35640),S=n.n(D),M=n(9821),A=n(19853),C=n.n(A),U=n(9962),I=n(33268),F=n(74844),E=n(54439),b=n(82841);class x extends l.C{get name(){return p.M.PlanActionCreator}async fetchPlan(e,t,n){(await this.logicModuleProviders.planModule()).fetchPlanAsync(e,t,n).catch((()=>{}))}async createPlan(e,t){const n=await this.logicModuleProviders.planModule(),a=await this.logicModuleProviders.notificationModule(),i=await this.logicModuleProviders.telemetryModule();try{await n.createPlanAsync(e,!1,t),a.enqueueHiddenToastNotification("SharedComponents_CreatePlanToastTitle",[],e.plan.title),i.logPlanCreatedUsage(p.M.PlanActionCreator)}catch(o){a.handleRequestFailures(o,[],[],u.fc.CreatePlanError,void 0,[e.plan.title])}}async copyPlan(e,t,n,i,r,l){var c;const d=this.entityStoreSet.containerStore.getContainer(n.id);if(null!==d&&d.containerType!==h.K.Group)return;const p=null!==(c=null===d||void 0===d?void 0:d.unifiedGroup)&&void 0!==c?c:null,g=await this.logicModuleProviders.notificationModule(),v=w.c.builder.withPropertyBag({id:"",title:t}).withLocallyUniqueId().build();if(null!=p){E.j.beginTransaction(this.dispatcher,{name:"copyPlanToExistingGroup",transactionId:i},this.loggers.logHandler);const n=new y(null,null,null,!1);this.dispatcher.dispatchAction(new o.Z(n));(await this.logicModuleProviders.planModule()).copyPlanAsync(e.id,v.title,p.id,r,l,Date.now(),!1).then((()=>{E.j.completeTransaction(this.dispatcher,{transactionId:i})}),(e=>{if(!(e.error instanceof m.U)){var n,i;const o=null===(n=e.response)||void 0===n?void 0:n.status,s=null===(i=e.response)||void 0===i?void 0:i.statusText;433===o?this.dispatcher.dispatchAction(new a.i(u.fc.CopyPlanError,o,s,void 0,[t])):g.showErrorInternal(u.fc.CopyPlanError,o,s,void 0,e.response,[t])}}))}else E.j.beginTransaction(this.dispatcher,{name:"createUnifiedGroup",transactionId:i},this.loggers.logHandler),this.logicModuleProviders.unifiedGroupModule().then((c=>{c.validateNamesBeforeCreateRecursive(n,n.displayName,0,0).then((n=>{E.j.completeTransaction(this.dispatcher,{transactionId:i});const s=new y(null,null,null,!1);this.dispatcher.dispatchAction(new o.Z(s)),c.createGroup(n).then((async t=>{const i=t.displayName,o=Date.now();(await this.logicModuleProviders.planModule()).copyPlanAsync(e.id,i,t.id,r,l,o,!0).then((()=>{if(n.autoSubscribeNewMembers){const e=t.setProperty("autoSubscribeNewMembers",!0);c.updateUnifiedGroup(t,e).then((n=>{g.announceUnifiedGroupUpdates(t,e)})).catch((()=>{}))}})).catch((e=>{if(!(e.error instanceof m.U)){var t,n;const o=null===(t=e.response)||void 0===t?void 0:t.status,s=null===(n=e.response)||void 0===n?void 0:n.statusText;433===o?this.dispatcher.dispatchAction(new a.i(u.fc.CopyPlanError,o,s,void 0,[i])):g.showErrorInternal(u.fc.CopyPlanError,o,s,void 0,e.response,[i])}}))}),(e=>{var n,a;const i=null===(n=e.response)||void 0===n?void 0:n.status,o=null===(a=e.response)||void 0===a?void 0:a.statusText;g.showErrorInternal(u.fc.CreateGroupError,i,o,void 0,e.response,[t])}))}),(e=>{E.j.completeTransaction(this.dispatcher,{transactionId:i,action:new s.c(e),additionalData:{errorCode:e}})}))}))}async subscribeCurrentUserToPlan(e){(await this.logicModuleProviders.planModule()).subscribeUserToPlanAsync(this.entityStoreSet.appContextStore.getCurrentUserId(),e).catch((()=>{}))}async updatePlanEntitySet(e,t,n){const a=await this.logicModuleProviders.planModule(),i=await this.logicModuleProviders.notificationModule();a.updatePlanAsync(e,t,n).then((async n=>{const a=e.plan.getDiff(t.plan),o=null!=e.planDetails&&null!=t.planDetails?e.planDetails.getDiff(t.planDetails):{};i.announcePlanUpdates(a,o,e);const s=this.entityStoreSet.userStore.getUserDetailsById(c.B.currentUserId);if(s)try{const e=s.updateRecentAndFavoritePlanTitles(n.id,n.plan.title),t=await this.logicModuleProviders.userModule();await t.updateUserDetailsAsync(s,e)}catch(r){this.loggers.traceLogger.logTrace(507880129,F.k.Warning,"updatePlanEntitySet Update User Details - Failure ".concat((0,b.LB)(r)))}}),(t=>{if(!(t.error instanceof m.U)){var n,a;const o=null===(n=t.response)||void 0===n?void 0:n.status,s=null===(a=t.response)||void 0===a?void 0:a.statusText,r=e.id;if(433===o&&s===d.I3.MaxContextsOnPlan)return;i.showErrorInternal(u.fc.UpdatePlanEntitySetError,o,s,r,t.response,[r])}}))}updatePlanDetails(e,t){const n=this.entityStoreSet.planStore.getPlan(e.id);if(!n)throw new U.m("originalPlan","planStore");this.updatePlanEntitySet(f.T.builder.withPlan(n).withDetails(e).build(),f.T.builder.withPlan(n).withDetails(t).build()),C()(e.categories,t.categories)||this.loggers.usageLogger.logData(p.M.PlanActionCreator,p.M.CategoriesUpdated)}async deletePlan(e,t,n){const a=await this.logicModuleProviders.planModule(),i=await this.logicModuleProviders.notificationModule();a.deletePlanAsync(e,t,n).then((async()=>{(await this.logicModuleProviders.userModule()).removeDeletedPlansFromUserDetailsAsync([e]).catch((()=>{}))}),(t=>{i.handleRequestFailures(t,[],[],u.fc.DeletePlanError,e)}))}async setPlanLastAccess(e,t){const n=this.entityStoreSet.userStore.getUserDetailsById(c.B.currentUserId);if(null==n)return;let a=n;(await this.logicModuleProviders.planModule()).fetchPlanAsync(e).then((async i=>{a=a.setRecentPlan(e,t,i.plan.title);try{a=a.updateRecentAndFavoritePlanTitles(i.id,i.plan.title);const e=await this.logicModuleProviders.userModule();await e.updateUserDetailsAsync(n,a)}catch(o){this.loggers.traceLogger.logTrace(507880128,F.k.Warning,"SetPlanLastAccess UpdateUserDetails Fail ".concat((0,b.LB)(o)))}}),(e=>{this.loggers.traceLogger.logTrace(507880099,F.k.Warning,"SetPlanLastAccess fetchPlan Fail ".concat((0,b.s8)(e)))}))}async removePlanFromRecents(e){const t=this.entityStoreSet.userStore.getUserDetailsById(c.B.currentUserId);if(null==t)return;const n=t.removeRecentPlan(e);(await this.logicModuleProviders.userModule()).updateUserDetailsAsync(t,n).catch((()=>{}))}async setPlanFavoriteStatus(e,t){const{traceLogger:n,usageLogger:a}=this.loggers,o=this.entityStoreSet.userStore.getUserDetailsById(c.B.currentUserId);if(null==o||t&&null==o.favoritePlans.references[e]&&S()(o.favoritePlans.references)===c.B.clientSettings.MaxFavoritePlans)return void this.dispatcher.dispatchAction(new i.e(u.fc.AddToFavoritesError,void 0,void 0,e));let s=o;const l=await this.logicModuleProviders.planModule(),d=await this.logicModuleProviders.notificationModule();l.fetchPlanAsync(e).then((async i=>{const r=i.plan.title;t?(s=s.setFavoritePlan(e,r),a.logData("PlanActionCreator","Adding favorite plan")):(s=s.removeFavoritePlan(e),a.logData("PlanActionCreator","Removing favorite plan"));try{s=s.updateRecentAndFavoritePlanTitles(i.id,i.plan.title)}catch(l){return void n.logTrace(507786911,F.k.Warning,"SetPlanFavorite UpdateUserDetails Fail ".concat((0,b.LB)(l),"]"))}(await this.logicModuleProviders.userModule()).updateUserDetailsAsync(o,s).then((async a=>{if(t){(await this.logicModuleProviders.taskModule()).fetchPlanTasksAsync(e).catch((e=>{n.logTrace(507880098,F.k.Warning,"SetPlanFavorite - FetchPlanTasksAsync Fail ".concat((0,b.s8)(e)))})),d.enqueueHiddenToastNotification("SharedComponents_AddPinnedPlanToastTitle",[],r)}else d.enqueueHiddenToastNotification("SharedComponents_RemovePinnedPlanToastTitle",[],r)}),(e=>{n.logTrace(507880097,F.k.Warning,"SetPlanFavorite UpdateUserDetails Fail ".concat((0,b.s8)(e)))}))}),(t=>{if(!(t instanceof m.U)){var a;const n=null===(a=t.response)||void 0===a?void 0:a.status;404!==n&&403!==n||this.dispatcher.dispatchAction(new r.o({dialogType:T.h.RemovePlanFromPinnedAndRecents,planId:e}))}n.logTrace(507880096,F.k.Warning,"SetPlanFavorite FetchPlan Fail ".concat((0,b.s8)(t)))}))}async updateUserDetailsWithPlan(e){const{traceLogger:t}=this.loggers,n=this.entityStoreSet.userStore.getUserDetailsById(c.B.currentUserId);if(null==n)return;let a=n;try{a=a.updateRecentAndFavoritePlanTitles(e.id,e.plan.title);const t=await this.logicModuleProviders.userModule();await t.updateUserDetailsAsync(n,a)}catch(i){t.logTrace(507880095,F.k.Warning,"updateUserDetailsWithPlan UpdateUserDetails Fail ".concat((0,b.LB)(i)))}}copyLinkToPlan(e){const t=this.entityStoreSet.planStore.getPlan(e);let n=null;if(null!==t&&void 0!==t&&t.isProjectPlan()){const a=this.entityStoreSet.planStore.getPlanDetails(e);if(!a)return void this.loggers.usageLogger.logData(this.name,"copyLinkToPlan::plan details not found",{PlanId:e,ContainerType:t.container.containerType});n=I.wS.getPlanExternalUrl(t,a)}else n=t?I.wS.generateEntityLink(t,u._n.PlanLink,u.rl.Link,new Date):null;if(null==n)return void this.loggers.usageLogger.logData(this.name,"copyLinkToPlan::plan not found",{planId:e});if(M.B.copyToClipboard(n)){const a=new g.N(e,t?t.title:"",n);this.dispatcher.dispatchAction(new o.Z(a))}}async movePlan(e,t,n){throw new Error("Method not implemented.")}constructor(e,t,n,a){super(e,t,n,c.B.clientSettings,a)}}},54439:(e,t,n)=>{n.d(t,{j:()=>c});var a=n(29274),i=n(74427),o=n(57860),s=n(47204),r=n(74568),l=n(79947);class c{static beginTransaction(e,t,n){let{transactionId:i,name:o,logQos:s,action:l,additionalData:d}=t;if(!0===s){const e=new r.W({name:"Tx:"+o},n);c.qosEventsInFlight[i]=e}e.batchDispatchActions(new a.S(o,i,d),l)}static cancelTransaction(e,t){let{transactionId:n,action:a,additionalData:o}=t;const s=c.qosEventsInFlight[n];s&&(s.end({resultType:l.f.ExpectedFailure,extraData:o}),delete c.qosEventsInFlight[n]),e.batchDispatchActions(a,new i.D(n,o))}static completeTransaction(e,t){let{transactionId:n,action:a,additionalData:i}=t;const s=c.qosEventsInFlight[n];s&&(s.end({resultType:l.f.Success,extraData:i}),delete c.qosEventsInFlight[n]),e.batchDispatchActions(a,new o.M(n,i))}static completeTransactionWithBatch(e,t){let{transactionId:n,actions:a,additionalData:i}=t;const s=c.qosEventsInFlight[n];s&&(s.end({resultType:l.f.Success,extraData:i}),delete c.qosEventsInFlight[n]),e.batchDispatchActions(...a,new o.M(n,i))}static completeTransactionWithError(e,t){let{transactionId:n,errorMessage:a,action:i,additionalData:o}=t;const r=c.qosEventsInFlight[n];r&&(r.end({resultType:l.f.Failure,error:a,extraData:o}),delete c.qosEventsInFlight[n]),e.batchDispatchActions(i,new s.Y(n,a,o))}}c.qosEventsInFlight={}},9821:(e,t,n)=>{n.d(t,{B:()=>s});var a=n(12358),i=n.n(a),o=n(34167),s=function(){function e(){}return e.copyToClipboard=function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();var n=document.execCommand("copy");return document.body.removeChild(t),n},e.copyPrettifiedLinkToClipboard=function(e,t){var n=document.createElement("a");n.href=t,n.style.all="initial",n.innerText=e,document.body.appendChild(n);var a=document.createRange();a.selectNode(n);var s=window.getSelection();null===s||void 0===s||s.removeAllRanges(),null===s||void 0===s||s.addRange(a),n.oncopy=function(n){var a,s,r="<a href="+t+' style="all: initial;">'+i()(e)+"</a>";null===(a=n.clipboardData)||void 0===a||a.setData("text/plain",t);var l=new o.tR;l.inputString=r,null===(s=n.clipboardData)||void 0===s||s.setData("text/html",o.xC.sanitize(l)),n.preventDefault()};var r=document.execCommand("copy");return document.body.removeChild(n),r},e}()}}]);
//# sourceMappingURL=planac.eff24c75.chunk.js.map