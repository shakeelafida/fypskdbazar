(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[15456],{78400:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ContainerModule:()=>q,MAX_RETRIES_PER_GROUP:()=>_,POLL_INTERVAL:()=>O});var n=r(32512);class o extends n.v{constructor(e,t,r,n){super(o.actionType,e,t,r),this.groupId=n}}o.actionType="PLW_GET_UNIFIEDGROUP_FAILED";var s=r(94600);class i extends n.v{constructor(e,t,r,n){super(i.actionType,e,t,r),this.groupId=n}}i.actionType="PLW_GET_UNIFIEDGROUPDETAILS_FAILED";var a=r(19879),c=r(9614),l=r(87337),d=r(78751),g=r(85262),u=r(60166),p=r(65394),h=r(36131),v=r(68746),T=r(38110),I=r(40655),y=r(5062);class P extends n.v{constructor(e,t,r){super(P.actionType,e,t,r)}}P.actionType="PLW_RESOLVECONTAINERSTOPLANS_FAILED";var A=r(60878),C=r(15434),x=r(55637),w=r(44227),f=r(78332),m=r(64805),L=r(65818),S=r(64836);class G extends S.m{constructor(e){super({externalId:e,containerType:L.K.DriveItem})}}var k=r(88457);class F extends S.m{constructor(e){super({externalId:e,containerType:L.K.User})}}var E=r(74844),b=r(14740),R=r.n(b),D=r(13728),j=r.n(D),U=r(98502),V=r(54439),W=r(38752),N=r(37084),B=r.n(N),K=r(82841);const _=20,O=3e4;class q extends m.J{get name(){return"ContainerModule"}async fetchContainer(e,t){const{containerType:r,externalId:n}=e;switch(r){case L.K.Group:try{const e=await this.fetchUnifiedGroupAsync(n);if(t){const t=await this.fetchUnifiedGroupDetailsAsync(n);return new k.Z(n,e,t)}return new k.Z(n,e,null)}catch(o){return Promise.reject(o)}case L.K.DriveItem:const e=new G(n);return this.dispatcher.dispatchAction(new A.L(e)),Promise.resolve(e);case L.K.User:const r=new F(W.B.currentUserId);return this.dispatcher.dispatchAction(new A.L(r)),Promise.resolve(r);case L.K.Roster:try{return await this.fetchRosterContainerAsync(n)}catch(o){return Promise.reject(o)}default:return Promise.reject(U.g.generateAjaxClientError(null,"Invalid container type"))}}async fetchContainers(e,t,r){if(e===L.K.User){const t=[{id:{externalId:W.B.currentUserId,containerType:L.K.User},externalId:W.B.currentUserId,containerType:L.K.User,displayName:""}];return this.dispatcher.dispatchAction(new I.A(e,t,!0)),{Results:t,NextContinuationToken:null}}this.loggers.traceLogger.logTrace(507897248,E.k.Verbose,"Fetch Containers [containerType=".concat(e,"]"));const n=e=>{if(e.nextContinuationToken)return null;const t=this.stores.containerStore.getContainersByContainerType(e.containerType);return null!=t?{data:{Results:t,NextContinuationToken:null}}:null};try{const o=await this.webApiProviders.taskService(),s=await o.getContainersAsync({containerType:e,nextContinuationToken:t},n,void 0,r);return this.loggers.traceLogger.logTrace(507897247,E.k.Verbose,"Fetch Containers Success [containerType=".concat(e,"]")),this.dispatcher.dispatchAction(new I.A(e,s.data.Results,null==t)),s.data}catch(o){const t=o;return this.loggers.traceLogger.logTrace(507897246,E.k.Warning,"Fetch Containers Failed [containerType=".concat(e,"]").concat((0,K.s8)(t))),Promise.reject(t)}}async resolveContainersToPlans(e,t,r){if(this.loggers.traceLogger.logTrace(507897245,E.k.Verbose,"Resolve Containers To Plans [containerType=".concat(e,"][containerExternalIds.length=").concat(t.length,"]")),0===t.length)return Promise.resolve({});const n=e=>{const t={};for(let r=0;r<e.containerIds.length;r++){const n=e.containerIds[r];if(!this.stores.containerMembershipStore.getContainerHasBeenResolved(n))return null;const o=this.stores.containerMembershipStore.getPlanIdsForContainer(n);if(null==o)return null;const s=o.map((e=>this.stores.planStore.getPlan(e)));if(-1!==s.indexOf(null))return null;t[n]=R()(s)}return t},o=await this.webApiProviders.taskService(),s=this.stores.appContextStore.getApiBatchLimits().ResolveGroupsToPlansBatchedAsync,i=t.slice(),a=[];for(;i.length>0;){let t=[];t=i.length<=s?i.splice(0):i.splice(0,s),a.push(o.resolveContainerIdsToPlansBatchedAsync({containerType:e,containerIds:t},n,void 0,r).then((t=>(this.loggers.traceLogger.logTrace(507897244,E.k.Verbose,"Resolve Containers To Plans Batch Success [containerType=".concat(e,"]")),this.dispatcher.dispatchAction(new y.f(t,e)),Promise.resolve(t))),(t=>{var r,n,o,s;return this.loggers.traceLogger.logTrace(507897243,E.k.Warning,"Resolve Containers to Plans Batch Failed [containerType=".concat(e,"]").concat((0,K.s8)(t))),this.dispatcher.dispatchAction(new P(t.response,null!==(r=null===(n=t.response)||void 0===n?void 0:n.statusText)&&void 0!==r?r:"",null!==(o=null===(s=t.error)||void 0===s?void 0:s.message)&&void 0!==o?o:"")),Promise.reject(t)})))}const c=await Promise.allSettled(a),l={};let d;if(c.forEach((e=>{if("fulfilled"===e.status)null!=e.value&&j()(l,e.value);else if("rejected"===e.status){var t,r,n,o;d=e;const s=null!==(t=null===(r=d.reason)||void 0===r||null===(r=r.response)||void 0===r?void 0:r.status)&&void 0!==t?t:0,i=null!==(n=null===(o=d.reason)||void 0===o||null===(o=o.response)||void 0===o?void 0:o.statusText)&&void 0!==n?n:"";this.loggers.traceLogger.logTrace(507897242,E.k.Warning,"Resolve Containers to Plans Failed [statusCode=".concat(s,"][statusText=").concat(i,"]"))}})),null==d)return this.loggers.traceLogger.logTrace(507897241,E.k.Verbose,"Resolve Containers To Plans Success [containerType=".concat(e,"][containerExternalIds.length=").concat(t.length,"]")),l;{const e=d.reason||U.g.generateAjaxClientError(null,"");return Promise.reject(e)}}async fetchUnifiedGroupAsync(e){if(this.loggers.traceLogger.logTrace(507897240,E.k.Verbose,"Ensure Group [groupId=".concat(e,"]")),!e)return this.loggers.traceLogger.logTrace(507897239,E.k.Warning,"Ensure Group Failed [groupId=".concat(e,"][Error=ArgumentNullException: groupId]")),Promise.reject(U.g.generateAjaxClientError(null,"ArgumentNullException: groupId"));const t=e=>{var t;const r=this.stores.containerStore.getContainer(e.groupId),n=(null===r||void 0===r?void 0:r.containerType)===L.K.Group?r:null;return null!==(t=null===n||void 0===n?void 0:n.unifiedGroup)&&void 0!==t?t:null},r=e+f.Ek.FetchGroup;V.j.beginTransaction(this.dispatcher,{name:"fetchGroup",transactionId:r},this.loggers.logHandler);try{const n=await this.webApiProviders.graph(),o=await n.getUnifiedGroupAsync({groupId:e},t);this.loggers.traceLogger.logTrace(507897238,E.k.Verbose,"Ensure Group Success [groupId=".concat(e,"]"));const s=new k.Z(o.id,o,null);return V.j.completeTransaction(this.dispatcher,{transactionId:r,action:new A.L(s)}),o}catch(d){var n,s,i,a,c,l;const t=d;this.loggers.traceLogger.logTrace(507897237,E.k.Warning,"Ensure Group Failed [groupId=".concat(e,"]").concat((0,K.s8)(t)));const g=null!==(n=null===(s=t.response)||void 0===s?void 0:s.status)&&void 0!==n?n:0;return V.j.completeTransactionWithError(this.dispatcher,{transactionId:r,action:new o(t.response,null!==(i=null===(a=t.response)||void 0===a?void 0:a.statusText)&&void 0!==i?i:"",null!==(c=null===(l=t.error)||void 0===l?void 0:l.message)&&void 0!==c?c:"",e),errorMessage:"",additionalData:{statusCode:g}}),Promise.reject(t)}}async fetchUnifiedGroupDetailsAsync(e){if(this.loggers.traceLogger.logTrace(507897236,E.k.Verbose,"Ensure Group Details [groupId=".concat(e,"]")),!e)return this.loggers.traceLogger.logTrace(507897235,E.k.Warning,"Ensure Group Details Failed [groupId=".concat(e,"][Error=ArgumentNullException: groupId]")),Promise.reject(U.g.generateAjaxClientError(null,"ArgumentNullException: groupId"));const t=this.stores.containerStore.getContainer(e);if(t&&t.containerType===L.K.Group){var r;const n=t;if(null!==(r=n.unifiedGroupDetails)&&void 0!==r&&r.isFullyProvisioned())return this.loggers.traceLogger.logTrace(507897234,E.k.Verbose,"Ensure Group Details Success - group details fully provisioned [groupId=".concat(e,"]")),Promise.resolve(n.unifiedGroupDetails)}const n=e=>{const t=this.stores.containerStore.getContainer(e.groupId);if(t&&t.containerType===L.K.Group){var r;const e=t;if(null!==(r=e.unifiedGroupDetails)&&void 0!==r&&r.isFullyProvisioned())return e.unifiedGroupDetails}return null},o=this.getCurrentViewIds();try{const t=await this.webApiProviders.taskService(),r=await t.getUnifiedGroupDetailsAsync({groupId:e},n,o);return this.loggers.traceLogger.logTrace(507897233,E.k.Verbose,"Ensure Group Details Success [groupId=".concat(e,"]")),this.dispatcher.dispatchAction(new s.P(r)),r}catch(g){var a,c,l,d;const t=g;return this.dispatcher.dispatchAction(new i(t.response,null!==(a=null===(c=t.response)||void 0===c?void 0:c.statusText)&&void 0!==a?a:"",null!==(l=null===(d=t.error)||void 0===d?void 0:d.message)&&void 0!==l?l:"",e)),this.loggers.traceLogger.logTrace(507897232,E.k.Warning,"Ensure Group Details Failed [groupId=".concat(e,"]").concat((0,K.s8)(t))),Promise.reject(t)}}async fetchGroupSensitivityLabelAsync(e){this.loggers.traceLogger.logTrace(507897231,E.k.Verbose,"Fetching Group Sensitivity Label [GroupId=".concat(e,"]"));try{const t=await this.webApiProviders.taskService(),r=await t.getUnifiedGroupSensitivityLabelAsync({groupId:e});return this.loggers.traceLogger.logTrace(507897230,E.k.Verbose,"Fetching Group Sensitivity Label - Success [GroupId=".concat(e,"]")),this.dispatcher.dispatchAction(new a.k(e,r)),r}catch(t){const r=t;return this.loggers.traceLogger.logTrace(507897229,E.k.Warning,"Fetching Group Sensitivity Label - Failure  [GroupId=".concat(e,"]").concat((0,K.s8)(r))),Promise.reject(r)}}async fetchRosterContainerAsync(e){if(this.loggers.traceLogger.logTrace(507897228,E.k.Verbose,"Fetching Roster Container [ContainerId=".concat(e,"]")),!e)return this.loggers.traceLogger.logTrace(507897227,E.k.Warning,"Fetching Roster Container Failed [ContainerId=".concat(e,"][Error=ArugumentNullException: containerId]")),Promise.reject(U.g.generateAjaxClientError(null,"ArgumentNullException: containerId"));const t=e=>{const t=this.stores.containerStore.getContainer(e.containerId);return(null===t||void 0===t?void 0:t.containerType)===L.K.Roster?t:null};try{const r=await this.webApiProviders.taskService(),n=await r.getRosterContainerAsync({containerId:e},t);return this.loggers.traceLogger.logTrace(507897226,E.k.Verbose,"Fetching Roster Container - Success [ContainerId=".concat(e,"]")),this.dispatcher.dispatchAction(new A.L(n)),n}catch(i){var r,n,o,s;const t=i;return this.loggers.traceLogger.logTrace(507897225,E.k.Warning,"Fetching Roster Container - Failure  [ContainerId=".concat(e,"]").concat((0,K.s8)(t))),this.dispatcher.dispatchAction(new C.x(t.response,null!==(r=null===(n=t.response)||void 0===n?void 0:n.statusText)&&void 0!==r?r:"",null!==(o=null===(s=t.error)||void 0===s?void 0:s.message)&&void 0!==o?o:"",e)),Promise.reject(t)}}pollForGroupFullyProvisioned(e){this.isPollingGroup[e.id]||(this.isPollingGroup[e.id]=!0,this.internalPollForGroupFullyProvisioned(e))}internalPollForGroupFullyProvisioned(e){if(e.isFullyProvisioned())return void delete this.isPollingGroup[e.id];const t=this.stores.appContextStore.getCurrentPlanId();(t?this.stores.planStore.getContainerIdForPlan(t):this.stores.appContextStore.getCurrentGroupId())===e.id?(this.retriesPerGroup[e.id]||(this.retriesPerGroup[e.id]=0),this.retriesPerGroup[e.id]<_?(this.retriesPerGroup[e.id]++,setTimeout((()=>{this.loggers.traceLogger.logTrace(507897224,E.k.Info,"Polling for group [Id=".concat(e.id,"][Retries=").concat(this.retriesPerGroup[e.id],"][IsProvisioned=").concat(e.isFullyProvisioned(),"][SPO=").concat(e.isSharePointProvisioned(),"]")),this.fetchUnifiedGroupDetailsAsync(e.id).then((e=>this.internalPollForGroupFullyProvisioned(e))).catch((()=>{delete this.isPollingGroup[e.id]}))}),O)):delete this.isPollingGroup[e.id]):delete this.isPollingGroup[e.id]}async createRosterContainerAsync(){this.loggers.traceLogger.logTrace(507897223,E.k.Verbose,"Create Roster Container");try{const e=await this.webApiProviders.taskService(),t=await e.createPlannerRosterAsync({});return this.loggers.traceLogger.logTrace(507897222,E.k.Verbose,"Create Roster Container - Success [ContainerId=".concat(t.externalId,"]")),this.dispatcher.dispatchAction(new w.A(t)),t}catch(e){throw this.loggers.traceLogger.logTrace(507897221,E.k.Warning,"Create Roster Container - Failure ".concat((0,K.s8)(e))),e}}async setRosterContainerSensitivityLabelAsync(e){this.loggers.traceLogger.logTrace(507897220,E.k.Verbose,"Set Roster Sensitivity Label [ContainerId=".concat(e.externalId,"]"));try{const t=await this.webApiProviders.taskService(),r=await t.setRosterSensitivityLabelAsync({rosterContainer:e});return this.loggers.traceLogger.logTrace(507897219,E.k.Verbose,"Set Roster Container Sensitivity Label - Success [ContainerId=".concat(e.externalId,"]")),this.dispatcher.dispatchAction(new x.G(r)),r}catch(t){const r=t;return this.loggers.traceLogger.logTrace(507897218,E.k.Warning,"Set Roster Container Sensitivity Label - Failure  [ContainerId=".concat(e.externalId,"]").concat((0,K.s8)(r))),Promise.reject(r)}}async addUsersToContainerAsync(e,t){this.loggers.traceLogger.logTrace(507897217,E.k.Verbose,"Batch Add Users To Container [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]")),this.dispatcher.dispatchAction(new g.V(t,e.externalId));const r=this.stores.appContextStore.getApiBatchLimits().AddUsersToGroupMaxBatchSize,n=await this.webApiProviders.taskService();return new Promise(((o,s)=>{const i=[];for(const a of B()(t,r)){const t=[];for(const r of a)t.push(n.addUserToContainer({container:e,userId:r}).then((()=>(this.loggers.traceLogger.logTrace(507897216,E.k.Verbose,"Add User To Container Success [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]")),this.dispatcher.dispatchAction(new u.$(r,e.externalId)),Promise.resolve())),(t=>{var n,o,s,i;return this.loggers.traceLogger.logTrace(507897187,E.k.Warning,"Add User To Container Failed [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]").concat((0,K.s8)(t))),this.dispatcher.dispatchAction(new p.d(r,e.externalId,t.response,null!==(n=null===(o=t.response)||void 0===o?void 0:o.statusText)&&void 0!==n?n:"",null!==(s=null===(i=t.error)||void 0===i?void 0:i.message)&&void 0!==s?s:"")),Promise.reject(t)})));i.push(Promise.allSettled(t).then((async e=>{let t;if(e.forEach((e=>{"rejected"===e.status&&(t=e)})),null!=t){const e=t.reason||U.g.generateAjaxClientError(null,"");return Promise.reject(e)}Promise.resolve()})))}Promise.allSettled(i).then((async e=>{let t;if(e.forEach((e=>{if("rejected"===e.status){var r,n,o,s;t=e;const i=null!==(r=null===(n=t.reason)||void 0===n||null===(n=n.response)||void 0===n?void 0:n.status)&&void 0!==r?r:0,a=null!==(o=null===(s=t.reason)||void 0===s||null===(s=s.response)||void 0===s?void 0:s.statusText)&&void 0!==o?o:"";this.loggers.traceLogger.logTrace(507897186,E.k.Warning,"Add Users To Container Failed [statusCode=".concat(i,"][statusText=").concat(a,"]"))}})),null==t)o();else{const e=t.reason||U.g.generateAjaxClientError(null,"");s(e)}}))}))}async removeUserFromContainerAsync(e,t){this.loggers.traceLogger.logTrace(507897185,E.k.Verbose,"Remove User From Container [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]")),this.dispatcher.dispatchAction(new h.C(t,e.externalId));try{const r=await this.webApiProviders.taskService();return await r.removeUserFromContainer({container:e,userId:t}),this.loggers.traceLogger.logTrace(507897184,E.k.Verbose,"Remove User From Container Success [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]")),this.dispatcher.dispatchAction(new v.f(t,e.externalId)),Promise.resolve()}catch(i){var r,n,o,s;const a=i;return this.loggers.traceLogger.logTrace(507897183,E.k.Warning,"Remove User From Container Failed [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]").concat((0,K.s8)(a))),this.dispatcher.dispatchAction(new T.R(t,e.externalId,a.response,null!==(r=null===(n=a.response)||void 0===n?void 0:n.statusText)&&void 0!==r?r:"",null!==(o=null===(s=a.error)||void 0===s?void 0:s.message)&&void 0!==o?o:"")),Promise.reject(a)}}deleteContainer(e){return e.containerType===L.K.Group?this.deleteGroupContainer(e):(this.loggers.traceLogger.logTrace(507897182,E.k.Warning,"Trying to delete non-group container [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]")),Promise.reject(U.g.generateAjaxClientError(null,"Trying to delete non-group container")))}async deleteGroupContainer(e){this.loggers.traceLogger.logTrace(507897181,E.k.Verbose,"Delete container [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]")),this.dispatcher.dispatchAction(new c.H(e.externalId));try{const t=await this.webApiProviders.taskService();return await t.deleteUnifiedGroupAsync({groupId:e.externalId}),this.loggers.traceLogger.logTrace(507897180,E.k.Verbose,"Delete container success [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]")),this.dispatcher.dispatchAction(new l.s(e)),Promise.resolve()}catch(i){var t,r,n,o,s;const a=i;return 404===(null===(t=a.response)||void 0===t?void 0:t.status)?(this.loggers.traceLogger.logTrace(507897179,E.k.Info,"Delete container failed - Not found [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]").concat((0,K.s8)(a))),this.dispatcher.dispatchAction(new l.s(e)),Promise.resolve()):(this.loggers.traceLogger.logTrace(507897178,E.k.Warning,"Delete container failed [containerId=".concat(e.externalId,"][containerType=").concat(e.containerType,"]").concat((0,K.s8)(a))),this.dispatcher.dispatchAction(new d.W(e.externalId,a.response,null!==(r=null===(n=a.response)||void 0===n?void 0:n.statusText)&&void 0!==r?r:"",null!==(o=null===(s=a.error)||void 0===s?void 0:s.message)&&void 0!==o?o:"")),Promise.reject(a))}}constructor(){super(...arguments),this.retriesPerGroup={},this.isPollingGroup={}}}},64805:(e,t,r)=>{"use strict";r.d(t,{J:()=>o});class n{get clientSettings(){return this.clientSettingsProvider()}constructor(e,t,r){this.dispatcher=e,this.clientSettingsProvider=t,this.loggers=r}}class o extends n{getCurrentViewIds(){const e=this.stores.appContextStore.getCurrentViewId();return e?[e]:void 0}constructor(e,t,r,n,o){super(e,n,o),this.webApiProviders=t,this.stores=r}}},54439:(e,t,r)=>{"use strict";r.d(t,{j:()=>l});var n=r(29274),o=r(74427),s=r(57860),i=r(47204),a=r(74568),c=r(79947);class l{static beginTransaction(e,t,r){let{transactionId:o,name:s,logQos:i,action:c,additionalData:d}=t;if(!0===i){const e=new a.W({name:"Tx:"+s},r);l.qosEventsInFlight[o]=e}e.batchDispatchActions(new n.S(s,o,d),c)}static cancelTransaction(e,t){let{transactionId:r,action:n,additionalData:s}=t;const i=l.qosEventsInFlight[r];i&&(i.end({resultType:c.f.ExpectedFailure,extraData:s}),delete l.qosEventsInFlight[r]),e.batchDispatchActions(n,new o.D(r,s))}static completeTransaction(e,t){let{transactionId:r,action:n,additionalData:o}=t;const i=l.qosEventsInFlight[r];i&&(i.end({resultType:c.f.Success,extraData:o}),delete l.qosEventsInFlight[r]),e.batchDispatchActions(n,new s.M(r,o))}static completeTransactionWithBatch(e,t){let{transactionId:r,actions:n,additionalData:o}=t;const i=l.qosEventsInFlight[r];i&&(i.end({resultType:c.f.Success,extraData:o}),delete l.qosEventsInFlight[r]),e.batchDispatchActions(...n,new s.M(r,o))}static completeTransactionWithError(e,t){let{transactionId:r,errorMessage:n,action:o,additionalData:s}=t;const a=l.qosEventsInFlight[r];a&&(a.end({resultType:c.f.Failure,error:n,extraData:s}),delete l.qosEventsInFlight[r]),e.batchDispatchActions(o,new i.Y(r,n,s))}}l.qosEventsInFlight={}},13728:(e,t,r)=>{var n=r(78420),o=r(96614),s=r(84570),i=r(6571),a=r(36140),c=r(28673),l=Object.prototype.hasOwnProperty,d=s((function(e,t){if(a(t)||i(t))o(t,c(t),e);else for(var r in t)l.call(t,r)&&n(e,r,t[r])}));e.exports=d}}]);
//# sourceMappingURL=containermodule.5f92fab4.chunk.js.map