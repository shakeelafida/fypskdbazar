"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[4524],{79202:(e,t,r)=>{r.r(t),r.d(t,{MTSFoundInPlaces:()=>P,getNonOdspSharingHistory:()=>E,getOdspMTSSharingHistory:()=>U});var n=r(76899),i=r(17107),o=r(60980),s=r(30946),a=r(17601),d=r(40635);const c=0,l=1,u=2,h=3,p=4,m=5,g=6,f=7;var I=r(56993),w=r(51238);const v=e=>{var t;return{method:"GET",headers:{"Client-Request-Id":(0,w.A)(),"X-Office-Application":"300","X-Office-AudienceGroup":null!==(t=null===e||void 0===e?void 0:e.audience)&&void 0!==t?t:"","X-Office-Platform":(0,n.Fr)()?"Mobile":"Web"}}},y=(e,t,r)=>({getToken:e=>t.getToken(i.S,e),url:e,requestInit:v(r),retryPolicy:i.B});async function U(e,t,r,n,o){const c=await(0,s.A7)(t,e),l="https://substrate.office.com/recommended/api/beta/loop/sharedlocations?fileId=".concat(c),u=y(l,t,n),h=v(n),p=r&&o?await(0,a.k)({url:l,requestInit:h,scopes:i.S,retryPolicy:i.B,logger:r,nameForLogging:"MTSFoundInPlaces",user:o.user,tokenProvider:t}):await(0,d.y)(u);return await p.result.json().catch((e=>{r&&(0,I.e)(r,{eventName:"MtsApiJsonParsingError",subErrorName:"FluidLoopComponent"},e)}))}async function E(e,t,r,n,o){const s="https://substrate.office.com/recommended/api/beta/loop/sharedlocations?externalUrl=".concat(e),c=y(s,t,n),l=v(n),u=r&&o?await(0,a.k)({url:s,requestInit:l,scopes:i.S,retryPolicy:i.B,logger:r,nameForLogging:"MTSFoundInPlaces",user:o.user,tokenProvider:t}):await(0,d.y)(c);return await u.result.json().catch((e=>{r&&(0,I.e)(r,{eventName:"MtsApiJsonParsingError",subErrorName:"FluidNonLoopComponent"},e)}))}class P{get foundInPlacesServicePromise(){return Promise.resolve(this)}async getFoundInPlaces(e){let{documentUrl:t}=e;const r=await this.getMTSFoundInPlacesResponse(this.tokenProvider,t,this.logger);return this.transformMTSResponse(null!==r&&void 0!==r?r:{})}async getMTSFoundInPlacesResponse(e,t,r){const n=r||this.logger;if(void 0===t)return void(n&&(0,I.e)(n,{eventName:"MtsApiUrlUndefinedError"}));const i=await async function(e,t,r){try{return await(0,o.j)(e,t,r)}catch{return}}(t,e,n);let s;return s=i?await U({siteUrl:i.siteUrl,driveId:i.driveId,fileId:i.itemId},e,n,this.settingsProvider,this.userContext):await E(t,e,n,this.settingsProvider,this.userContext),void 0===s&&n&&(0,I.e)(n,{eventName:"MtsApiResponseUndefinedError"}),s}transformMTSResponse(e){var t;return{places:null===(t=e.sharing_history)||void 0===t?void 0:t.filter((e=>e.sharing_medium!==f)).map((e=>{if(e.sharing_medium===p||e.sharing_medium===m){const{host:t,location:r}=this.normalizeMTSSharingMedium(e.sharing_medium),{title:n}=this.getWorkspaceDetails(e.workspace);return{host:t,location:r,subject:n}}if(e.sharing_medium===g){const{host:t,location:r}=this.normalizeMTSSharingMedium(e.sharing_medium,e.file.type),{title:n}=e.file;return{host:t,location:r,subject:n,url:e.sharing_reference_url}}{var t,r,n,i;const{host:o,location:s}=this.normalizeMTSSharingMedium(e.sharing_medium);return{host:o,location:s,subject:e.subject||"",createdDate:e.shared_time?new Date(e.shared_time):void 0,url:e.sharing_reference_url,author:{name:null!==(t=null===(r=e.sharer)||void 0===r?void 0:r.display_name)&&void 0!==t?t:"",smtp:null===(n=e.sharer)||void 0===n?void 0:n.smtp},collaborators:null===(i=e.participants)||void 0===i?void 0:i.map((e=>({name:e.display_name,smtp:e.smtp})))}}}))}}getWorkspaceDetails(e){const{title:t}=e;return{title:t}}normalizeMTSSharingMedium(e,t){switch(e){case c:return{host:"Outlook",location:"Email"};case l:return{host:"Teams",location:"Chat"};case u:return{host:"Outlook",location:"Calendar"};case h:return{host:"Teams",location:"Channel"};case p:case m:return{host:"Loop",location:"Workspace"};case g:switch(t){case"Word":return{host:"Word",location:"other"};case"Whiteboard":return{host:"Whiteboard",location:"other"};case"Fluid":return{host:"Loop",location:"Page"};default:return{host:"other",location:"other"}}default:return{host:"other",location:"other"}}}constructor(e,t,r,n){this.tokenProvider=e,this.logger=t,this.settingsProvider=r,this.userContext=n}}},60980:(e,t,r)=>{r.d(t,{j:()=>h});var n=r(29018),i=r(40635),o=r(74405),s=r(25969),a=r(72376),d=r(66206),c=r(18206);const l=["files.readwrite.all"],u="https://graph.microsoft.com/v1.0";async function h(e,t,r){var h,p;const m=(0,n.$)(e),g="Consumer"===t.identityType&&m===d.W,f=btoa(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,""),I=g?u:"".concat(m,"/_api/v2.0"),w={getToken:e=>{const r={...e,siteUrl:m};return t.getToken(g?l:(0,s.K)(m),g?e:r)},url:"".concat(I,"/shares/u!").concat(f,"/driveItem?select=id,name,parentReference,sharepointIds"),requestInit:{method:"GET",headers:{Prefer:"redeemSharingLink"}},retryPolicy:g?c.XM:a._9,tokenPolicy:g?void 0:(0,a.N$)(t)},v=r?(0,i.g)({...w,logger:r,nameForLogging:"getOdspItemWithSharepointIdsFromLink",doNotLogOnSuccess:!0,getAdditionalProps:async(e,t)=>(0,o.u)(e)}):(0,i.y)(w),y=await(await v).result.json();if(g)return function(e,t){if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");return{itemId:e.id,driveId:e.parentReference.driveId,siteUrl:t,fileName:e.name,listId:"",listItemId:"",siteId:"",webId:"",listItemUniqueId:"",title:""}}(y,m);if(null===(h=y.sharepointIds)||void 0===h||!h.siteUrl)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if(null===(p=y.parentReference)||void 0===p||!p.driveId)throw new Error("Unexpected response: missing parentReference.driveId");if(!y.id)throw new Error("Unexpected response: missing id");return function(e){if("object"!==typeof e)throw new Error("Unexpected response");if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");const{sharepointIds:t}=e;if(!t)throw new Error("Unexpected response: missing sharepointIds");const{listId:r,listItemId:n,siteId:i,webId:o,siteUrl:s,listItemUniqueId:a}=t;if("string"!==typeof r)throw new Error("Unexpected response: missing sharepointIds.listId");if("string"!==typeof n)throw new Error("Unexpected response: missing sharepointIds.listItemId");if("string"!==typeof i)throw new Error("Unexpected response: missing sharepointIds.siteId");if("string"!==typeof o)throw new Error("Unexpected response: missing sharepointIds.webId");if("string"!==typeof s)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if("string"!==typeof a)throw new Error("Unexpected response: missing sharepointIds.listItemUniqueId");return{driveId:e.parentReference.driveId,siteUrl:s,itemId:e.id,listId:r,listItemId:n,siteId:i,webId:o,listItemUniqueId:a,fileName:e.name,title:e.title}}(y)}},30946:(e,t,r)=>{function n(e){const t=window.btoa(e);return t.replace(/(\+|\/|\=)/g,(e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError("Unexpected match ".concat(e," encountered in urlEncodeBase64String. Only +/= are to be replaced."))}))}r.d(t,{A7:()=>o});var i=r(60835);async function o(e,t,r){const{siteUrl:n,driveId:o,fileId:a}=t,d=await(0,i.sN)(e,n,o,a,r);if(!d)throw new Error("Failed to fetch file sharepoint ids");return s(d,a)}function s(e,t){const{siteId:r,webId:i,listId:o}=e;return"SPO_".concat(n("".concat(r,",").concat(i,",").concat(o)),"_").concat(t)}}}]);
//# sourceMappingURL=MTSFoundInPlaces.ae05646d.chunk.js.map