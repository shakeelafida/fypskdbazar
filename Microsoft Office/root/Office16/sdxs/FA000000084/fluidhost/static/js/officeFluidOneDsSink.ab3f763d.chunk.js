"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[26873],{14698:(e,t,n)=>{n.r(t),n.d(t,{MSATenantId:()=>v,OfficeFluidOneDsSink:()=>p});var a=n(10945),s=n(90589),i=n(12283),r=n(63074),o="Office.Telemetry.OTelJS.EventThrottled";function d(e){return"number"===typeof e}var l,c=function(){function e(e,t){this._sinkName=e,this._telemetrySink=t,this.name="EventThrottler",this._totalEventsInLastInterval=0,this._singleEventInLastInterval={},this._eventThrottleReported={},this._lastIntervalStart=Date.now(),this._maxNamedEventsPerSecond={}}return e.prototype.setSingleEventThrottle=function(e){this._maxSingleEventPerSecond=e},e.prototype.setTotalEventThrottle=function(e){this._maxTotalEventsPerSecond=e},e.prototype.setNamedEventThrottle=function(e,t){this._maxNamedEventsPerSecond[e]=t},e.prototype.processEvent=function(e){var t=e.eventName;if(t===o)return!0;var n=!0;return Date.now()-this._lastIntervalStart>1e3&&(this._lastIntervalStart=Date.now(),this._totalEventsInLastInterval=0,this._singleEventInLastInterval={}),this._singleEventInLastInterval[t]=this._singleEventInLastInterval[t]+1||1,t in this._maxNamedEventsPerSecond?n=this.applyThrottle(this._singleEventInLastInterval[t],this._maxNamedEventsPerSecond[t],"MaxNamedEventsPerSecond",t):d(this._maxSingleEventPerSecond)&&(n=this.applyThrottle(this._singleEventInLastInterval[t],this._maxSingleEventPerSecond,"MaxSingleEventsPerSecond",t)),d(this._maxTotalEventsPerSecond)&&(this._totalEventsInLastInterval++,n&&(n=this.applyThrottle(this._totalEventsInLastInterval,this._maxTotalEventsPerSecond,"MaxTotalEventsPerSecond",t))),n},e.prototype.applyThrottle=function(e,t,n,a){return!(e>t)||(e===t+1&&this._telemetrySink&&!this._eventThrottleReported[a]&&(this._eventThrottleReported[a]=!0,this._telemetrySink.sendTelemetryEvent({eventName:o,telemetryProperties:{ariaTenantToken:r.z2,nexusTenantToken:1723},eventFlags:{diagnosticLevel:110},dataFields:[(0,s.m9)("SinkName",this._sinkName||""),(0,s.m9)("ThrottledEvent.Name",a),(0,s.Ug)(n,t)]})),(0,i.wC)(2,1,(function(){return"1DS Sink Event Throttle: Exceeded ".concat(t," ").concat(n,": ").concat(a)})),!1)},e}();!function(e){e.USGOV_DOD="https://pf.events.data.microsoft.com/OneCollector/1.0/",e.USGOV_DOJ="https://tb.events.data.microsoft.com/OneCollector/1.0/",e.PUBLIC="https://browser.events.data.microsoft.com/OneCollector/1.0/",e.CUSTOMER_CONTENT="",e.EUDB="https://eu-office.events.data.microsoft.com/OneCollector/1.0/"}(l||(l={}));var h=n(93916);const v="9188040d-6c67-4c5b-b112-36a304b66dad";let u;class p{getReleaseAudienceGroup(e){if(e)switch(e){case"Automation":case"SyntheticTraffic":case"Local":case"Development":case"Staging":case"Dogfood":case"Preview":case"Microsoft":case"Production":return e;case"GCC":case"GCC-High":case"DoD":case"USNat":case"USSec":return"Production";default:return}}determineTenantGroupType(e){return e===v?"Consumer":"Commercial"}addDataFieldIfNeeded(e,t,n){const a=(0,h.R)(n,t);a&&e.push(a)}extractPartADataFields(e){const t=[];this.addDataFieldIfNeeded(t,"App.Platform",e.appPlatform||"Web"),this.addDataFieldIfNeeded(t,"App.Name",e.appName||"Fluid"),this.addDataFieldIfNeeded(t,"App.Version",e.appVersion),this.addDataFieldIfNeeded(t,"Release.AudienceGroup",this.getReleaseAudienceGroup(e.audience)),this.addDataFieldIfNeeded(t,"Session.Id",e.sessionId),this.addDataFieldIfNeeded(t,"Culture.UiLanguage",e.uiLanguage);const n=e.user;return this.addDataFieldIfNeeded(t,"User.IsAnonymous",!n),this.addDataFieldIfNeeded(t,"User.TenantId",null===n||void 0===n?void 0:n.tenantId),this.addDataFieldIfNeeded(t,"User.TenantGroup",n&&this.determineTenantGroupType(n.tenantId)),this.addDataFieldIfNeeded(t,"User.PrimaryIdentityHash",null===n||void 0===n?void 0:n.id),this.addDataFieldIfNeeded(t,"User.PrimaryIdentitySpace",null===n||void 0===n?void 0:n.userIdSpace),t}constructor(e){this.context=e,this.createOneDsSink=()=>{if(!u){u=new a.r([],{endpointUrl:this.getOneDsEndpointUrl()}),u.setFullEventsEnabled(!0);const e=new c("_",u);e.setSingleEventThrottle(100),e.setTotalEventThrottle(1e3),u.addPreprocessor(e),this.setPartADataFields(this.context)}return u},this.shutdown=()=>{u.shutdown()},this.setPartADataFields=e=>{const t=this.extractPartADataFields(e);u.addPersistentDataFields(t)},this.getOneDsEndpointUrl=()=>{switch(this.audience){case"Automation":case"SyntheticTraffic":case"Local":case"Development":case"Staging":case"Dogfood":case"Preview":case"Microsoft":case"Production":case"GCC":return l.PUBLIC;case"GCC-High":return l.USGOV_DOJ;case"DoD":return l.USGOV_DOD;default:throw new Error("Unexpected audience value provided")}},this.audience=e.audience}}}}]);
//# sourceMappingURL=officeFluidOneDsSink.ab3f763d.chunk.js.map